<div class="enrichment-block">
  <h3>🔍 深化理解：群和齐性空间（Groups & Homogeneous）</h3>
  
  <div class="enrichment-qa">
    <h4>💬 核心问答</h4>
    
    <div class="qa-pair">
      <div class="question">
        <strong>Q1：什么是群？为什么对称性可以用群描述？</strong>
      </div>
      <div class="answer">
        <p><strong>群的直观定义</strong>：</p>
        <p>一个集合 $G$ 配备一个"复合"运算 $\circ$，满足：</p>
        <ol>
          <li><strong>封闭性</strong>：$g_1, g_2 \in G \Rightarrow g_1 \circ g_2 \in G$（两个对称变换复合后仍是对称变换）</li>
          <li><strong>结合律</strong>：$(g_1 \circ g_2) \circ g_3 = g_1 \circ (g_2 \circ g_3)$</li>
          <li><strong>单位元</strong>：存在 $e \in G$ 使得 $e \circ g = g \circ e = g$（"什么都不做"的变换）</li>
          <li><strong>逆元</strong>：每个 $g$ 都有 $g^{-1}$ 使得 $g \circ g^{-1} = e$（变换可以"撤销"）</li>
        </ol>
        
        <p><strong>魔方的类比</strong>：</p>
        <ul>
          <li>群 $G$ = 所有可能的魔方旋转操作</li>
          <li>复合 = 连续做两次旋转</li>
          <li>单位元 = "不动"</li>
          <li>逆元 = "反向旋转"（如 R 的逆是 R'）</li>
        </ul>
        <p>无论你怎么转魔方，转多少次，最后的状态都可以用一个"等价的单次操作"表示——这就是群的封闭性。</p>
        
        <p><strong>对称性 = 保持结构不变的变换</strong>：</p>
        <ul>
          <li>正方形有 8 个对称变换（4 个旋转 + 4 个翻转）→ 二面体群 $D_4$</li>
          <li>雪花有 6 重旋转对称 + 6 条镜面对称 → $D_6$</li>
          <li>球面有无穷多旋转对称 → SO(3)</li>
        </ul>
        
        <p><strong>为什么群是深度学习的核心</strong>：</p>
        <p>神经网络的任务是学习<strong>不受无关变换影响</strong>的特征。如果我们知道数据具有某种对称性（群 $G$），就可以设计<strong>$G$-等变网络</strong>，自动利用这些对称性。</p>
      </div>
    </div>
    
    <div class="qa-pair">
      <div class="question">
        <strong>Q2：SO(3) 是什么？为什么机器人学和物理仿真都离不开它？</strong>
      </div>
      <div class="answer">
        <p><strong>SO(3) = 三维旋转群</strong>：</p>
        <p>Special Orthogonal Group，所有保持原点不动的刚体旋转。</p>
        <p>数学定义：$\text{SO}(3) = \{R \in \mathbb{R}^{3 \times 3} : R^\top R = I, \det R = 1\}$</p>
        <ul>
          <li>正交条件 $R^\top R = I$：保持长度和角度（不拉伸不剪切）</li>
          <li>行列式 $= 1$：保持手性（右手系不变成左手系）</li>
        </ul>
        
        <p><strong>地球自转的类比</strong>：</p>
        <ul>
          <li>地球绕地轴旋转（23.5° 倾角）</li>
          <li>任意旋转可以分解为"绕某个轴旋转某个角度"（<strong>欧拉轴-角表示</strong>）</li>
          <li>例如：绕 $z$ 轴旋转 30° 的矩阵：</li>
        </ul>
        $$R_z(30°) = \begin{bmatrix} \cos 30° & -\sin 30° & 0 \\ \sin 30° & \cos 30° & 0 \\ 0 & 0 & 1 \end{bmatrix}$$
        
        <p><strong>为什么 SO(3) 在机器人学中重要</strong>：</p>
        <ol>
          <li><strong>姿态表示</strong>：机器人末端执行器的朝向用 SO(3) 描述</li>
          <li><strong>运动学</strong>：关节链的复合旋转 = SO(3) 群乘法</li>
          <li><strong>逆运动学</strong>：给定目标姿态（SO(3) 元素），求关节角度</li>
          <li><strong>轨迹规划</strong>：在 SO(3) 流形上插值（不能简单地线性插值矩阵！）</li>
        </ol>
        
        <p><strong>达芬奇手术机器人的例子</strong>：</p>
        <ul>
          <li>手术工具的"腕部"有 3 个自由度（pitch、yaw、roll）→ 对应 SO(3)</li>
          <li>外科医生控制台的摇杆输入 → SO(3) 变换 → 机械臂执行</li>
          <li>力反馈：工具受到的力（向量）需要旋转到医生的手柄坐标系 → SO(3) 作用于向量</li>
        </ul>
        
        <p><strong>物理仿真中的应用</strong>：</p>
        <ul>
          <li><strong>刚体动力学</strong>：物体的旋转状态用 SO(3) 表示，角速度在李代数 $\mathfrak{so}(3)$ 中</li>
          <li><strong>碰撞检测</strong>：判断旋转后的物体是否相交</li>
          <li><strong>等变网络</strong>：Graph Network Simulator (GNS) 使用相对位置（SE(3) 不变）预测加速度（SE(3) 等变）</li>
        </ul>
        
        <p><strong>为什么不能直接用欧拉角</strong>：</p>
        <ul>
          <li>欧拉角有<strong>万向锁</strong>（gimbal lock）问题</li>
          <li>不唯一（同一个旋转可以用多组欧拉角表示）</li>
          <li>插值困难（线性插值欧拉角不对应线性旋转）</li>
          <li>SO(3) 矩阵或四元数更稳定可靠</li>
        </ul>
      </div>
    </div>
    
    <div class="qa-pair">
      <div class="question">
        <strong>Q3：什么是李群？为什么它既是群又是流形？</strong>
      </div>
      <div class="answer">
        <p><strong>李群 = 连续对称性的数学表示</strong>：</p>
        <p>既是<strong>群</strong>（有复合运算），又是<strong>光滑流形</strong>（局部像欧几里得空间）。</p>
        
        <p><strong>旋转旋钮的类比</strong>：</p>
        <ul>
          <li>想象一个可以<strong>连续旋转</strong>的音量旋钮（不是离散的档位）</li>
          <li>旋转 $\theta$ 度是一个群元素，可以复合：旋转 30° 再旋转 45° = 旋转 75°</li>
          <li>旋转角度可以<strong>连续变化</strong> → 这就是流形的性质</li>
        </ul>
        
        <p><strong>常见的李群</strong>：</p>
        <table>
          <tr>
            <th>李群</th>
            <th>描述</th>
            <th>维度</th>
            <th>应用</th>
          </tr>
          <tr>
            <td>$(\mathbb{R}^n, +)$</td>
            <td>平移群</td>
            <td>$n$</td>
            <td>卷积神经网络</td>
          </tr>
          <tr>
            <td>SO(2)</td>
            <td>2D 旋转</td>
            <td>1</td>
            <td>转向等变 CNN</td>
          </tr>
          <tr>
            <td>SO(3)</td>
            <td>3D 旋转</td>
            <td>3</td>
            <td>机器人学、分子建模</td>
          </tr>
          <tr>
            <td>SE(3)</td>
            <td>3D 刚体运动</td>
            <td>6</td>
            <td>物理仿真、SLAM</td>
          </tr>
          <tr>
            <td>SU(2)</td>
            <td>单位四元数</td>
            <td>3</td>
            <td>旋转插值（slerp）</td>
          </tr>
        </table>
        
        <p><strong>李代数 = 李群在单位元的切空间</strong>：</p>
        <ul>
          <li>李群：全局的对称变换</li>
          <li>李代数：<strong>无穷小的</strong>对称变换（"速度"）</li>
        </ul>
        <p>对于 SO(3)：</p>
        <ul>
          <li>李群：旋转矩阵 $R \in \mathbb{R}^{3 \times 3}$</li>
          <li>李代数 $\mathfrak{so}(3)$：反对称矩阵（角速度向量的叉乘矩阵）</li>
        </ul>
        $$\omega = \begin{bmatrix} 0 & -\omega_z & \omega_y \\ \omega_z & 0 & -\omega_x \\ -\omega_y & \omega_x & 0 \end{bmatrix} \in \mathfrak{so}(3)$$
        
        <p><strong>指数映射连接二者</strong>：</p>
        $$R = \exp(\omega) = I + \frac{\sin \theta}{\theta} \omega + \frac{1 - \cos \theta}{\theta^2} \omega^2$$
        <p>其中 $\theta = \|\boldsymbol{\omega}\|$（旋转角度）。</p>
        <p>这就是<strong>Rodrigues 公式</strong>——从角速度向量到旋转矩阵的转换。</p>
        
        <p><strong>为什么李代数重要</strong>：</p>
        <ol>
          <li><strong>优化</strong>：在李代数（向量空间）上做梯度下降，然后指数映射回李群</li>
          <li><strong>插值</strong>：两个旋转之间的"最短路径"在李代数中是直线</li>
          <li><strong>微分方程</strong>：刚体的角速度 $\omega(t) \in \mathfrak{so}(3)$，积分得到旋转 $R(t)$</li>
        </ol>
      </div>
    </div>
    
    <div class="qa-pair">
      <div class="question">
        <strong>Q4：什么是齐性空间？球面 $S^2$ 和 SO(3) 有什么关系？</strong>
      </div>
      <div class="answer">
        <p><strong>齐性空间的直观定义</strong>：</p>
        <p>空间中"所有点看起来都一样"——任意两点可以通过群作用联系起来。</p>
        <p>数学：群 $G$ <strong>传递地</strong>（transitively）作用在空间 $\Omega$ 上，即对任意 $u, v \in \Omega$，存在 $g \in G$ 使得 $g \cdot u = v$。</p>
        
        <p><strong>地球表面的类比</strong>：</p>
        <ul>
          <li>地球表面（忽略地形）是一个<strong>完美的球面</strong> $S^2$</li>
          <li>任意两个点（比如北京和纽约）可以通过<strong>旋转地球</strong>使其中一个移到另一个的位置</li>
          <li>旋转群 SO(3) 作用在 $S^2$ 上 → $S^2$ 是 SO(3) 的齐性空间</li>
        </ul>
        
        <p><strong>数学关系</strong>：</p>
        $$S^2 = \text{SO}(3) / \text{SO}(2)$$
        <p>意思是：固定北极点，所有保持北极不动的旋转形成子群 SO(2)（绕 $z$ 轴旋转）。商空间就是球面。</p>
        
        <p><strong>球面卷积的核心思想</strong>：</p>
        <ul>
          <li>在欧几里得空间中，卷积利用<strong>平移对称性</strong>：$x(u + t)$</li>
          <li>在球面上，没有平移！但有<strong>旋转对称性</strong>：$x(g \cdot u)$</li>
          <li>球面卷积定义为"在 SO(3) 上积分"，将信号与旋转后的滤波器匹配</li>
        </ul>
        $$(x \star \psi)(g) = \int_{S^2} x(u) \psi(g^{-1} \cdot u) \, du$$
        
        <p><strong>为什么输出是 SO(3) 上的函数</strong>：</p>
        <ul>
          <li>球面 $S^2$ 有 2 个自由度（经度、纬度）</li>
          <li>SO(3) 有 3 个自由度（3 个欧拉角）</li>
          <li>第一层：$S^2 \to \text{SO}(3)$（增加一个"自旋"维度）</li>
          <li>后续层：$\text{SO}(3) \to \text{SO}(3)$（保持高维特征）</li>
        </ul>
        
        <p><strong>其他齐性空间的例子</strong>：</p>
        <table>
          <tr>
            <th>空间</th>
            <th>群</th>
            <th>商结构</th>
            <th>应用</th>
          </tr>
          <tr>
            <td>$\mathbb{R}^n$</td>
            <td>平移群</td>
            <td>-</td>
            <td>CNN</td>
          </tr>
          <tr>
            <td>$S^2$</td>
            <td>SO(3)</td>
            <td>SO(3)/SO(2)</td>
            <td>全球气候、天文学</td>
          </tr>
          <tr>
            <td>双曲空间</td>
            <td>SO(1,n)</td>
            <td>-</td>
            <td>层次嵌入</td>
          </tr>
          <tr>
            <td>Grassmann 流形</td>
            <td>O(n)</td>
            <td>O(n)/O(k)×O(n-k)</td>
            <td>子空间学习</td>
          </tr>
        </table>
      </div>
    </div>
    
    <div class="qa-pair">
      <div class="question">
        <strong>Q5：群卷积（Group Convolution）是怎么实现的？计算复杂度如何？</strong>
      </div>
      <div class="answer">
        <p><strong>标准卷积 vs 群卷积</strong>：</p>
        <ul>
          <li><strong>标准卷积</strong>：在平移群 $\mathbb{Z}^2$ 上定义</li>
          <li><strong>群卷积</strong>：在任意群 $G$（如旋转群）上定义</li>
        </ul>
        
        <p><strong>群卷积的定义</strong>：</p>
        $$(x \star \psi)(g) = \sum_{h \in G} x(h) \psi(g^{-1}h)$$
        <p>或积分形式（连续群）：</p>
        $$(x \star \psi)(g) = \int_G x(h) \psi(g^{-1}h) \, dh$$
        
        <p><strong>旋转群卷积的实现（G-CNN）</strong>：</p>
        <ol>
          <li><strong>离散化群</strong>：选择 $N$ 个旋转角度（如 $\{0°, 45°, 90°, 135°, 180°, 225°, 270°, 315°\}$）</li>
          <li><strong>第一层</strong>：输入是普通图像 $x : \mathbb{Z}^2 \to \mathbb{R}^c$
            <ul>
              <li>对每个旋转 $r \in \{0°, 45°, \ldots\}$，旋转卷积核 $\psi_r$</li>
              <li>输出 $(x \star \psi)(r) : \mathbb{Z}^2 \times \text{Rot} \to \mathbb{R}^{c'}$</li>
            </ul>
          </li>
          <li><strong>后续层</strong>：输入已经在群上 $x : \mathbb{Z}^2 \times \text{Rot} \to \mathbb{R}^c$
            <ul>
              <li>对每个输出旋转 $r'$，需要在所有输入旋转 $r$ 上聚合</li>
              <li>卷积核 $\psi(r', r)$ 是"相对旋转" $r'^{-1}r$ 的函数</li>
            </ul>
          </li>
        </ol>
        
        <p><strong>计算复杂度</strong>：</p>
        <ul>
          <li><strong>标准 CNN</strong>：$O(HWc c' k^2)$（$H \times W$ 图像，$c$ 输入通道，$c'$ 输出通道，$k$ 卷积核大小）</li>
          <li><strong>G-CNN（第一层）</strong>：$O(HWc c' k^2 |G|)$（多了 $|G|$ 倍，因为要对每个旋转计算）</li>
          <li><strong>G-CNN（后续层）</strong>：$O(HWc c' k^2 |G|^2)$（输入输出都在群上）</li>
        </ul>
        <p>对于 8 个旋转：第一层慢 8 倍，后续层慢 64 倍——这是为等变性付出的代价。</p>
        
        <p><strong>优化技巧</strong>：</p>
        <ol>
          <li><strong>FFT 加速</strong>：旋转卷积可以在傅里叶域高效计算（Harmonic Networks）</li>
          <li><strong>可分离卷积</strong>：分解为空间卷积 + 群卷积</li>
          <li><strong>子采样</strong>：不是所有层都需要全部旋转，可以逐层减少</li>
          <li><strong>共轭对称性</strong>：利用 $\psi(g^{-1}) = \psi(g)^*$ 减少参数</li>
        </ol>
        
        <p><strong>实际应用中的权衡</strong>：</p>
        <ul>
          <li><strong>数据少 + 旋转重要</strong>（医学影像）：G-CNN 值得</li>
          <li><strong>数据多 + 计算受限</strong>（ImageNet）：数据增强可能更实用</li>
          <li><strong>连续旋转</strong>（点云、3D 形状）：必须用等变网络（数据增强无法覆盖连续群）</li>
        </ul>
        
        <p><strong>代码示意（伪代码）</strong>：</p>
        <pre><code>def g_conv(x, psi, rotations):
    """
    x: [H, W, C, |G|] 或 [H, W, C]（第一层）
    psi: [k, k, C, C', |G|] 群卷积核
    """
    outputs = []
    for g_out in rotations:
        response = 0
        for g_in in rotations:  # 第一层只有 identity
            # 相对旋转
            g_rel = g_out.inv() @ g_in
            # 旋转卷积核
            psi_rotated = rotate(psi[:,:,:,:,g_rel], g_rel)
            # 标准卷积
            response += conv2d(x[:,:,:,g_in], psi_rotated)
        outputs.append(response)
    return stack(outputs, axis=-1)
</code></pre>
      </div>
    </div>
  </div>
  
  <div class="enrichment-intuition">
    <h4>🎯 核心直觉</h4>
    <div class="intuition-item">
      <strong>群 = 对称性的代数</strong>
      <p>物理定律、几何形状、数据结构都有对称性。群论提供了统一的语言来描述和利用这些对称性。</p>
    </div>
    <div class="intuition-item">
      <strong>SO(3) = 三维世界的旋转对称</strong>
      <p>无论你怎么转动一个物体，它的物理性质不变。机器人、分子、天文学——凡是涉及 3D 旋转的领域，SO(3) 都是核心。</p>
    </div>
    <div class="intuition-item">
      <strong>齐性空间 = "到处都一样"的空间</strong>
      <p>球面上任何一点都可以成为"北极"（只要旋转地球）。这种均匀性使得我们可以用<strong>群作用</strong>代替平移来定义卷积。</p>
    </div>
    <div class="intuition-item">
      <strong>李群 = 连续对称性</strong>
      <p>不是离散的"旋转 90°"，而是可以旋转<strong>任意角度</strong>。连续性使得可以求导、优化、插值。</p>
    </div>
    <div class="intuition-item">
      <strong>群卷积 = 在所有对称变换上平均</strong>
      <p>不只看"当前朝向"的特征，而是看"所有可能朝向"的特征，然后聚合。这自动实现了旋转等变性。</p>
    </div>
  </div>
  
  <div class="enrichment-application">
    <h4>🚀 应用场景</h4>
    <div class="application-item">
      <strong>医疗影像（细胞分类）</strong>
      <p>显微镜下的细胞可以任意朝向。G-CNN 或 Harmonic Networks 可以学习旋转不变的细胞形态特征，无需旋转数据增强。</p>
    </div>
    <div class="application-item">
      <strong>机器人抓取</strong>
      <p>从 RGB-D 图像预测抓取姿态（SE(3) 变换）。网络需要 SE(3) 等变：旋转物体 → 抓取方向也旋转。VN-Networks、SE(3)-Transformers 是常用方法。</p>
    </div>
    <div class="application-item">
      <strong>分子性质预测（药物发现）</strong>
      <p>分子的能量、偶极矩等性质应该对 SE(3) 不变（旋转平移分子不改变化学性质）。SchNet、DimeNet 使用 SE(3) 等变图神经网络。</p>
    </div>
    <div class="application-item">
      <strong>全球气候建模</strong>
      <p>地球表面是球面 $S^2$。天气数据（温度、湿度、风速）定义在球面上。球谐卷积（Spherical CNNs）保持旋转等变性，避免极点附近的奇异性。</p>
    </div>
    <div class="application-item">
      <strong>天文学（星系分类）</strong>
      <p>星系图像的朝向是随机的。使用旋转等变网络可以更准确地分类螺旋星系、椭圆星系等，且参数效率更高。</p>
    </div>
    <div class="application-item">
      <strong>物理仿真（刚体动力学）</strong>
      <p>GNS 中的粒子系统：相对位置是 SE(3) 不变的输入，加速度是 SE(3) 等变的输出。网络自动学习牛顿定律的等变性。</p>
    </div>
  </div>
</div>

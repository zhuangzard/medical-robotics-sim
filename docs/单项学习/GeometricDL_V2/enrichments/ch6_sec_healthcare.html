<div class="enrichment-block">
  <div class="enrichment-qa">
    <h4>🔍 深入理解：为什么大脑网络要用 GNN？脑影像不是 3D 图像吗？</h4>
    <div class="qa-pair">
      <p class="question">❓ 小白：fMRI 得到的不是 3D 体素数据吗？为什么不直接用 3D CNN，而要构建"脑网络"用 GNN？</p>
      <div class="answer">
        <p>💡 专家：这是一个关键的视角差异！确实有两种表示方式：</p>
        <table>
          <thead>
            <tr><th>表示方式</th><th>输入</th><th>架构</th><th>优势</th><th>劣势</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>体素级</strong></td>
              <td>3D 体素（voxels）</td>
              <td>3D CNN</td>
              <td>保留完整空间信息</td>
              <td>数据量大（100³ 体素），难训练</td>
            </tr>
            <tr>
              <td><strong>脑网络</strong></td>
              <td>脑区连接图</td>
              <td>GNN</td>
              <td>捕捉<strong>功能连接</strong>，参数少</td>
              <td>需要先分区（parcellation）</td>
            </tr>
          </tbody>
        </table>
        <p><strong>为什么脑网络更有意义</strong>：</p>
        <ol>
          <li><strong>神经科学视角</strong>：大脑的功能不是"这个体素"，而是"这个脑区（包含几千个神经元）"。比如：
            <ul>
              <li>V1 视觉皮层（处理边缘）</li>
              <li>海马体（记忆）</li>
              <li>前额叶（决策）</li>
            </ul>
          </li>
          <li><strong>fMRI 的本质</strong>：测量的是血氧水平（BOLD 信号）→ 反映神经活动 → 关键信息是"哪些脑区<strong>同步激活</strong>"（功能连接）而不是精确坐标</li>
          <li><strong>降维</strong>：从 ~100,000 体素 → ~100 脑区 → 图节点数可控</li>
        </ol>
        <p><strong>如何构建脑网络</strong>：</p>
        <div class="math-block">
          1. 分区（Parcellation）：根据解剖图谱（如 AAL、Desikan-Killiany）将大脑分为 N 个区域<br>
          2. 提取信号：每个区域的平均 BOLD 信号时间序列 $\{x_i(t)\}_{t=1}^T$<br>
          3. 计算连接：相关性 $w_{ij} = \text{corr}(x_i, x_j)$ 或偏相关<br>
          4. 构建图：节点 = 脑区，边权重 = $|w_{ij}|$（阈值化或保留 top-K）
        </div>
        <p><strong>GNN 能做什么</strong>：</p>
        <ul>
          <li><strong>疾病诊断</strong>：自闭症、阿尔茨海默症的脑网络拓扑特征不同 → GNN 分类</li>
          <li><strong>年龄/性别预测</strong>：脑网络随年龄变化（"大脑年龄"）</li>
          <li><strong>脑区功能预测</strong>：根据连接模式推断某个脑区的功能</li>
        </ul>
      </div>
    </div>
    <div class="qa-pair">
      <p class="question">❓ 小白：书上说"联合利用几何和功能结构"，这两者有什么区别？</p>
      <div class="answer">
        <p>💡 专家：这是脑科学的两个核心维度：</p>
        <table>
          <thead>
            <tr><th>维度</th><th>含义</th><th>数据来源</th><th>GDL 域</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>几何结构</strong></td>
              <td>大脑的<strong>物理形状</strong>：皮层褶皱、白质纤维束</td>
              <td>结构 MRI（sMRI）、DTI（弥散张量成像）</td>
              <td><strong>流形</strong>（皮层是 2D 曲面）</td>
            </tr>
            <tr>
              <td><strong>功能结构</strong></td>
              <td>脑区之间的<strong>功能连接</strong>：谁和谁一起激活</td>
              <td>功能 MRI（fMRI）、EEG/MEG</td>
              <td><strong>图</strong>（脑区连接网络）</td>
            </tr>
          </tbody>
        </table>
        <p><strong>为什么要联合</strong>：</p>
        <ul>
          <li><strong>几何约束功能</strong>：物理上相邻的脑区更可能有功能连接（但不总是！）</li>
          <li><strong>功能塑造几何</strong>：大脑皮层的褶皱模式部分由功能区的发育决定</li>
          <li><strong>疾病同时影响两者</strong>：阿尔茨海默症 → 海马体萎缩（几何）+ 记忆网络断裂（功能）</li>
        </ul>
        <p><strong>Itani & Thanou (2021) 的方法</strong>：</p>
        <ol>
          <li><strong>几何编码</strong>：用 MeshCNN 提取皮层表面特征（曲率、厚度、表面积）</li>
          <li><strong>功能编码</strong>：用 GCN 处理功能连接图</li>
          <li><strong>融合</strong>：多视图学习（geometric view + functional view）→ 联合嵌入 → 分类</li>
        </ol>
        <p><strong>结果</strong>：比单独用几何或功能，分类准确率提升 ~10%（如 ASD 诊断）。</p>
      </div>
    </div>
    <div class="qa-pair">
      <p class="question">❓ 小白：EHR（电子健康记录）怎么变成图？不是表格数据吗？</p>
      <div class="answer">
        <p>💡 专家：EHR 确实初看是表格（患者 ID、诊断代码、用药、检查结果），但隐藏着丰富的<strong>关系结构</strong>：</p>
        <p><strong>三种图构建方法</strong>：</p>
        <ol>
          <li><strong>患者相似性图</strong>（Rocheteau et al., 2021）：
            <ul>
              <li>节点 = 患者</li>
              <li>边 = 相似度（比如"诊断重叠度 &gt; 阈值"）</li>
              <li>边权重 = Jaccard 相似度 $\frac{|D_i \cap D_j|}{|D_i \cup D_j|}$（$D_i$ 是患者 i 的诊断集合）</li>
            </ul>
          </li>
          <li><strong>医学知识图谱</strong>（Malone et al., 2018）：
            <ul>
              <li>节点 = 患者、疾病、药物、症状、检查项目</li>
              <li>边 = "患者有疾病"、"疾病需要检查"、"药物治疗疾病"</li>
              <li>异构图（多种节点和边类型）</li>
            </ul>
          </li>
          <li><strong>全连接图 + 学习连接</strong>（Zhu & Razavian, 2019）：
            <ul>
              <li>假设所有患者都可能相关（全连接）</li>
              <li>GNN 学习<strong>注意力权重</strong> → 哪些患者真正相关</li>
              <li>类似 Transformer 的自注意力</li>
            </ul>
          </li>
        </ol>
        <p><strong>GNN 在 EHR 上的任务</strong>：</p>
        <ul>
          <li><strong>住院时长预测</strong>：根据入院时的病历，预测需要住几天</li>
          <li><strong>再入院风险</strong>：出院后 30 天内是否会再次入院</li>
          <li><strong>死亡率预测</strong>：ICU 患者的 48 小时死亡风险</li>
          <li><strong>诊断辅助</strong>：根据症状 + 相似患者的确诊 → 推荐可能的诊断</li>
        </ul>
        <p><strong>为什么 GNN 比传统 ML 好</strong>：</p>
        <ul>
          <li>传统方法（XGBoost）：每个患者独立处理 → 忽略了"相似患者的预后可能类似"</li>
          <li>GNN 方法：聚合相似患者的信息 → 类似"参考病例"的思维</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="enrichment-intuition">
    <h4>🎯 直觉理解：脑网络 = 社交网络的生物版</h4>
    <p><strong>类比</strong>：</p>
    <ul>
      <li><strong>脑区</strong> = Facebook 上的人（节点）</li>
      <li><strong>功能连接</strong> = 谁和谁经常互动（边）</li>
      <li><strong>同步激活</strong> = "你发了个状态，你的朋友立刻点赞"（相关性高）</li>
    </ul>
    <p><strong>正常大脑 vs 疾病大脑</strong>：</p>
    <ul>
      <li><strong>正常</strong>："朋友圈"结构合理（小世界网络）——有紧密社群，但社群间也有连接</li>
      <li><strong>自闭症</strong>：社群内连接<strong>过强</strong>（局部过度连接）+ 社群间连接<strong>过弱</strong>（远程欠连接）→ 信息难跨区传播</li>
      <li><strong>精神分裂</strong>：连接<strong>过于随机</strong>（失去小世界结构）→ 类比"朋友圈乱了"</li>
      <li><strong>阿尔茨海默</strong>：<strong>连接断裂</strong>（特别是海马体-皮层）→ 类比"关键好友失联"</li>
    </ul>
    <p><strong>GNN 能做什么</strong>：</p>
    <ol>
      <li>学习"健康大脑"的网络模式（拓扑特征）</li>
      <li>检测哪些患者的网络"偏离正常"</li>
      <li>定位"哪些连接异常"（可解释性 → 辅助诊断）</li>
    </ol>
  </div>

  <div class="enrichment-application">
    <h4>🏥 医疗机器人应用：手术风险预测的多模态融合</h4>
    <p><strong>场景</strong>：术前评估——根据患者的多模态数据（影像、病历、生理信号），预测手术风险。</p>
    <p><strong>数据来源</strong>：</p>
    <ul>
      <li><strong>CT/MRI</strong>：器官形态、肿瘤大小（几何数据）</li>
      <li><strong>EHR</strong>：既往病史、用药、实验室检查（表格数据）</li>
      <li><strong>生理信号</strong>：心电、血压时间序列</li>
      <li><strong>医学知识图谱</strong>：疾病-药物-症状的关系</li>
    </ul>
    <p><strong>GDL 多模态融合架构</strong>：</p>
    <ol>
      <li><strong>影像编码</strong>：
        <ul>
          <li>CT → 3D CNN 提取肿瘤特征</li>
          <li>器官分割网格 → MeshCNN 提取形状特征</li>
        </ul>
      </li>
      <li><strong>EHR 图编码</strong>：
        <ul>
          <li>构建患者相似性图（"有相似病史的患者"）</li>
          <li>GNN 聚合相似患者的手术结果</li>
        </ul>
      </li>
      <li><strong>知识图谱推理</strong>：
        <ul>
          <li>患者的诊断 → 在知识图谱上查询"相关并发症"</li>
          <li>RGCN（Relational GCN）推理风险因素</li>
        </ul>
      </li>
      <li><strong>时序信号</strong>：
        <ul>
          <li>术前 24 小时生理信号 → LSTM 编码</li>
        </ul>
      </li>
      <li><strong>融合与预测</strong>：
        <ul>
          <li>多视图嵌入拼接 → MLP 分类器</li>
          <li>输出：并发症风险评分 + 可解释性（哪些因素贡献最大）</li>
        </ul>
      </li>
    </ol>
    <p><strong>优势</strong>：</p>
    <ul>
      <li>传统方法：只用 EHR 表格特征 → 忽略影像和相似患者信息</li>
      <li>GDL 方法：<strong>异构图</strong> + <strong>多模态</strong> → 全面评估</li>
    </ul>
    <p><strong>PhysRobot 连接</strong>：</p>
    <ul>
      <li>仿真预测手术操作的物理后果（"如果在这里切开，出血量是多少"）</li>
      <li>仿真结果作为<strong>额外特征</strong>输入风险评估模型</li>
    </ul>
  </div>

  <div class="enrichment-qa">
    <h4>🔍 补充：为什么医疗数据适合用图？</h4>
    <div class="qa-pair">
      <p class="question">❓ 小白：感觉医疗数据用图有点"强行"——表格、图像、时间序列都有现成方法，为什么一定要转成图？</p>
      <div class="answer">
        <p>💡 专家：不是"强行"，而是医疗数据<strong>天然包含关系</strong>：</p>
        <table>
          <thead>
            <tr><th>数据类型</th><th>隐含关系</th><th>图表示的优势</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>患者记录</strong></td>
              <td>相似患者、共病模式</td>
              <td>利用"参考病例"经验</td>
            </tr>
            <tr>
              <td><strong>脑影像</strong></td>
              <td>脑区功能连接</td>
              <td>建模<strong>网络疾病</strong>（非局部病变）</td>
            </tr>
            <tr>
              <td><strong>分子/药物</strong></td>
              <td>化学键、药物相互作用</td>
              <td>预测副作用、药物重定位</td>
            </tr>
            <tr>
              <td><strong>医学知识</strong></td>
              <td>疾病-症状-治疗</td>
              <td>推理（"如果 A 和 B,那么可能 C"）</td>
            </tr>
          </tbody>
        </table>
        <p><strong>图的核心优势：建模多元关系</strong></p>
        <p>传统 ML：</p>
        <div class="math-block">
          输入特征 $\mathbf{x}$ → 模型 $f$ → 输出 $y$<br>
          假设样本<strong>独立同分布</strong>（i.i.d.）
        </div>
        <p>GNN：</p>
        <div class="math-block">
          输入特征 $\mathbf{x}_i$ + 邻居 $\{\mathbf{x}_j : j \in \mathcal{N}(i)\}$ → GNN → 输出 $y_i$<br>
          打破 i.i.d. 假设，利用<strong>关系信息</strong>
        </div>
        <p><strong>医学直觉</strong>：</p>
        <ul>
          <li>医生诊断时不是只看"当前患者"，而是会想"之前见过类似的病例"（患者相似性图）</li>
          <li>理解疾病需要知道"哪些器官/系统受影响"（疾病网络）</li>
          <li>药物治疗要考虑"药物之间是否冲突"（药物相互作用图）</li>
        </ul>
        <p>GNN 是把这些<strong>医学推理模式</strong>形式化的自然方式。</p>
      </div>
    </div>
  </div>
</div>

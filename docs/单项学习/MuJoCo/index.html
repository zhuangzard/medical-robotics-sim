<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MuJoCo ç‰©ç†å¼•æ“å®Œå…¨å­¦ä¹ æ•™ç¨‹</title>

<!-- KaTeX for math -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
  onload="renderMathInElement(document.body, {delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false}]})"></script>

<!-- highlight.js for code -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-dark.min.css" id="hljs-dark">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/atom-one-light.min.css" id="hljs-light" disabled>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/python.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/xml.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/bash.min.js"></script>

<style>
/* ============================================================
   CSS Variables â€” Light / Dark Theme
   ============================================================ */
:root {
  --bg: #ffffff;
  --bg-secondary: #f6f8fa;
  --bg-sidebar: #f0f2f5;
  --text: #1a1a2e;
  --text-secondary: #555;
  --text-muted: #888;
  --border: #e0e0e0;
  --accent: #2563eb;
  --accent-hover: #1d4ed8;
  --code-bg: #f4f4f8;
  --shadow: rgba(0,0,0,0.05);
  --box-def-bg: #e8f0fe;
  --box-def-border: #2563eb;
  --box-thm-bg: #e6f9e6;
  --box-thm-border: #16a34a;
  --box-ex-bg: #fff8e1;
  --box-ex-border: #f59e0b;
  --box-warn-bg: #fee2e2;
  --box-warn-border: #dc2626;
  --toc-active: #2563eb;
  --link: #2563eb;
  --sidebar-width: 280px;
  --header-height: 56px;
}

[data-theme="dark"] {
  --bg: #0f172a;
  --bg-secondary: #1e293b;
  --bg-sidebar: #151d30;
  --text: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --border: #334155;
  --accent: #60a5fa;
  --accent-hover: #93bbfd;
  --code-bg: #1e293b;
  --shadow: rgba(0,0,0,0.3);
  --box-def-bg: #172554;
  --box-def-border: #3b82f6;
  --box-thm-bg: #052e16;
  --box-thm-border: #22c55e;
  --box-ex-bg: #422006;
  --box-ex-border: #f59e0b;
  --box-warn-bg: #450a0a;
  --box-warn-border: #ef4444;
  --toc-active: #60a5fa;
  --link: #60a5fa;
}

/* ============================================================
   Reset & Base
   ============================================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { scroll-behavior: smooth; scroll-padding-top: calc(var(--header-height) + 16px); }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.8;
  transition: background 0.3s, color 0.3s;
}

/* ============================================================
   Header
   ============================================================ */
.site-header {
  position: fixed; top: 0; left: 0; right: 0;
  height: var(--header-height);
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 24px; z-index: 1000;
  backdrop-filter: blur(10px);
}
.site-header h1 {
  font-size: 1.15rem; font-weight: 700;
  background: linear-gradient(135deg, var(--accent), #a78bfa);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.header-controls { display: flex; gap: 12px; align-items: center; }
.theme-toggle {
  background: none; border: 1px solid var(--border); border-radius: 8px;
  padding: 6px 14px; cursor: pointer; color: var(--text); font-size: 0.85rem;
  transition: all 0.2s;
}
.theme-toggle:hover { border-color: var(--accent); color: var(--accent); }
.menu-toggle {
  display: none; background: none; border: none; font-size: 1.4rem;
  cursor: pointer; color: var(--text);
}

/* ============================================================
   Sidebar
   ============================================================ */
.sidebar {
  position: fixed; top: var(--header-height); left: 0;
  width: var(--sidebar-width); height: calc(100vh - var(--header-height));
  background: var(--bg-sidebar); border-right: 1px solid var(--border);
  overflow-y: auto; padding: 20px 0; z-index: 900;
  transition: transform 0.3s;
}
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

.sidebar .toc-title {
  font-size: 0.75rem; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.08em; color: var(--text-muted); padding: 0 20px; margin-bottom: 10px;
}
.sidebar ul { list-style: none; }
.sidebar > ul > li { margin-bottom: 4px; }
.sidebar a {
  display: block; padding: 5px 20px; font-size: 0.82rem; color: var(--text-secondary);
  text-decoration: none; border-left: 3px solid transparent; transition: all 0.2s;
}
.sidebar a:hover { color: var(--accent); background: rgba(37,99,235,0.05); }
.sidebar a.active {
  color: var(--toc-active); border-left-color: var(--toc-active);
  background: rgba(37,99,235,0.08); font-weight: 600;
}
.sidebar .chapter-title {
  font-weight: 700; font-size: 0.85rem; color: var(--text);
  padding: 10px 20px 5px; margin-top: 6px;
}
.sidebar .sub-list a { padding-left: 36px; font-size: 0.78rem; }

/* ============================================================
   Main Content
   ============================================================ */
.main-content {
  margin-left: var(--sidebar-width); margin-top: var(--header-height);
  padding: 40px 60px 120px;
  max-width: 920px;
}

h2 {
  font-size: 1.8rem; font-weight: 800; margin: 60px 0 20px;
  padding-bottom: 10px; border-bottom: 2px solid var(--border);
  color: var(--text);
}
h2:first-of-type { margin-top: 0; }
h3 { font-size: 1.25rem; font-weight: 700; margin: 36px 0 14px; color: var(--text); }
h4 { font-size: 1.05rem; font-weight: 600; margin: 24px 0 10px; color: var(--text-secondary); }

p { margin: 12px 0; }
a { color: var(--link); text-decoration: none; }
a:hover { text-decoration: underline; }

ul, ol { margin: 10px 0 10px 24px; }
li { margin: 4px 0; }

img { max-width: 100%; border-radius: 8px; }

/* ============================================================
   Code Blocks
   ============================================================ */
pre {
  background: var(--code-bg); border: 1px solid var(--border);
  border-radius: 8px; padding: 16px 20px; overflow-x: auto;
  margin: 16px 0; font-size: 0.85rem; line-height: 1.6;
  position: relative;
}
pre code { background: none; padding: 0; font-size: inherit; }
code {
  background: var(--code-bg); padding: 2px 6px; border-radius: 4px;
  font-size: 0.88em; font-family: "Fira Code", "SF Mono", "Menlo", monospace;
}
.code-label {
  position: absolute; top: 8px; right: 12px; font-size: 0.7rem;
  color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;
  font-family: sans-serif;
}

/* ============================================================
   Highlight Boxes
   ============================================================ */
.box {
  border-left: 4px solid; border-radius: 0 8px 8px 0;
  padding: 16px 20px; margin: 20px 0;
}
.box-title {
  font-weight: 700; margin-bottom: 6px; font-size: 0.95rem;
  display: flex; align-items: center; gap: 6px;
}
.box.def  { background: var(--box-def-bg); border-color: var(--box-def-border); }
.box.thm  { background: var(--box-thm-bg); border-color: var(--box-thm-border); }
.box.ex   { background: var(--box-ex-bg);  border-color: var(--box-ex-border); }
.box.warn { background: var(--box-warn-bg); border-color: var(--box-warn-border); }

/* ============================================================
   Tables
   ============================================================ */
table {
  width: 100%; border-collapse: collapse; margin: 16px 0;
  font-size: 0.88rem;
}
th, td {
  border: 1px solid var(--border); padding: 10px 14px; text-align: left;
}
th { background: var(--bg-secondary); font-weight: 600; }
tr:nth-child(even) { background: var(--bg-secondary); }

/* ============================================================
   Responsive
   ============================================================ */
@media (max-width: 900px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main-content { margin-left: 0; padding: 24px 20px 100px; }
  .menu-toggle { display: block; }
}

/* ============================================================
   Print
   ============================================================ */
@media print {
  .site-header, .sidebar, .theme-toggle, .menu-toggle { display: none !important; }
  .main-content { margin-left: 0; padding: 0; }
}

/* ============================================================
   Utilities
   ============================================================ */
.muted { color: var(--text-muted); }
.small { font-size: 0.85rem; }
.center { text-align: center; }
.mt-0 { margin-top: 0; }

/* diagram */
.diagram {
  background: var(--bg-secondary); border: 1px solid var(--border);
  border-radius: 8px; padding: 20px; margin: 20px 0;
  font-family: "Fira Code", monospace; font-size: 0.82rem;
  line-height: 1.5; overflow-x: auto; white-space: pre;
}

/* back to top */
.back-top {
  position: fixed; bottom: 30px; right: 30px;
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--accent); color: #fff; border: none;
  font-size: 1.2rem; cursor: pointer; opacity: 0;
  transition: opacity 0.3s; z-index: 800;
  display: flex; align-items: center; justify-content: center;
}
.back-top.show { opacity: 1; }

/* progress bar */
.progress-bar {
  position: fixed; top: var(--header-height); left: 0;
  height: 3px; background: linear-gradient(90deg, var(--accent), #a78bfa);
  z-index: 999; transition: width 0.1s;
}
</style>
</head>
<body data-theme="dark">

<!-- Progress bar -->
<div class="progress-bar" id="progressBar" style="width:0%"></div>

<!-- Header -->
<header class="site-header">
  <div style="display:flex;align-items:center;gap:12px;">
    <button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">â˜°</button>
    <h1>ğŸ¤– MuJoCo ç‰©ç†å¼•æ“å®Œå…¨å­¦ä¹ æ•™ç¨‹</h1>
  </div>
  <div class="header-controls">
    <span class="muted small" id="readingTime"></span>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
  </div>
</header>

<!-- Sidebar -->
<nav class="sidebar" id="sidebar">
  <div class="toc-title">ğŸ“‘ ç›®å½•å¯¼èˆª</div>
  <ul>
    <li><a href="#intro">å¼•è¨€ï¼šä¸ºä»€ä¹ˆè¦å­¦ MuJoCo</a></li>

    <li class="chapter-title">ç¬¬ä¸€ç« ï¼šç‰©ç†ä»¿çœŸåŸºç¡€</li>
    <ul class="sub-list">
      <li><a href="#ch1-what">1.1 ä»€ä¹ˆæ˜¯ç‰©ç†ä»¿çœŸ</a></li>
      <li><a href="#ch1-compare">1.2 ç‰©ç†å¼•æ“å¯¹æ¯”</a></li>
      <li><a href="#ch1-why-mujoco">1.3 MuJoCo çš„ä¼˜åŠ¿</a></li>
      <li><a href="#ch1-install">1.4 å®‰è£…å’Œé…ç½®</a></li>
    </ul>

    <li class="chapter-title">ç¬¬äºŒç« ï¼šæ ¸å¿ƒæ¦‚å¿µ</li>
    <ul class="sub-list">
      <li><a href="#ch2-mjcf">2.1 MJCF æ¨¡å‹è¯­è¨€</a></li>
      <li><a href="#ch2-mjmodel">2.2 MjModel é™æ€æ¨¡å‹</a></li>
      <li><a href="#ch2-mjdata">2.3 MjData åŠ¨æ€æ•°æ®</a></li>
      <li><a href="#ch2-step">2.4 ä»¿çœŸå¾ªç¯ mj_step()</a></li>
      <li><a href="#ch2-timestep">2.5 æ—¶é—´æ­¥é•¿</a></li>
      <li><a href="#ch2-integrator">2.6 ç§¯åˆ†å™¨</a></li>
    </ul>

    <li class="chapter-title">ç¬¬ä¸‰ç« ï¼šMJCF XML å®Œå…¨æŒ‡å—</li>
    <ul class="sub-list">
      <li><a href="#ch3-root">3.1 æ ¹å…ƒç´ ä¸ compiler</a></li>
      <li><a href="#ch3-option">3.2 option ä»¿çœŸé€‰é¡¹</a></li>
      <li><a href="#ch3-visual">3.3 visual æ¸²æŸ“è®¾ç½®</a></li>
      <li><a href="#ch3-asset">3.4 asset èµ„äº§ç³»ç»Ÿ</a></li>
      <li><a href="#ch3-default">3.5 default é»˜è®¤å‚æ•°</a></li>
      <li><a href="#ch3-worldbody">3.6 worldbody ç‰©ä½“å±‚æ¬¡</a></li>
      <li><a href="#ch3-actuator">3.7 actuator æ‰§è¡Œå™¨</a></li>
      <li><a href="#ch3-sensor">3.8 sensor ä¼ æ„Ÿå™¨</a></li>
      <li><a href="#ch3-full">3.9 å®Œæ•´ XML è§£è¯»</a></li>
    </ul>

    <li class="chapter-title">ç¬¬å››ç« ï¼šPython API</li>
    <ul class="sub-list">
      <li><a href="#ch4-load">4.1 æ¨¡å‹åŠ è½½</a></li>
      <li><a href="#ch4-data">4.2 æ•°æ®è®¿é—®</a></li>
      <li><a href="#ch4-name2id">4.3 åç§°åˆ° ID</a></li>
      <li><a href="#ch4-sim">4.4 ä»¿çœŸæ­¥è¿›</a></li>
      <li><a href="#ch4-collision">4.5 ç¢°æ’æ£€æµ‹</a></li>
      <li><a href="#ch4-render">4.6 æ¸²æŸ“</a></li>
    </ul>

    <li class="chapter-title">ç¬¬äº”ç« ï¼šæœºå™¨äººå»ºæ¨¡</li>
    <ul class="sub-list">
      <li><a href="#ch5-chain">5.1 å…³èŠ‚é“¾å»ºæ¨¡</a></li>
      <li><a href="#ch5-2dof">5.2 2-DOF æœºæ¢°è‡‚</a></li>
      <li><a href="#ch5-freebody">5.3 è‡ªç”±ä½“ freejoint</a></li>
      <li><a href="#ch5-contact">5.4 æ¥è§¦ç‰©ç†</a></li>
      <li><a href="#ch5-inertia">5.5 è´¨é‡ä¸æƒ¯æ€§</a></li>
    </ul>

    <li class="chapter-title">ç¬¬å…­ç« ï¼šGymnasium å°è£…</li>
    <ul class="sub-list">
      <li><a href="#ch6-interface">6.1 gym.Env æ¥å£</a></li>
      <li><a href="#ch6-obs">6.2 è§‚å¯Ÿç©ºé—´è®¾è®¡</a></li>
      <li><a href="#ch6-action">6.3 åŠ¨ä½œç©ºé—´è®¾è®¡</a></li>
      <li><a href="#ch6-reward">6.4 å¥–åŠ±å‡½æ•°è®¾è®¡</a></li>
      <li><a href="#ch6-term">6.5 ç»ˆæ­¢æ¡ä»¶</a></li>
      <li><a href="#ch6-vec">6.6 å¹¶è¡Œç¯å¢ƒ</a></li>
      <li><a href="#ch6-debug">6.7 ç¯å¢ƒè°ƒè¯•</a></li>
    </ul>

    <li class="chapter-title">ç¬¬ä¸ƒç« ï¼šé«˜çº§ä¸»é¢˜</li>
    <ul class="sub-list">
      <li><a href="#ch7-flex">7.1 è½¯ä½“ä»¿çœŸ</a></li>
      <li><a href="#ch7-tendon">7.2 è‚Œè…± Tendon</a></li>
      <li><a href="#ch7-sensor">7.3 ä¼ æ„Ÿå™¨ç³»ç»Ÿ</a></li>
      <li><a href="#ch7-dr">7.4 åŸŸéšæœºåŒ–</a></li>
      <li><a href="#ch7-parallel">7.5 å¹¶è¡Œä»¿çœŸ</a></li>
      <li><a href="#ch7-sim2real">7.6 Sim-to-Real</a></li>
      <li><a href="#ch7-medical">7.7 åŒ»ç–—æœºå™¨äººä»¿çœŸ</a></li>
    </ul>

    <li class="chapter-title">ç¬¬å…«ç« ï¼šå®è·µ</li>
    <ul class="sub-list">
      <li><a href="#ch8-scratch">8.1 ä»é›¶åˆ›å»ºåœºæ™¯</a></li>
      <li><a href="#ch8-viewer">8.2 å¯è§†åŒ–ä¸è°ƒè¯•</a></li>
      <li><a href="#ch8-experiment">8.3 ç‰©ç†å‚æ•°å®éªŒ</a></li>
      <li><a href="#ch8-new-env">8.4 æ„å»ºæ–°ç¯å¢ƒ</a></li>
    </ul>

    <li class="chapter-title">é™„å½•</li>
    <ul class="sub-list">
      <li><a href="#appendix-xml">A. XML æ ‡ç­¾é€ŸæŸ¥</a></li>
      <li><a href="#appendix-api">B. Python API é€ŸæŸ¥</a></li>
      <li><a href="#appendix-errors">C. å¸¸è§é”™è¯¯</a></li>
      <li><a href="#appendix-links">D. å®˜æ–¹é“¾æ¥</a></li>
    </ul>
  </ul>
</nav>

<!-- Main Content -->
<main class="main-content">

<!-- ================================================================== -->
<!-- å¼•è¨€                                                                -->
<!-- ================================================================== -->
<h2 id="intro">å¼•è¨€ï¼šä¸ºä»€ä¹ˆè¦å­¦ MuJoCo</h2>

<p>æ¬¢è¿æ¥åˆ° <strong>MuJoCoï¼ˆMulti-Joint dynamics with Contactï¼‰</strong>å®Œå…¨å­¦ä¹ æ•™ç¨‹ï¼æœ¬æ•™ç¨‹å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œæ·±å…¥ç†è§£è¿™ä¸ªè¢« DeepMindã€OpenAIã€UC Berkeley ç­‰é¡¶çº§æœºæ„å¹¿æ³›ä½¿ç”¨çš„ç‰©ç†ä»¿çœŸå¼•æ“ã€‚</p>

<p>æˆ‘ä»¬ä¸åšç©ºæ´çš„æ¦‚å¿µç½—åˆ—ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ª<strong>çœŸå®çš„é¡¹ç›®</strong>è´¯ç©¿å§‹ç»ˆï¼š<strong>PushBox â€” ä¸€ä¸ª 2-DOF æœºæ¢°è‡‚æ¨ç®±å­çš„å¼ºåŒ–å­¦ä¹ ç¯å¢ƒ</strong>ã€‚è¿™æ˜¯æˆ‘ä»¬åŒ»ç–—æœºå™¨äººä»¿çœŸé¡¹ç›®çš„ç¬¬ä¸€æ­¥ï¼Œä½ å°†çœ‹åˆ°æ¯ä¸ª MuJoCo æ¦‚å¿µå¦‚ä½•åœ¨å®é™…ä»£ç ä¸­è½åœ°ã€‚</p>

<div class="box def">
  <div class="box-title">ğŸ’¡ æœ¬æ•™ç¨‹çš„ç›®æ ‡è¯»è€…</div>
  <ul>
    <li>æœ‰ä¸€å®š Python åŸºç¡€çš„å·¥ç¨‹å¸ˆæˆ–ç ”ç©¶ç”Ÿ</li>
    <li>æƒ³ç”¨ MuJoCo åšæœºå™¨äººä»¿çœŸ + å¼ºåŒ–å­¦ä¹ ç ”ç©¶</li>
    <li>å¸Œæœ›ç†è§£åº•å±‚åŸç†è€Œä¸æ˜¯åªä¼šè°ƒ API</li>
    <li>æœªæ¥æƒ³åš sim-to-realï¼ˆä»¿çœŸåˆ°ç°å®è¿ç§»ï¼‰</li>
  </ul>
</div>

<div class="box ex">
  <div class="box-title">ğŸ¯ PushBox ä»»åŠ¡ç®€ä»‹</div>
  <p>ä¸€ä¸ªå›ºå®šåœ¨æ¡Œé¢ä¸Šçš„ 2 è‡ªç”±åº¦æœºæ¢°è‡‚ï¼ˆshoulder + elbowï¼‰ï¼Œéœ€è¦é€šè¿‡æ–½åŠ å…³èŠ‚åŠ›çŸ©æ¥æ¨åŠ¨ä¸€ä¸ªç»¿è‰²æ–¹å—åˆ°è¾¾çº¢è‰²ç›®æ ‡ä½ç½®ã€‚</p>
  <ul>
    <li><strong>æœºæ¢°è‡‚</strong>ï¼š2 ä¸ªé“°é“¾å…³èŠ‚ï¼Œä¸Šè‡‚ 0.4m + å‰è‡‚ 0.3mï¼Œæ€»è‡‚å±• 0.7m</li>
    <li><strong>ç®±å­</strong>ï¼š0.1mÃ—0.1mÃ—0.1m çš„æ–¹å—ï¼Œè´¨é‡ 0.5kgï¼Œå…·æœ‰ 6-DOF è‡ªç”±åº¦</li>
    <li><strong>ç›®æ ‡</strong>ï¼šä½äº (0.5, 0.3) çš„çº¢è‰²åŠé€æ˜çƒä½“æ ‡è®°</li>
    <li><strong>æ§åˆ¶</strong>ï¼š2 ç»´è¿ç»­åŠ›çŸ©æ§åˆ¶ [-10, 10] Nm</li>
  </ul>
</div>


<!-- ================================================================== -->
<!-- ç¬¬ä¸€ç« ï¼šç‰©ç†ä»¿çœŸåŸºç¡€                                                  -->
<!-- ================================================================== -->
<h2 id="ch1">ç¬¬ä¸€ç« ï¼šç‰©ç†ä»¿çœŸåŸºç¡€</h2>

<h3 id="ch1-what">1.1 ä»€ä¹ˆæ˜¯ç‰©ç†ä»¿çœŸï¼Ÿä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨çœŸå®æœºå™¨äººï¼Ÿ</h3>

<p>ç‰©ç†ä»¿çœŸï¼ˆPhysics Simulationï¼‰æ˜¯åœ¨è®¡ç®—æœºä¸­æ¨¡æ‹ŸçœŸå®ä¸–ç•Œç‰©ç†è§„å¾‹çš„è¿‡ç¨‹ã€‚å®ƒéœ€è¦è§£ç­”ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š<strong>ç»™å®šç‰©ä½“çš„å½“å‰çŠ¶æ€ï¼ˆä½ç½®ã€é€Ÿåº¦ï¼‰å’Œå¤–åŠ›ï¼Œä¸‹ä¸€æ—¶åˆ»ç‰©ä½“ä¼šåœ¨å“ªé‡Œï¼Ÿ</strong></p>

<div class="box def">
  <div class="box-title">ğŸ“ å®šä¹‰ï¼šç‰©ç†ä»¿çœŸ</div>
  <p>ç‰©ç†ä»¿çœŸæ˜¯ä¸€ä¸ªç¦»æ•£æ—¶é—´ç§¯åˆ†è¿‡ç¨‹ã€‚ç»™å®šç³»ç»ŸçŠ¶æ€ $\mathbf{s}_t = (\mathbf{q}, \dot{\mathbf{q}})$ï¼ˆå¹¿ä¹‰åæ ‡åŠå…¶é€Ÿåº¦ï¼‰å’Œæ§åˆ¶è¾“å…¥ $\mathbf{u}_t$ï¼Œä»¿çœŸå™¨è®¡ç®—ä¸‹ä¸€æ—¶åˆ»çš„çŠ¶æ€ï¼š</p>
  <p>$$\mathbf{s}_{t+1} = f(\mathbf{s}_t, \mathbf{u}_t, \Delta t)$$</p>
  <p>å…¶ä¸­ $\Delta t$ æ˜¯æ—¶é—´æ­¥é•¿ï¼Œ$f$ æ˜¯åŠ¨åŠ›å­¦æ–¹ç¨‹çš„æ•°å€¼ç§¯åˆ†ã€‚</p>
</div>

<p><strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨çœŸå®æœºå™¨äººï¼Ÿ</strong> è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå†³å®šäº†æ•´ä¸ªä»¿çœŸé¢†åŸŸå­˜åœ¨çš„ä»·å€¼ï¼š</p>

<table>
<tr><th>ç»´åº¦</th><th>çœŸå®æœºå™¨äºº</th><th>ç‰©ç†ä»¿çœŸ</th></tr>
<tr><td><strong>é€Ÿåº¦</strong></td><td>1Ã— å®æ—¶ï¼ˆ1ç§’å°±æ˜¯1ç§’ï¼‰</td><td>1000-10000Ã— å®æ—¶</td></tr>
<tr><td><strong>å®‰å…¨æ€§</strong></td><td>å¯èƒ½æŸåè®¾å¤‡æˆ–ä¼¤äºº</td><td>éšä¾¿æ’ï¼Œé›¶æˆæœ¬</td></tr>
<tr><td><strong>å¯é‡å¤æ€§</strong></td><td>ä¼ æ„Ÿå™¨å™ªå£°ã€ç£¨æŸç­‰å¯¼è‡´ä¸å®Œå…¨å¯é‡å¤</td><td>ç›¸åŒç§å­ â†’ å®Œå…¨ç›¸åŒè½¨è¿¹</td></tr>
<tr><td><strong>å¹¶è¡Œæ€§</strong></td><td>ä¸€å°æœºå™¨äºº = ä¸€ä¸ªç¯å¢ƒ</td><td>ä¸€å°ç”µè„‘ = æ•°åƒä¸ªå¹¶è¡Œç¯å¢ƒ</td></tr>
<tr><td><strong>æˆæœ¬</strong></td><td>$$$ï¼ˆç¡¬ä»¶ + ç»´æŠ¤ï¼‰</td><td>$ ï¼ˆè®¡ç®—èµ„æºï¼‰</td></tr>
<tr><td><strong>æ•°æ®è·å–</strong></td><td>å®Œç¾çŠ¶æ€ä¿¡æ¯éš¾ä»¥è·å–</td><td>å¯ä»¥è¯»å–ä»»ä½•ç‰©ç†é‡</td></tr>
<tr><td><strong>å‚æ•°è°ƒèŠ‚</strong></td><td>éœ€è¦é‡æ–°è®¾è®¡/åˆ¶é€ </td><td>æ”¹ä¸ªæ•°å­—é‡æ–°è¿è¡Œ</td></tr>
</table>

<h4>Sim-to-Realï¼ˆä»¿çœŸåˆ°ç°å®è¿ç§»ï¼‰</h4>

<p>å½“ç„¶ï¼Œä»¿çœŸä¸æ˜¯ä¸‡èƒ½çš„ã€‚ä»¿çœŸå’Œç°å®ä¹‹é—´å­˜åœ¨ <strong>Sim-to-Real Gap</strong>ï¼ˆä»¿çœŸ-ç°å®å·®è·ï¼‰ï¼Œä¸»è¦æ¥è‡ªï¼š</p>

<ol>
  <li><strong>æ¨¡å‹è¯¯å·®</strong>ï¼šå‡ ä½•å‚æ•°ã€è´¨é‡å‚æ•°ä¸å¤Ÿç²¾ç¡®</li>
  <li><strong>æ¥è§¦æ¨¡å‹ç®€åŒ–</strong>ï¼šçœŸå®ä¸–ç•Œçš„æ‘©æ“¦ã€å½¢å˜æä¸ºå¤æ‚</li>
  <li><strong>ä¼ æ„Ÿå™¨å·®å¼‚</strong>ï¼šä»¿çœŸä¸­ä¼ æ„Ÿå™¨æ˜¯å®Œç¾çš„ï¼Œç°å®ä¸­æœ‰å™ªå£°å’Œå»¶è¿Ÿ</li>
  <li><strong>æ‰§è¡Œå™¨å·®å¼‚</strong>ï¼šçœŸå®ç”µæœºæœ‰é½¿è½®é—´éš™ã€éçº¿æ€§æ‘©æ“¦ç­‰</li>
</ol>

<p>åº”å¯¹ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
  <li><strong>Domain Randomizationï¼ˆåŸŸéšæœºåŒ–ï¼‰</strong>ï¼šåœ¨ä»¿çœŸä¸­éšæœºåŒ–ç‰©ç†å‚æ•°ï¼Œè¿«ä½¿ç­–ç•¥å­¦ä¼šæ³›åŒ–</li>
  <li><strong>System Identificationï¼ˆç³»ç»Ÿè¾¨è¯†ï¼‰</strong>ï¼šç²¾ç¡®æµ‹é‡çœŸå®ç³»ç»Ÿå‚æ•°å¹¶åæ˜ åˆ°ä»¿çœŸä¸­</li>
  <li><strong>Fine-tuning</strong>ï¼šåœ¨ä»¿çœŸä¸­é¢„è®­ç»ƒï¼Œåœ¨çœŸå®æœºå™¨äººä¸Šå¾®è°ƒ</li>
</ul>

<div class="box thm">
  <div class="box-title">âœ… Sim-to-Real çš„é»„é‡‘æ³•åˆ™</div>
  <p>ä»¿çœŸè¶Šç²¾ç¡®ï¼Œè¿ç§»è¶Šå®¹æ˜“ã€‚MuJoCo ä¹‹æ‰€ä»¥æµè¡Œï¼Œæ­£æ˜¯å› ä¸ºå®ƒåœ¨<strong>æ¥è§¦ç‰©ç†</strong>è¿™ä¸ªæœ€å®¹æ˜“å‡ºç° sim-to-real gap çš„é¢†åŸŸåšå¾—ç‰¹åˆ«å¥½ã€‚</p>
</div>


<h3 id="ch1-compare">1.2 å¸¸è§ç‰©ç†å¼•æ“å¯¹æ¯”</h3>

<p>å¸‚é¢ä¸Šæœ‰è®¸å¤šç‰©ç†å¼•æ“ï¼Œå„æœ‰ç‰¹é•¿ã€‚ä»¥ä¸‹æ˜¯ä¸»æµé€‰æ‹©çš„è¯¦ç»†å¯¹æ¯”ï¼š</p>

<table>
<tr><th>å¼•æ“</th><th>å¼€å‘è€…</th><th>è®¸å¯</th><th>æ¥è§¦å¤„ç†</th><th>GPUåŠ é€Ÿ</th><th>RLé›†æˆ</th><th>å­¦ä¹ æ›²çº¿</th></tr>
<tr><td><strong>MuJoCo</strong></td><td>DeepMind</td><td>Apache 2.0</td><td>â­â­â­â­â­</td><td>MJX (JAX)</td><td>â­â­â­â­â­</td><td>ä¸­</td></tr>
<tr><td><strong>PyBullet</strong></td><td>Erwin Coumans</td><td>zlib</td><td>â­â­â­</td><td>âŒ</td><td>â­â­â­â­</td><td>ä½</td></tr>
<tr><td><strong>Isaac Sim</strong></td><td>NVIDIA</td><td>EULA</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­â­</td><td>é«˜</td></tr>
<tr><td><strong>PhysX 5</strong></td><td>NVIDIA</td><td>BSD 3</td><td>â­â­â­â­</td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>é«˜</td></tr>
<tr><td><strong>Drake</strong></td><td>MIT/TRI</td><td>BSD 3</td><td>â­â­â­â­</td><td>âŒ</td><td>â­â­</td><td>é«˜</td></tr>
</table>

<p><strong>MuJoCo</strong> â€” å…¨ç§° Multi-Joint dynamics with Contactï¼Œç”± Emo Todorov åœ¨åç››é¡¿å¤§å­¦å¼€å‘ï¼Œ2021 å¹´è¢« DeepMind æ”¶è´­å¹¶å¼€æºã€‚æ“…é•¿ç²¾ç¡®çš„æ¥è§¦åŠ›è®¡ç®—ï¼Œæ˜¯ RL ç¤¾åŒºçš„äº‹å®æ ‡å‡†ã€‚é‡‡ç”¨å‡¸ä¼˜åŒ–æ–¹æ³•æ±‚è§£æ¥è§¦åŠ›ï¼Œä¿è¯ç‰©ç†ä¸€è‡´æ€§ã€‚</p>

<p><strong>PyBullet</strong> â€” Bullet ç‰©ç†å¼•æ“çš„ Python å°è£…ã€‚å…¥é—¨ç®€å•ï¼Œç¤¾åŒºèµ„æºå¤šï¼Œä½†æ¥è§¦å¤„ç†ç²¾åº¦ä¸å¦‚ MuJoCoï¼Œä¸”æ²¡æœ‰ GPU åŠ é€Ÿã€‚é€‚åˆæ•™å­¦å’Œå¿«é€ŸåŸå‹ã€‚</p>

<p><strong>Isaac Sim</strong> â€” NVIDIA çš„å…¨æ ˆæœºå™¨äººä»¿çœŸå¹³å°ï¼ŒåŸºäº Omniverse å’Œ PhysX 5ã€‚GPU åŸç”Ÿå¹¶è¡Œä»¿çœŸï¼Œå•å¡å¯è·‘ä¸Šä¸‡ä¸ªç¯å¢ƒã€‚ç¼ºç‚¹æ˜¯éœ€è¦ NVIDIA GPUï¼Œä¸”ä½“ç³»åºå¤§ã€å­¦ä¹ æˆæœ¬é«˜ã€‚</p>

<p><strong>PhysX 5</strong> â€” NVIDIA å¼€æºçš„åº•å±‚ç‰©ç†å¼•æ“ã€‚Isaac Sim çš„åŸºç¡€ã€‚æ”¯æŒ GPU å¤§è§„æ¨¡å¹¶è¡Œï¼Œä½†ç›´æ¥ä½¿ç”¨éœ€è¦è¾ƒå¤šåº•å±‚çŸ¥è¯†ã€‚</p>

<p><strong>Drake</strong> â€” MIT å’Œ Toyota Research Institute å¼€å‘ã€‚å¼ºè°ƒæ•°å­¦ä¸¥è°¨æ€§ï¼ˆä¼˜åŒ–ã€æ§åˆ¶ç†è®ºï¼‰ï¼Œå†…ç½®è½¨è¿¹ä¼˜åŒ–å’Œæ¨¡å‹é¢„æµ‹æ§åˆ¶ã€‚ä¸å¤ªé€‚åˆå¤§è§„æ¨¡ RL è®­ç»ƒã€‚</p>

<div class="box ex">
  <div class="box-title">ğŸ” å¦‚ä½•é€‰æ‹©ï¼Ÿ</div>
  <ul>
    <li><strong>åš RL ç ”ç©¶</strong> â†’ MuJoCoï¼ˆç¤¾åŒºæœ€å¤§ï¼Œbenchmark æœ€å¤šï¼‰</li>
    <li><strong>å¿«é€ŸåŸå‹</strong> â†’ PyBulletï¼ˆæœ€ç®€å•ï¼‰</li>
    <li><strong>å¤§è§„æ¨¡å¹¶è¡Œè®­ç»ƒ</strong> â†’ Isaac Sim / IsaacGymï¼ˆGPU å¹¶è¡Œï¼‰</li>
    <li><strong>æ§åˆ¶ç†è®º/ä¼˜åŒ–</strong> â†’ Drakeï¼ˆæ•°å­¦å·¥å…·å®Œå¤‡ï¼‰</li>
    <li><strong>æˆ‘ä»¬çš„é¡¹ç›®</strong> â†’ MuJoCoï¼ˆæ¥è§¦ç²¾åº¦å¥½ï¼Œé€‚åˆåŒ»ç–—æœºå™¨äººï¼‰</li>
  </ul>
</div>


<h3 id="ch1-why-mujoco">1.3 MuJoCo çš„æ ¸å¿ƒä¼˜åŠ¿</h3>

<p>MuJoCo ä¹‹æ‰€ä»¥æˆä¸º RL ç¤¾åŒºçš„é¦–é€‰å¼•æ“ï¼Œæœ‰å‡ ä¸ªå…³é”®åŸå› ï¼š</p>

<h4>1. å“è¶Šçš„æ¥è§¦å¤„ç†</h4>
<p>MuJoCo ä½¿ç”¨<strong>å‡¸ä¼˜åŒ–</strong>æ¥æ±‚è§£æ¥è§¦åŠ›ï¼Œè€Œéä¼ ç»Ÿçš„è„‰å†²æ–¹æ³•æˆ–ç½šå‡½æ•°æ–¹æ³•ã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
  <li>ç‰©ä½“ä¸ä¼šç©¿é€â€”â€”æ¥è§¦çº¦æŸè¢«ç²¾ç¡®æ»¡è¶³</li>
  <li>å †å ç‰©ä½“ç¨³å®šâ€”â€”ä¸ä¼šåƒæŸäº›å¼•æ“é‚£æ ·"æŠ–åŠ¨"</li>
  <li>æ‘©æ“¦åŠ›æ­£ç¡®â€”â€”åº“ä»‘æ‘©æ“¦æ¨¡å‹çš„ç²¾ç¡®å®ç°</li>
</ul>

<div class="box def">
  <div class="box-title">ğŸ“ MuJoCo æ¥è§¦åŠ›æ±‚è§£</div>
  <p>MuJoCo å°†æ¥è§¦åŠ›æ±‚è§£å»ºæ¨¡ä¸ºä¸€ä¸ª<strong>çº¿æ€§äº’è¡¥é—®é¢˜ (LCP)</strong>æˆ–ç­‰ä»·çš„å‡¸ä¼˜åŒ–é—®é¢˜ï¼š</p>
  <p>$$\min_{\mathbf{f}} \frac{1}{2} \mathbf{f}^T A \mathbf{f} + \mathbf{b}^T \mathbf{f} \quad \text{s.t.} \quad \mathbf{f} \in \mathcal{C}$$</p>
  <p>å…¶ä¸­ $\mathbf{f}$ æ˜¯æ¥è§¦åŠ›ï¼Œ$A$ æ˜¯æ¥è§¦çŸ©é˜µï¼Œ$\mathcal{C}$ æ˜¯æ‘©æ“¦é”¥çº¦æŸé›†åˆã€‚è¿™æ¯”è„‰å†²æ–¹æ³•ï¼ˆPyBulletï¼‰æ›´ç²¾ç¡®ï¼Œæ¯”ç½šå‡½æ•°æ–¹æ³•æ›´ç¨³å®šã€‚</p>
</div>

<h4>2. æé«˜çš„ä»¿çœŸé€Ÿåº¦</h4>
<p>åœ¨ CPU ä¸Šï¼ŒMuJoCo å¯ä»¥è¾¾åˆ°ï¼š</p>
<ul>
  <li>ç®€å•æ¨¡å‹ï¼ˆæˆ‘ä»¬çš„ PushBoxï¼‰ï¼šçº¦ <strong>10,000,000 æ­¥/ç§’</strong>ï¼ˆå•æ ¸ï¼‰</li>
  <li>å¤æ‚äººå½¢æœºå™¨äººï¼ˆ30+ DOFï¼‰ï¼šçº¦ <strong>500,000 æ­¥/ç§’</strong></li>
  <li>MJXï¼ˆJAX åç«¯ï¼‰åœ¨ GPU ä¸Šï¼šå†å¿« 10-100 å€</li>
</ul>

<h4>3. å¯å¾®åˆ†ä»¿çœŸï¼ˆMJXï¼‰</h4>
<p>MuJoCo 3.0+ å¼•å…¥äº† MJX â€”â€” åŸºäº JAX çš„å¯å¾®åˆ†åç«¯ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥<strong>å¯¹æ•´ä¸ªä»¿çœŸè¿‡ç¨‹æ±‚æ¢¯åº¦</strong>ï¼Œå®ç°ï¼š</p>
<ul>
  <li>åŸºäºæ¢¯åº¦çš„ç­–ç•¥ä¼˜åŒ–ï¼ˆæ¯” RL çš„é‡‡æ ·æ•ˆç‡æ›´é«˜ï¼‰</li>
  <li>ç³»ç»Ÿè¾¨è¯†ï¼ˆä»è§‚æµ‹æ•°æ®åæ¨ç‰©ç†å‚æ•°ï¼‰</li>
  <li>è½¨è¿¹ä¼˜åŒ–ï¼ˆç›´æ¥ä¼˜åŒ–æ§åˆ¶åºåˆ—ï¼‰</li>
</ul>

<h4>4. å¼€æºä¸”ç¤¾åŒºæ´»è·ƒ</h4>
<p>2021 å¹´ DeepMind å°† MuJoCo å¼€æºåï¼Œç¤¾åŒºçˆ†å‘å¢é•¿ï¼š</p>
<ul>
  <li>Gymnasium (OpenAI Gym)ï¼šæ ‡å‡† RL benchmark å‡ ä¹éƒ½åŸºäº MuJoCo</li>
  <li>dm_controlï¼šDeepMind çš„æ§åˆ¶ä»»åŠ¡å¥—ä»¶</li>
  <li>robosuite, metaworldï¼šæœºå™¨äººæ“ä½œ benchmark</li>
  <li>MuJoCo Menagerieï¼šå¼€æºæœºå™¨äººæ¨¡å‹åº“ï¼ˆåŒ…æ‹¬çœŸå®æœºå™¨äººçš„é«˜ç²¾åº¦æ¨¡å‹ï¼‰</li>
</ul>


<h3 id="ch1-install">1.4 å®‰è£…å’Œé…ç½®</h3>

<p>MuJoCo 3.x çš„å®‰è£…éå¸¸ç®€å•ï¼Œä¸å†éœ€è¦ä¸‹è½½å•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è®¾ç½®è®¸å¯è¯ï¼ˆ2.x æ—¶ä»£çš„ç—›è‹¦ï¼‰ï¼š</p>

<pre><code class="language-bash"><span class="code-label">BASH</span># å®‰è£… MuJoCoï¼ˆæ¨è 3.x ç‰ˆæœ¬ï¼‰
pip install mujoco

# éªŒè¯å®‰è£…
python -c "import mujoco; print(f'MuJoCo version: {mujoco.__version__}')"
# è¾“å‡º: MuJoCo version: 3.2.x

# å¯é€‰ï¼šå®‰è£…å¯è§†åŒ–å·¥å…·
pip install mujoco-viewer   # ç¬¬ä¸‰æ–¹è½»é‡çº§æŸ¥çœ‹å™¨

# å¯é€‰ï¼šå®‰è£… MJXï¼ˆGPU åŠ é€Ÿï¼Œéœ€è¦ JAXï¼‰
pip install mujoco-mjx
pip install jax[cuda12]     # å¦‚æœæœ‰ NVIDIA GPU</code></pre>

<div class="box warn">
  <div class="box-title">âš ï¸ ç‰ˆæœ¬æ³¨æ„äº‹é¡¹</div>
  <ul>
    <li><strong>MuJoCo 3.x</strong>ï¼ˆå½“å‰æ¨èï¼‰ï¼šçº¯ Python ç»‘å®šï¼Œå®‰è£…ç®€å•ï¼ŒAPI æ›´ Pythonic</li>
    <li><strong>MuJoCo 2.x</strong>ï¼šéœ€è¦ <code>mujoco-py</code> å°è£…ï¼Œå®‰è£…å¤æ‚ï¼Œå·²ä¸æ¨è</li>
    <li>å¦‚æœä½ çœ‹åˆ°æ•™ç¨‹æåˆ° <code>mujoco-py</code>ã€<code>mj_activate()</code>ã€è®¸å¯è¯æ–‡ä»¶ï¼Œé‚£æ˜¯æ—§ç‰ˆ API</li>
    <li>Gymnasium 1.0+ å·²é»˜è®¤ä½¿ç”¨ MuJoCo 3.x ç»‘å®š</li>
  </ul>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span># å®Œæ•´çš„ç¯å¢ƒä¾èµ–ï¼ˆæˆ‘ä»¬é¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬ï¼‰
# requirements.txt
mujoco>=3.1.0
gymnasium>=1.0.0
numpy>=1.24
stable-baselines3>=2.3.0

# å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt</code></pre>

<pre><code class="language-python"><span class="code-label">PYTHON</span># å¿«é€ŸéªŒè¯ï¼šåŠ è½½ä¸€ä¸ªå†…ç½®æ¨¡å‹
import mujoco
import numpy as np

# MuJoCo è‡ªå¸¦ä¸€äº›æµ‹è¯• XML
xml = """
&lt;mujoco&gt;
  &lt;worldbody&gt;
    &lt;light pos="0 0 3"/&gt;
    &lt;body pos="0 0 1"&gt;
      &lt;freejoint/&gt;
      &lt;geom type="sphere" size="0.1"/&gt;
    &lt;/body&gt;
    &lt;geom type="plane" size="5 5 0.1"/&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;
"""

model = mujoco.MjModel.from_xml_string(xml)
data = mujoco.MjData(model)

# ä»¿çœŸ 1 ç§’
for _ in range(500):  # 500 æ­¥ Ã— 0.002s = 1.0s
    mujoco.mj_step(model, data)

# çƒä» z=1.0 è‡ªç”±è½ä½“
print(f"çƒçš„æœ€ç»ˆé«˜åº¦: {data.qpos[2]:.4f} m")
print(f"çƒçš„é€Ÿåº¦: {data.qvel[2]:.4f} m/s")
# çƒåº”è¯¥è½åˆ°åœ°é¢å¹¶åœä¸‹ï¼ˆz â‰ˆ 0.1ï¼Œçƒçš„åŠå¾„ï¼‰</code></pre>


<!-- ================================================================== -->
<!-- ç¬¬äºŒç« ï¼šæ ¸å¿ƒæ¦‚å¿µ                                                      -->
<!-- ================================================================== -->
<h2 id="ch2">ç¬¬äºŒç« ï¼šMuJoCo æ ¸å¿ƒæ¦‚å¿µ</h2>

<h3 id="ch2-mjcf">2.1 MJCF â€” MuJoCo çš„æ¨¡å‹æè¿°è¯­è¨€</h3>

<p>MJCFï¼ˆMuJoCo Configuration Formatï¼‰æ˜¯ MuJoCo ä½¿ç”¨çš„ XML æ ¼å¼ï¼Œç”¨äºæè¿°æ•´ä¸ªä»¿çœŸä¸–ç•Œï¼šç‰©ä½“ã€å…³èŠ‚ã€æè´¨ã€ä¼ æ„Ÿå™¨ã€æ‰§è¡Œå™¨ç­‰ä¸€åˆ‡ã€‚</p>

<div class="box def">
  <div class="box-title">ğŸ“ MJCF vs URDF</div>
  <p>ä½ å¯èƒ½å¬è¯´è¿‡ <strong>URDF</strong>ï¼ˆUnified Robot Description Formatï¼‰ï¼ŒROS ç¤¾åŒºçš„æ ‡å‡†æ ¼å¼ã€‚MuJoCo ä¹Ÿå¯ä»¥åŠ è½½ URDFï¼Œä½† MJCF æ›´å¼ºå¤§ï¼š</p>
  <table>
    <tr><th>ç‰¹æ€§</th><th>MJCF</th><th>URDF</th></tr>
    <tr><td>æ¥è§¦å‚æ•°</td><td>âœ… å®Œæ•´ï¼ˆæ‘©æ“¦ã€åˆšåº¦ã€é˜»å°¼ï¼‰</td><td>âŒ æœ‰é™</td></tr>
    <tr><td>æ‰§è¡Œå™¨</td><td>âœ… å¤šç§ç±»å‹</td><td>âŒ ä»…åŸºæœ¬ä¼ åŠ¨</td></tr>
    <tr><td>è‚Œè…±</td><td>âœ…</td><td>âŒ</td></tr>
    <tr><td>é»˜è®¤å€¼ç»§æ‰¿</td><td>âœ… å±‚çº§é»˜è®¤ç³»ç»Ÿ</td><td>âŒ</td></tr>
    <tr><td>ä¼ æ„Ÿå™¨</td><td>âœ… å†…ç½®</td><td>âŒ éœ€è¦æ’ä»¶</td></tr>
    <tr><td>å¯è§†åŒ–è®¾ç½®</td><td>âœ… å†…ç½®</td><td>âŒ å¤–éƒ¨</td></tr>
  </table>
</div>

<p>ä¸€ä¸ªæœ€ç®€ MJCF æ–‡ä»¶åªéœ€è¦å‡ è¡Œï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;mujoco&gt;
  &lt;worldbody&gt;
    &lt;geom type="plane" size="5 5 0.1"/&gt;  &lt;!-- åœ°é¢ --&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;</code></pre>

<p>è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªåªæœ‰åœ°é¢çš„ç©ºä¸–ç•Œã€‚MJCF çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å±‚çº§ç»“æ„</strong>â€”â€”ç‰©ä½“é€šè¿‡çˆ¶å­å…³ç³»ç»„ç»‡ï¼Œå…³èŠ‚å®šä¹‰äº†å­ç‰©ä½“ç›¸å¯¹äºçˆ¶ç‰©ä½“çš„è‡ªç”±åº¦ã€‚</p>


<h3 id="ch2-mjmodel">2.2 MjModel â€” ç¼–è¯‘åçš„é™æ€æ¨¡å‹</h3>

<p>å½“ä½ åŠ è½½ MJCF æ–‡ä»¶æ—¶ï¼ŒMuJoCo ä¼š<strong>ç¼–è¯‘</strong>å®ƒï¼Œç”Ÿæˆä¸€ä¸ª <code>MjModel</code> å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«æ‰€æœ‰<strong>ä¸ä¼šåœ¨ä»¿çœŸè¿‡ç¨‹ä¸­æ”¹å˜çš„ä¿¡æ¯</strong>ï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ MjModel åŒ…å«ä»€ä¹ˆ</div>
  <ul>
    <li><strong>å‡ ä½•ä¿¡æ¯</strong>ï¼šç‰©ä½“çš„å½¢çŠ¶ã€å¤§å°ã€é¢œè‰²</li>
    <li><strong>è¿åŠ¨å­¦ä¿¡æ¯</strong>ï¼šå…³èŠ‚ç±»å‹ã€å…³èŠ‚èŒƒå›´ã€çˆ¶å­å…³ç³»</li>
    <li><strong>åŠ¨åŠ›å­¦å‚æ•°</strong>ï¼šè´¨é‡ã€æƒ¯æ€§ã€æ‘©æ“¦ç³»æ•°ã€é˜»å°¼</li>
    <li><strong>æ‰§è¡Œå™¨å‚æ•°</strong>ï¼šå¢ç›Šã€åŠ›çŸ©èŒƒå›´ã€ä¼ åŠ¨æ¯”</li>
    <li><strong>å…¨å±€é€‰é¡¹</strong>ï¼šæ—¶é—´æ­¥é•¿ã€ç§¯åˆ†å™¨ç±»å‹ã€é‡åŠ›å‘é‡</li>
    <li><strong>æ¸²æŸ“èµ„æº</strong>ï¼šçº¹ç†ã€æè´¨ã€å…‰æº</li>
  </ul>
  <p>å…³é”®ï¼šMjModel åœ¨åŠ è½½å<strong>åŸºæœ¬ä¸å˜</strong>ï¼ˆè™½ç„¶æŠ€æœ¯ä¸Šå¯ä»¥ä¿®æ”¹æŸäº›å‚æ•°ï¼Œå¦‚ body_massï¼‰ã€‚</p>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco

# ä»æ–‡ä»¶åŠ è½½
model = mujoco.MjModel.from_xml_path("push_box.xml")

# æŸ¥çœ‹æ¨¡å‹åŸºæœ¬ä¿¡æ¯
print(f"è‡ªç”±åº¦ (nv): {model.nv}")          # å¹¿ä¹‰é€Ÿåº¦ç»´åº¦
print(f"å¹¿ä¹‰åæ ‡ (nq): {model.nq}")        # å¹¿ä¹‰åæ ‡ç»´åº¦
print(f"ç‰©ä½“æ•° (nbody): {model.nbody}")     # body æ•°é‡ï¼ˆå« worldï¼‰
print(f"å…³èŠ‚æ•° (njnt): {model.njnt}")       # å…³èŠ‚æ•°é‡
print(f"å‡ ä½•ä½“ (ngeom): {model.ngeom}")     # geom æ•°é‡
print(f"æ‰§è¡Œå™¨ (nu): {model.nu}")           # æ‰§è¡Œå™¨æ•°é‡
print(f"æ—¶é—´æ­¥é•¿: {model.opt.timestep}")     # ä»¿çœŸæ—¶é—´æ­¥é•¿

# å¯¹äºæˆ‘ä»¬çš„ PushBox æ¨¡å‹ï¼š
# nv = 8  (2 hinge + 6 freejoint)
# nq = 9  (2 hingeè§’åº¦ + 3 ä½ç½® + 4 å››å…ƒæ•°)
# nbody = 5 (world + arm_base + upper_arm + forearm + box)
# njnt = 3  (shoulder + elbow + box_freejoint)
# nu = 2   (shoulder_motor + elbow_motor)</code></pre>


<h3 id="ch2-mjdata">2.3 MjData â€” è¿è¡Œæ—¶åŠ¨æ€æ•°æ®</h3>

<p><code>MjData</code> æ˜¯ä»¿çœŸè¿è¡Œæ—¶çš„<strong>æ‰€æœ‰åŠ¨æ€æ•°æ®</strong>çš„å®¹å™¨ã€‚æ¯ä¸€æ­¥ä»¿çœŸéƒ½ä¼šæ›´æ–°å®ƒï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ MjData åŒ…å«ä»€ä¹ˆ</div>
  <ul>
    <li><strong>qpos</strong>ï¼šå¹¿ä¹‰åæ ‡ï¼ˆå…³èŠ‚è§’åº¦ + è‡ªç”±ä½“ä½ç½®/å§¿æ€ï¼‰</li>
    <li><strong>qvel</strong>ï¼šå¹¿ä¹‰é€Ÿåº¦ï¼ˆå…³èŠ‚è§’é€Ÿåº¦ + è‡ªç”±ä½“çº¿é€Ÿåº¦/è§’é€Ÿåº¦ï¼‰</li>
    <li><strong>ctrl</strong>ï¼šæ§åˆ¶è¾“å…¥ï¼ˆä½ å‘ç»™æ‰§è¡Œå™¨çš„å‘½ä»¤ï¼‰</li>
    <li><strong>xpos, xquat</strong>ï¼šæ¯ä¸ª body çš„ç¬›å¡å°”ä½ç½®å’Œå§¿æ€</li>
    <li><strong>site_xpos</strong>ï¼šæ¯ä¸ª site çš„ä½ç½®</li>
    <li><strong>qfrc_applied</strong>ï¼šå¤–éƒ¨æ–½åŠ çš„åŠ›</li>
    <li><strong>contact</strong>ï¼šå½“å‰æ—¶åˆ»çš„æ¥è§¦ä¿¡æ¯</li>
    <li><strong>sensordata</strong>ï¼šä¼ æ„Ÿå™¨è¯»æ•°</li>
    <li><strong>time</strong>ï¼šå½“å‰ä»¿çœŸæ—¶é—´</li>
  </ul>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span>data = mujoco.MjData(model)

# ===== æ ¸å¿ƒçŠ¶æ€é‡ =====

# qpos: å¹¿ä¹‰åæ ‡ â€” å¯¹äº PushBox:
# [shoulder_angle, elbow_angle, box_x, box_y, box_z, box_qw, box_qx, box_qy, box_qz]
#  ^---hingeå…³èŠ‚---^            ^---freejoint ä½ç½®---^  ^---freejoint å››å…ƒæ•°---^
print(f"qpos shape: {data.qpos.shape}")  # (9,)

# qvel: å¹¿ä¹‰é€Ÿåº¦ â€” æ³¨æ„ç»´åº¦ä¸åŒäº qposï¼
# [shoulder_vel, elbow_vel, box_vx, box_vy, box_vz, box_wx, box_wy, box_wz]
#  ^--hingeè§’é€Ÿåº¦-^          ^--çº¿é€Ÿåº¦--^           ^--è§’é€Ÿåº¦--^
print(f"qvel shape: {data.qvel.shape}")  # (8,)  â† å››å…ƒæ•°çš„é€Ÿåº¦æ˜¯3ç»´è§’é€Ÿåº¦ï¼Œä¸æ˜¯4ç»´

# ctrl: æ§åˆ¶è¾“å…¥
data.ctrl[0] = 5.0   # shoulder_motor åŠ›çŸ©
data.ctrl[1] = -3.0  # elbow_motor åŠ›çŸ©

# ===== è®¡ç®—é‡ï¼ˆéœ€è¦å…ˆè°ƒç”¨ mj_forward æˆ– mj_stepï¼‰=====
mujoco.mj_forward(model, data)

# xpos: æ¯ä¸ª body çš„ä¸–ç•Œåæ ‡ä½ç½®
for i in range(model.nbody):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, i)
    print(f"  {name}: {data.xpos[i]}")

# site_xpos: æ¯ä¸ª site çš„ä½ç½®
ee_site_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SITE, "endeffector")
print(f"æœ«ç«¯æ‰§è¡Œå™¨ä½ç½®: {data.site_xpos[ee_site_id]}")</code></pre>

<div class="box warn">
  <div class="box-title">âš ï¸ qpos å’Œ qvel çš„ç»´åº¦ä¸åŒï¼</div>
  <p>è¿™æ˜¯ MuJoCo åˆå­¦è€…æœ€å¸¸è§çš„å›°æƒ‘ï¼š</p>
  <ul>
    <li><strong>hinge/slide å…³èŠ‚</strong>ï¼šqpos 1 ç»´ï¼Œqvel 1 ç»´ï¼ˆä¸€è‡´ï¼‰</li>
    <li><strong>ball å…³èŠ‚</strong>ï¼šqpos 4 ç»´ï¼ˆå››å…ƒæ•°ï¼‰ï¼Œqvel 3 ç»´ï¼ˆè§’é€Ÿåº¦ï¼‰</li>
    <li><strong>free å…³èŠ‚</strong>ï¼šqpos 7 ç»´ï¼ˆ3ä½ç½® + 4å››å…ƒæ•°ï¼‰ï¼Œqvel 6 ç»´ï¼ˆ3çº¿é€Ÿåº¦ + 3è§’é€Ÿåº¦ï¼‰</li>
  </ul>
  <p>è¿™æ˜¯å› ä¸ºå››å…ƒæ•°æœ‰ 4 ä¸ªåˆ†é‡ä½†åªæœ‰ 3 ä¸ªè‡ªç”±åº¦ï¼ˆå— $\|\mathbf{q}\| = 1$ çº¦æŸï¼‰ã€‚æ‰€ä»¥ <code>nq â‰  nv</code> æ˜¯æ­£å¸¸çš„ï¼åœ¨ PushBox ä¸­ï¼š<code>nq = 9</code>, <code>nv = 8</code>ã€‚</p>
</div>


<h3 id="ch2-step">2.4 ä»¿çœŸå¾ªç¯ â€” mj_step() åˆ°åº•åšäº†ä»€ä¹ˆ</h3>

<p><code>mj_step()</code> æ˜¯ MuJoCo ä»¿çœŸçš„æ ¸å¿ƒã€‚æ¯æ¬¡è°ƒç”¨å®ƒï¼Œä»¿çœŸå‰è¿›ä¸€ä¸ªæ—¶é—´æ­¥ã€‚ä½†å†…éƒ¨å®é™…ä¸Šå‘ç”Ÿäº†å¾ˆå¤šäº‹æƒ…ï¼š</p>

<div class="diagram">
mj_step(model, data) å†…éƒ¨æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. mj_step1(model, data)    â€” è®¡ç®—é˜¶æ®µ                         â”‚
â”‚     â”œâ”€â”€ mj_forward(model, data)                                  â”‚
â”‚     â”‚   â”œâ”€â”€ mj_kinematics()    â†’ è®¡ç®—æ­£è¿åŠ¨å­¦ (qpos â†’ xpos)      â”‚
â”‚     â”‚   â”œâ”€â”€ mj_comPos()        â†’ è®¡ç®—è´¨å¿ƒä½ç½®                     â”‚
â”‚     â”‚   â”œâ”€â”€ mj_tendon()        â†’ è®¡ç®—è‚Œè…±é•¿åº¦/åŠ›                  â”‚
â”‚     â”‚   â”œâ”€â”€ mj_transmission()  â†’ æ‰§è¡Œå™¨åŠ› â†’ å…³èŠ‚åŠ›               â”‚
â”‚     â”‚   â”œâ”€â”€ mj_crb()           â†’ å¤åˆåˆšä½“æƒ¯æ€§                    â”‚
â”‚     â”‚   â”œâ”€â”€ mj_factorM()       â†’ åˆ†è§£è´¨é‡çŸ©é˜µ                    â”‚
â”‚     â”‚   â””â”€â”€ mj_collision()     â†’ ç¢°æ’æ£€æµ‹                       â”‚
â”‚     â”‚       â””â”€â”€ mj_makeConstraint()  â†’ æ„å»ºçº¦æŸ                  â”‚
â”‚     â””â”€â”€ mj_fwdConstraint()     â†’ æ±‚è§£æ¥è§¦åŠ›ï¼ˆå‡¸ä¼˜åŒ–ï¼‰             â”‚
â”‚                                                                   â”‚
â”‚  2. mj_step2(model, data)    â€” ç§¯åˆ†é˜¶æ®µ                         â”‚
â”‚     â”œâ”€â”€ mj_fwdAcceleration()   â†’ è®¡ç®—åŠ é€Ÿåº¦ (Mâ»Â¹(f - c))        â”‚
â”‚     â””â”€â”€ mj_Euler() / mj_RK4() â†’ æ•°å€¼ç§¯åˆ†æ›´æ–° qpos, qvel          â”‚
â”‚         data.time += timestep                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</div>

<p>æ ¸å¿ƒè¿åŠ¨æ–¹ç¨‹æ˜¯<strong>æ‹‰æ ¼æœ—æ—¥æ–¹ç¨‹</strong>ï¼š</p>

<p>$$M(\mathbf{q})\ddot{\mathbf{q}} + \mathbf{c}(\mathbf{q}, \dot{\mathbf{q}}) = \boldsymbol{\tau} + J^T \mathbf{f}_{\text{contact}}$$</p>

<p>å…¶ä¸­ï¼š</p>
<ul>
  <li>$M(\mathbf{q})$ â€” å¹¿ä¹‰è´¨é‡çŸ©é˜µï¼ˆå–å†³äºå½“å‰æ„å‹ï¼‰</li>
  <li>$\mathbf{c}(\mathbf{q}, \dot{\mathbf{q}})$ â€” ç§‘æ°åŠ› + ç¦»å¿ƒåŠ› + é‡åŠ›</li>
  <li>$\boldsymbol{\tau}$ â€” æ‰§è¡Œå™¨åŠ›çŸ©ï¼ˆæ¥è‡ª <code>data.ctrl</code>ï¼‰</li>
  <li>$J^T \mathbf{f}_{\text{contact}}$ â€” æ¥è§¦åŠ›é€šè¿‡é›…å¯æ¯”çŸ©é˜µæ˜ å°„åˆ°å…³èŠ‚ç©ºé—´</li>
</ul>

<pre><code class="language-python"><span class="code-label">PYTHON</span># æ ‡å‡†ä»¿çœŸå¾ªç¯
import mujoco
import numpy as np

model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

# ä»¿çœŸ 5 ç§’
duration = 5.0
n_steps = int(duration / model.opt.timestep)

trajectory = []

for step in range(n_steps):
    # 1. è®¾ç½®æ§åˆ¶è¾“å…¥ï¼ˆä½ çš„ç­–ç•¥/æ§åˆ¶å™¨ï¼‰
    data.ctrl[0] = 2.0 * np.sin(data.time * 2.0)  # shoulder åŠ›çŸ©
    data.ctrl[1] = 1.0 * np.cos(data.time * 3.0)   # elbow åŠ›çŸ©
    
    # 2. å‰è¿›ä¸€æ­¥
    mujoco.mj_step(model, data)
    
    # 3. è¯»å–çŠ¶æ€
    if step % 100 == 0:  # æ¯ 100 æ­¥è®°å½•
        ee_pos = data.site_xpos[0].copy()  # æœ«ç«¯ä½ç½®
        trajectory.append(ee_pos)
        
print(f"ä»¿çœŸå®Œæˆ: {data.time:.2f}s, {n_steps} æ­¥")
print(f"è®°å½•äº† {len(trajectory)} ä¸ªæœ«ç«¯ä½ç½®ç‚¹")</code></pre>


<h3 id="ch2-timestep">2.5 æ—¶é—´æ­¥é•¿çš„é€‰æ‹©</h3>

<p>æ—¶é—´æ­¥é•¿ <code>timestep</code> æ˜¯ä»¿çœŸä¸­æœ€é‡è¦çš„å‚æ•°ä¹‹ä¸€ã€‚é€‰å¾—å¤ªå¤§ä¼šä¸ç¨³å®šï¼Œé€‰å¾—å¤ªå°ä¼šæµªè´¹è®¡ç®—ï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ æ—¶é—´æ­¥é•¿çš„ç‰©ç†å«ä¹‰</div>
  <p>æ—¶é—´æ­¥é•¿ $\Delta t$ å†³å®šäº†ä»¿çœŸçš„æ—¶é—´åˆ†è¾¨ç‡ã€‚MuJoCo ä½¿ç”¨<strong>ç¦»æ•£æ—¶é—´ç§¯åˆ†</strong>ï¼Œå°†è¿ç»­çš„å¾®åˆ†æ–¹ç¨‹ï¼š</p>
  <p>$$\dot{\mathbf{q}} = \mathbf{v}, \quad M\dot{\mathbf{v}} = \mathbf{f}$$</p>
  <p>è¿‘ä¼¼ä¸ºï¼š</p>
  <p>$$\mathbf{q}_{t+1} = \mathbf{q}_t + \Delta t \cdot \mathbf{v}_t, \quad \mathbf{v}_{t+1} = \mathbf{v}_t + \Delta t \cdot M^{-1}\mathbf{f}_t$$</p>
  <p>$\Delta t$ è¶Šå¤§ï¼Œè¿‘ä¼¼è¯¯å·®è¶Šå¤§ã€‚å½“è¯¯å·®ç§¯ç´¯è¶…è¿‡ç³»ç»Ÿèƒ½è¡¥å¿çš„èŒƒå›´æ—¶ï¼Œä»¿çœŸå°±ä¼š"çˆ†ç‚¸"ã€‚</p>
</div>

<table>
<tr><th>æ—¶é—´æ­¥é•¿</th><th>ä»¿çœŸé€Ÿåº¦</th><th>ç¨³å®šæ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr>
<tr><td>0.0001s</td><td>å¾ˆæ…¢</td><td>æé«˜</td><td>ç²¾å¯†æ¥è§¦ã€åˆšä½“ç¢°æ’</td></tr>
<tr><td>0.001s</td><td>æ…¢</td><td>é«˜</td><td>éœ€è¦ç²¾ç¡®æ¥è§¦çš„ä»»åŠ¡</td></tr>
<tr><td><strong>0.002s</strong></td><td>é€‚ä¸­</td><td>å¥½</td><td><strong>æˆ‘ä»¬çš„ PushBoxï¼ˆæ¨èï¼‰</strong></td></tr>
<tr><td>0.005s</td><td>å¿«</td><td>ä¸€èˆ¬</td><td>ç®€å•ä»»åŠ¡ã€ç²—ç•¥ä»¿çœŸ</td></tr>
<tr><td>0.01s</td><td>å¾ˆå¿«</td><td>å·®</td><td>ä»…é€‚ç”¨äºæ— æ¥è§¦çš„ç®€å•ç³»ç»Ÿ</td></tr>
</table>

<div class="box warn">
  <div class="box-title">âš ï¸ å¦‚ä½•åˆ¤æ–­æ—¶é—´æ­¥é•¿æ˜¯å¦åˆé€‚</div>
  <ul>
    <li><strong>ç‰©ä½“ç©¿é€åœ°é¢</strong>ï¼šæ­¥é•¿å¤ªå¤§ï¼Œç¢°æ’æ£€æµ‹è·Ÿä¸ä¸Š</li>
    <li><strong>èƒ½é‡æŒç»­å¢åŠ </strong>ï¼šç³»ç»Ÿåœ¨"åŠ é€Ÿ"ï¼ˆè€Œæ²¡æœ‰å¤–åŠ›ï¼‰ï¼Œæ•°å€¼ä¸ç¨³å®šçš„ä¿¡å·</li>
    <li><strong>å…³èŠ‚è§’åº¦/é€Ÿåº¦çˆ†ç‚¸</strong>ï¼šå‡ºç° NaN æˆ–æå¤§å€¼</li>
    <li><strong>ç»éªŒæ³•åˆ™</strong>ï¼šä» 0.002s å¼€å§‹ï¼Œå¦‚æœä¸ç¨³å®šå°±å‡åŠï¼Œå¦‚æœå¤ªæ…¢å°±åŠ å€</li>
  </ul>
</div>

<p>åœ¨æˆ‘ä»¬çš„ PushBox ç¯å¢ƒä¸­ï¼Œ<code>timestep=0.002</code> æ˜¯ä¸€ä¸ªå¥½çš„å¹³è¡¡ç‚¹ã€‚æ¯ä¸ª RL æ­¥ï¼ˆ<code>env.step()</code>ï¼‰å†…éƒ¨æ‰§è¡Œ 5 æ¬¡ <code>mj_step()</code>ï¼Œæ‰€ä»¥ä¸€ä¸ª RL æ­¥å¯¹åº” 0.01 ç§’çš„ä»¿çœŸæ—¶é—´ã€‚</p>


<h3 id="ch2-integrator">2.6 ç§¯åˆ†å™¨ â€” Euler, RK4, implicit</h3>

<p>ç§¯åˆ†å™¨å†³å®šäº†å¦‚ä½•ä»å½“å‰çŠ¶æ€è®¡ç®—ä¸‹ä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚MuJoCo æä¾›ä¸‰ç§ç§¯åˆ†å™¨ï¼š</p>

<h4>Semi-implicit Eulerï¼ˆåŠéšå¼æ¬§æ‹‰ï¼‰â€” é»˜è®¤</h4>
<p>æœ€ç®€å•å¿«é€Ÿçš„ç§¯åˆ†å™¨ã€‚å…ˆæ›´æ–°é€Ÿåº¦ï¼Œå†ç”¨æ–°é€Ÿåº¦æ›´æ–°ä½ç½®ï¼š</p>
<p>$$\mathbf{v}_{t+1} = \mathbf{v}_t + \Delta t \cdot \mathbf{a}_t$$</p>
<p>$$\mathbf{q}_{t+1} = \mathbf{q}_t + \Delta t \cdot \mathbf{v}_{t+1}$$</p>
<p>æ³¨æ„è¿™é‡Œç”¨çš„æ˜¯<strong>æ›´æ–°åçš„</strong> $\mathbf{v}_{t+1}$ æ¥è®¡ç®—ä½ç½®ï¼Œè¿™å°±æ˜¯"åŠéšå¼"çš„å«ä¹‰ï¼Œæ¯”æ˜¾å¼æ¬§æ‹‰ç¨³å®šå¾—å¤šã€‚</p>

<h4>RK4ï¼ˆå››é˜¶é¾™æ ¼-åº“å¡”ï¼‰</h4>
<p>ç»å…¸çš„é«˜é˜¶ç§¯åˆ†æ–¹æ³•ï¼Œæ¯æ­¥éœ€è¦ 4 æ¬¡å‡½æ•°æ±‚å€¼ï¼š</p>
<p>$$\mathbf{k}_1 = f(\mathbf{s}_t), \quad \mathbf{k}_2 = f(\mathbf{s}_t + \tfrac{\Delta t}{2}\mathbf{k}_1)$$</p>
<p>$$\mathbf{k}_3 = f(\mathbf{s}_t + \tfrac{\Delta t}{2}\mathbf{k}_2), \quad \mathbf{k}_4 = f(\mathbf{s}_t + \Delta t \cdot \mathbf{k}_3)$$</p>
<p>$$\mathbf{s}_{t+1} = \mathbf{s}_t + \frac{\Delta t}{6}(\mathbf{k}_1 + 2\mathbf{k}_2 + 2\mathbf{k}_3 + \mathbf{k}_4)$$</p>
<p>æ›´ç²¾ç¡®ï¼ˆ4é˜¶ç²¾åº¦ vs Euler çš„ 1 é˜¶ï¼‰ï¼Œä½†æ…¢çº¦ 4 å€ã€‚é€‚åˆ<strong>æ²¡æœ‰é¢‘ç¹æ¥è§¦</strong>çš„åœºæ™¯ï¼ˆå¦‚ç©ºä¸­è¿åŠ¨ï¼‰ã€‚</p>

<h4>Implicitï¼ˆéšå¼ç§¯åˆ†ï¼‰</h4>
<p>MuJoCo 3.x æ–°å¢çš„éšå¼ä¸­ç‚¹æ³•ã€‚æœ€ç¨³å®šï¼Œç‰¹åˆ«é€‚åˆ<strong>åˆšæ€§ç³»ç»Ÿ</strong>ï¼ˆå¤§é˜»å°¼ã€ç¡¬å¼¹ç°§ï¼‰ã€‚é€Ÿåº¦ä»‹äº Euler å’Œ RK4 ä¹‹é—´ã€‚</p>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;!-- åœ¨ MJCF ä¸­é€‰æ‹©ç§¯åˆ†å™¨ --&gt;
&lt;option integrator="Euler"/&gt;      &lt;!-- é»˜è®¤ï¼Œæœ€å¿« --&gt;
&lt;option integrator="RK4"/&gt;        &lt;!-- æœ€ç²¾ç¡®ï¼Œæ— æ¥è§¦æ—¶æ¨è --&gt;
&lt;option integrator="implicit"/&gt;   &lt;!-- æœ€ç¨³å®šï¼Œåˆšæ€§ç³»ç»Ÿæ¨è --&gt;
&lt;option integrator="implicitfast"/&gt;  &lt;!-- éšå¼çš„å¿«é€Ÿè¿‘ä¼¼ --&gt;</code></pre>

<div class="box thm">
  <div class="box-title">âœ… ç§¯åˆ†å™¨é€‰æ‹©å»ºè®®</div>
  <table>
    <tr><th>åœºæ™¯</th><th>æ¨èç§¯åˆ†å™¨</th><th>åŸå› </th></tr>
    <tr><td>ä¸€èˆ¬æœºå™¨äººä»»åŠ¡ï¼ˆæœ‰æ¥è§¦ï¼‰</td><td>Euler</td><td>å¿«ä¸”è¶³å¤Ÿç¨³å®š</td></tr>
    <tr><td>ç²¾å¯†è½¨è¿¹è·Ÿè¸ª</td><td>RK4</td><td>é«˜ç²¾åº¦</td></tr>
    <tr><td>åˆšæ€§ç³»ç»Ÿï¼ˆå¤§é˜»å°¼/åˆšåº¦ï¼‰</td><td>implicit</td><td>ä¸ä¼šå› åˆšåº¦å¤§è€Œä¸ç¨³å®š</td></tr>
    <tr><td>RL è®­ç»ƒï¼ˆéœ€è¦å¤§é‡ä»¿çœŸï¼‰</td><td>Euler</td><td>é€Ÿåº¦æ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§</td></tr>
  </table>
</div>


<!-- ================================================================== -->
<!-- ç¬¬ä¸‰ç« ï¼šMJCF XML å®Œå…¨æŒ‡å—                                             -->
<!-- ================================================================== -->
<h2 id="ch3">ç¬¬ä¸‰ç« ï¼šMJCF XML å®Œå…¨æŒ‡å—</h2>

<p>è¿™ä¸€ç« æˆ‘ä»¬å°†<strong>é€è¡Œè§£è¯»</strong>æˆ‘ä»¬ PushBox é¡¹ç›®çš„ MJCF æ–‡ä»¶ã€‚ç†è§£ XML æ˜¯ä½¿ç”¨ MuJoCo çš„åŸºç¡€â€”â€”ä½ çš„ä»¿çœŸä¸–ç•Œåœ¨ XML ä¸­å®šä¹‰ï¼ŒPython ä»£ç åªæ˜¯åœ¨æ“çºµå®ƒã€‚</p>


<h3 id="ch3-root">3.1 æ ¹å…ƒç´ ä¸ compiler</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;mujoco model="push_box"&gt;
  &lt;compiler angle="degree" coordinate="local" inertiafromgeom="true"/&gt;
  ...
&lt;/mujoco&gt;</code></pre>

<h4><code>&lt;mujoco&gt;</code> â€” æ ¹å…ƒç´ </h4>
<p>æ‰€æœ‰ MJCF æ–‡ä»¶çš„æ ¹ã€‚<code>model</code> å±æ€§æ˜¯æ¨¡å‹åç§°ï¼Œä»…ç”¨äºæ ‡è¯†ã€‚</p>

<h4><code>&lt;compiler&gt;</code> â€” ç¼–è¯‘å™¨é…ç½®</h4>
<p>æ§åˆ¶ MJCF å¦‚ä½•è¢«<strong>è§£æå’Œç¼–è¯‘</strong>æˆå†…éƒ¨æ•°æ®ç»“æ„ï¼š</p>

<table>
<tr><th>å±æ€§</th><th>æˆ‘ä»¬çš„å€¼</th><th>è¯´æ˜</th></tr>
<tr><td><code>angle</code></td><td><code>"degree"</code></td><td>XML ä¸­çš„è§’åº¦å•ä½ã€‚<code>"degree"</code> è¡¨ç¤ºæ‰€æœ‰è§’åº¦å€¼ï¼ˆå¦‚å…³èŠ‚èŒƒå›´ <code>range="-180 180"</code>ï¼‰ç”¨åº¦æ•°ã€‚é»˜è®¤æ˜¯å¼§åº¦ <code>"radian"</code>ã€‚å†…éƒ¨è®¡ç®—å§‹ç»ˆä½¿ç”¨å¼§åº¦ã€‚</td></tr>
<tr><td><code>coordinate</code></td><td><code>"local"</code></td><td>body çš„ <code>pos</code> å±æ€§æ˜¯ç›¸å¯¹äº<strong>çˆ¶ body</strong> çš„å±€éƒ¨åæ ‡ã€‚å¦‚æœæ˜¯ <code>"global"</code> åˆ™æ˜¯ä¸–ç•Œåæ ‡ã€‚<code>"local"</code> æ›´ç›´è§‚â€”â€”å­ body çš„ä½ç½®å¤©ç„¶ç›¸å¯¹äºçˆ¶ body æè¿°ã€‚</td></tr>
<tr><td><code>inertiafromgeom</code></td><td><code>"true"</code></td><td>è‡ªåŠ¨ä» geom çš„å½¢çŠ¶å’Œå¯†åº¦è®¡ç®—æƒ¯æ€§å¼ é‡ã€‚æ— éœ€æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ª body çš„æƒ¯æ€§â€”â€”MuJoCo ä¼šå¸®ä½ ç®—ã€‚</td></tr>
</table>

<div class="box ex">
  <div class="box-title">ğŸ” è§’åº¦å•ä½çš„å½±å“</div>
  <p>å½“ <code>angle="degree"</code> æ—¶ï¼š</p>
  <ul>
    <li>XML ä¸­ï¼š<code>range="-180 180"</code> â†’ è¿™æ˜¯åº¦æ•°</li>
    <li>Python ä¸­ï¼š<code>data.qpos[0]</code> â†’ è¿™å§‹ç»ˆæ˜¯<strong>å¼§åº¦</strong>ï¼</li>
  </ul>
  <p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„å›°æƒ‘æ¥æºã€‚XML ç”¨åº¦æ•°è®©äººé˜…è¯»æ–¹ä¾¿ï¼Œä½† API ä¸­æ‰€æœ‰è§’åº¦éƒ½æ˜¯å¼§åº¦ã€‚</p>
</div>


<h3 id="ch3-option">3.2 option â€” ä»¿çœŸé€‰é¡¹</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;option timestep="0.002" integrator="Euler" gravity="0 0 -9.81"&gt;
  &lt;flag warmstart="enable"/&gt;
&lt;/option&gt;</code></pre>

<p><code>&lt;option&gt;</code> æ§åˆ¶ä»¿çœŸçš„å…¨å±€ç‰©ç†å‚æ•°ï¼š</p>

<table>
<tr><th>å±æ€§</th><th>æˆ‘ä»¬çš„å€¼</th><th>è¯´æ˜</th></tr>
<tr><td><code>timestep</code></td><td><code>"0.002"</code></td><td>ä»¿çœŸæ—¶é—´æ­¥é•¿ = 2ms = 500Hzã€‚å¹³è¡¡äº†ç¨³å®šæ€§å’Œé€Ÿåº¦ã€‚</td></tr>
<tr><td><code>integrator</code></td><td><code>"Euler"</code></td><td>åŠéšå¼æ¬§æ‹‰ç§¯åˆ†å™¨ã€‚RL è®­ç»ƒçš„é¦–é€‰ï¼ˆæœ€å¿«ï¼‰ã€‚</td></tr>
<tr><td><code>gravity</code></td><td><code>"0 0 -9.81"</code></td><td>é‡åŠ›åŠ é€Ÿåº¦å‘é‡ã€‚<code>z=-9.81</code> è¡¨ç¤º z è½´å‘ä¸Šæ˜¯æ­£æ–¹å‘ï¼Œé‡åŠ›å‘ä¸‹ã€‚ä½ ä¹Ÿå¯ä»¥è®¾ä¸º <code>"0 0 0"</code> æ¨¡æ‹Ÿå¤ªç©ºç¯å¢ƒã€‚</td></tr>
</table>

<h4><code>&lt;flag warmstart="enable"/&gt;</code></h4>
<p>Warmstart æ˜¯ä¸€ä¸ªä¼˜åŒ–æŠ€å·§ï¼šç”¨ä¸Šä¸€æ­¥çš„æ¥è§¦åŠ›è§£ä½œä¸ºè¿™ä¸€æ­¥çš„åˆå§‹çŒœæµ‹ï¼ŒåŠ é€Ÿæ±‚è§£å™¨æ”¶æ•›ã€‚å¯¹äºæœ‰<strong>æŒç»­æ¥è§¦</strong>çš„åœºæ™¯ï¼ˆå¦‚æ¨ç®±å­ï¼‰ï¼Œæ•ˆæœæ˜¾è‘—ã€‚</p>


<h3 id="ch3-visual">3.3 visual â€” æ¸²æŸ“è®¾ç½®</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;visual&gt;
  &lt;global offwidth="1280" offheight="720"/&gt;
  &lt;quality shadowsize="4096"/&gt;
  &lt;map force="0.1" zfar="30"/&gt;
&lt;/visual&gt;</code></pre>

<p>è§†è§‰è®¾ç½®ä¸å½±å“ç‰©ç†ä»¿çœŸï¼Œåªå½±å“æ¸²æŸ“ï¼š</p>

<table>
<tr><th>æ ‡ç­¾</th><th>å±æ€§</th><th>è¯´æ˜</th></tr>
<tr><td><code>&lt;global&gt;</code></td><td><code>offwidth, offheight</code></td><td>ç¦»å±æ¸²æŸ“åˆ†è¾¨ç‡ã€‚ç”¨äº <code>render_mode="rgb_array"</code> æ—¶è·å–å›¾åƒã€‚1280Ã—720 æ˜¯åˆç†çš„é»˜è®¤å€¼ã€‚</td></tr>
<tr><td><code>&lt;quality&gt;</code></td><td><code>shadowsize</code></td><td>é˜´å½±è´´å›¾åˆ†è¾¨ç‡ã€‚4096 ç»™å‡ºæ¸…æ™°çš„é˜´å½±ï¼Œä½†ä¼šå¢åŠ æ¸²æŸ“å¼€é”€ã€‚è®­ç»ƒæ—¶å¯ä»¥é™ä½æˆ–å…³é—­ã€‚</td></tr>
<tr><td><code>&lt;map&gt;</code></td><td><code>force</code></td><td>åŠ›å¯è§†åŒ–çš„ç¼©æ”¾å› å­ã€‚åœ¨ viewer ä¸­æŒ‰ 'C' é”®å¯ä»¥çœ‹åˆ°æ¥è§¦åŠ›ç®­å¤´ã€‚</td></tr>
<tr><td><code>&lt;map&gt;</code></td><td><code>zfar</code></td><td>è¿œè£å‰ªé¢è·ç¦»ã€‚ç‰©ä½“è¶…è¿‡è¿™ä¸ªè·ç¦»å°±ä¸æ¸²æŸ“äº†ã€‚</td></tr>
</table>


<h3 id="ch3-asset">3.4 asset â€” èµ„äº§ç³»ç»Ÿï¼ˆçº¹ç†å’Œæè´¨ï¼‰</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;asset&gt;
  &lt;!-- å¤©ç©ºç›’ï¼šèƒŒæ™¯çš„æ¸å˜è‰² --&gt;
  &lt;texture builtin="gradient" height="100" 
           rgb1="0.3 0.5 0.7" rgb2="0.1 0.2 0.3" 
           type="skybox" width="100"/&gt;
  
  &lt;!-- å‡ ä½•ä½“çº¹ç†ï¼šç”¨äºé»˜è®¤ç‰©ä½“è¡¨é¢ --&gt;
  &lt;texture builtin="flat" height="1278" mark="cross" markrgb="1 1 1" 
           name="texgeom" random="0.01" rgb1="0.8 0.6 0.4" rgb2="0.8 0.6 0.4" 
           type="cube" width="127"/&gt;
  
  &lt;!-- æ£‹ç›˜æ ¼çº¹ç†ï¼šç”¨äºåœ°é¢ --&gt;
  &lt;texture builtin="checker" height="100" name="texplane" 
           rgb1="0.2 0.2 0.2" rgb2="0.3 0.3 0.3" 
           type="2d" width="100"/&gt;
  
  &lt;!-- åœ°é¢æè´¨ --&gt;
  &lt;material name="MatPlane" reflectance="0.3" shininess="0.5" 
            specular="0.5" texrepeat="3 3" texture="texplane"/&gt;
  
  &lt;!-- å‡ ä½•ä½“é»˜è®¤æè´¨ --&gt;
  &lt;material name="geom" texture="texgeom" texuniform="true"/&gt;
&lt;/asset&gt;</code></pre>

<p>MuJoCo çš„èµ„äº§ç³»ç»Ÿåˆ†ä¸ºä¸¤å±‚ï¼š<strong>çº¹ç†ï¼ˆtextureï¼‰</strong> å’Œ <strong>æè´¨ï¼ˆmaterialï¼‰</strong>ã€‚</p>

<div class="box def">
  <div class="box-title">ğŸ“ çº¹ç† vs æè´¨</div>
  <ul>
    <li><strong>çº¹ç† (texture)</strong>ï¼šåŸå§‹å›¾åƒæ•°æ®ã€‚å¯ä»¥æ˜¯å†…ç½®æ¨¡å¼ï¼ˆchecker, gradient, flatï¼‰æˆ–å¤–éƒ¨å›¾ç‰‡æ–‡ä»¶ã€‚</li>
    <li><strong>æè´¨ (material)</strong>ï¼šå°†çº¹ç†ä¸å…‰ç…§å±æ€§ç»“åˆã€‚<code>shininess</code>ï¼ˆå…‰æ³½åº¦ï¼‰ã€<code>specular</code>ï¼ˆé«˜å…‰å¼ºåº¦ï¼‰ã€<code>reflectance</code>ï¼ˆåå°„ç‡ï¼‰ç­‰æ§åˆ¶ç‰©ä½“åœ¨å…‰ç…§ä¸‹çš„å¤–è§‚ã€‚</li>
    <li>çº¹ç†å¯ä»¥è¢«å¤šä¸ªæè´¨å¼•ç”¨ï¼Œæè´¨å¯ä»¥è¢«å¤šä¸ª geom å¼•ç”¨ã€‚</li>
  </ul>
</div>

<p>å†…ç½®çº¹ç†ç±»å‹ï¼š</p>
<ul>
  <li><code>builtin="checker"</code> â€” æ£‹ç›˜æ ¼ï¼ˆåœ°é¢ç»å…¸é€‰æ‹©ï¼‰</li>
  <li><code>builtin="gradient"</code> â€” æ¸å˜è‰²ï¼ˆå¤©ç©ºç›’å¸¸ç”¨ï¼‰</li>
  <li><code>builtin="flat"</code> â€” çº¯è‰²/å¸¦æ ‡è®°ï¼ˆç‰©ä½“è¡¨é¢ï¼‰</li>
</ul>


<h3 id="ch3-default">3.5 default â€” é»˜è®¤å‚æ•°ç³»ç»Ÿ</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;default&gt;
  &lt;joint armature="0.01" damping="0.1" limited="true"/&gt;
  &lt;geom conaffinity="1" condim="3" contype="1" 
        friction="0.5 0.005 0.0001" margin="0.001" 
        material="geom" rgba="0.8 0.6 0.4 1"/&gt;
&lt;/default&gt;</code></pre>

<p>MuJoCo çš„é»˜è®¤ç³»ç»Ÿéå¸¸å¼ºå¤§â€”â€”ä½ å¯ä»¥åœ¨ä¸€ä¸ªåœ°æ–¹è®¾ç½®æ‰€æœ‰åŒç±»å…ƒç´ çš„é»˜è®¤å‚æ•°ï¼Œé¿å…åˆ°å¤„é‡å¤ã€‚</p>

<h4>å…³èŠ‚é»˜è®¤ <code>&lt;joint&gt;</code></h4>

<table>
<tr><th>å±æ€§</th><th>å€¼</th><th>è¯´æ˜</th></tr>
<tr><td><code>armature</code></td><td><code>0.01</code></td><td>ç­‰æ•ˆè½¬åŠ¨æƒ¯é‡ã€‚æ¨¡æ‹Ÿç”µæœºè½¬å­çš„æƒ¯æ€§ï¼Œæœ‰åŠ©äºæ•°å€¼ç¨³å®šæ€§ã€‚ç‰©ç†æ„ä¹‰ï¼šåæ˜ åœ¨å…³èŠ‚å¯¹è§’çº¿ä¸Šçš„è´¨é‡çŸ©é˜µé™„åŠ é¡¹ã€‚</td></tr>
<tr><td><code>damping</code></td><td><code>0.1</code></td><td>å…³èŠ‚é˜»å°¼ç³»æ•°ã€‚äº§ç”Ÿä¸é€Ÿåº¦æˆæ­£æ¯”çš„é˜»åŠ› $\tau_d = -d \cdot \dot{q}$ã€‚é˜²æ­¢å…³èŠ‚æ— é™åŠ é€Ÿã€‚</td></tr>
<tr><td><code>limited</code></td><td><code>"true"</code></td><td>å¯ç”¨å…³èŠ‚é™ä½ã€‚éœ€è¦é…åˆå„å…³èŠ‚çš„ <code>range</code> å±æ€§ä½¿ç”¨ã€‚</td></tr>
</table>

<h4>å‡ ä½•ä½“é»˜è®¤ <code>&lt;geom&gt;</code></h4>

<table>
<tr><th>å±æ€§</th><th>å€¼</th><th>è¯´æ˜</th></tr>
<tr><td><code>contype</code></td><td><code>1</code></td><td>ç¢°æ’ç±»å‹æ©ç ã€‚ä¸¤ä¸ª geom åªæœ‰åœ¨ <code>(geom1.contype &amp; geom2.conaffinity) || (geom2.contype &amp; geom1.conaffinity)</code> æ—¶æ‰ä¼šç¢°æ’ã€‚</td></tr>
<tr><td><code>conaffinity</code></td><td><code>1</code></td><td>ç¢°æ’äº²å’Œæ©ç ã€‚é…åˆ contype å®ç°é€‰æ‹©æ€§ç¢°æ’ã€‚è®¾ç½®ä¸åŒçš„ä½æ©ç å¯ä»¥è®©æŸäº›ç‰©ä½“"ç©¿è¿‡"å½¼æ­¤ã€‚</td></tr>
<tr><td><code>condim</code></td><td><code>3</code></td><td>æ¥è§¦ç»´åº¦ã€‚<code>3</code> = 1 æ³•å‘åŠ› + 2 åˆ‡å‘æ‘©æ“¦åŠ›ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚<code>1</code> = æ— æ‘©æ“¦ã€‚<code>4</code> = åŠ æ‰­è½¬æ‘©æ“¦ã€‚<code>6</code> = å®Œæ•´æ¥è§¦ï¼ˆå«æ»šåŠ¨æ‘©æ“¦ï¼‰ã€‚</td></tr>
<tr><td><code>friction</code></td><td><code>"0.5 0.005 0.0001"</code></td><td>ä¸‰ä¸ªæ‘©æ“¦ç³»æ•°ï¼š<strong>æ»‘åŠ¨æ‘©æ“¦ 0.5</strong>ï¼ˆåˆ‡å‘åŠ›/æ³•å‘åŠ›æ¯”å€¼ä¸Šé™ï¼‰ã€<strong>æ‰­è½¬æ‘©æ“¦ 0.005</strong>ã€<strong>æ»šåŠ¨æ‘©æ“¦ 0.0001</strong></td></tr>
<tr><td><code>margin</code></td><td><code>0.001</code></td><td>ç¢°æ’æ£€æµ‹é—´è·ã€‚å½“ä¸¤ä¸ª geom çš„è·ç¦»å°äº margin æ—¶å°±è®¤ä¸º"å¯èƒ½æ¥è§¦"ã€‚æœ‰åŠ©äºæå‰æ£€æµ‹ç¢°æ’ï¼Œé¿å…ç©¿é€ã€‚</td></tr>
<tr><td><code>material</code></td><td><code>"geom"</code></td><td>é»˜è®¤æè´¨ã€‚æ‰€æœ‰æ²¡æœ‰æŒ‡å®šæè´¨çš„ geom éƒ½ç”¨è¿™ä¸ªã€‚</td></tr>
<tr><td><code>rgba</code></td><td><code>"0.8 0.6 0.4 1"</code></td><td>é»˜è®¤é¢œè‰²ï¼ˆRGBAï¼Œæ£•è‰²è°ƒï¼‰ã€‚å¦‚æœ geom æŒ‡å®šäº†è‡ªå·±çš„ rgbaï¼Œä¼šè¦†ç›–æ­¤é»˜è®¤å€¼ã€‚</td></tr>
</table>

<div class="box def">
  <div class="box-title">ğŸ“ æ‘©æ“¦ç³»æ•° friction è¯¦è§£</div>
  <p>MuJoCo çš„æ‘©æ“¦æ¨¡å‹æ¯”ç®€å•çš„åº“ä»‘æ‘©æ“¦æ›´ä¸°å¯Œã€‚ä¸‰ä¸ªç³»æ•°åˆ†åˆ«æ§åˆ¶ï¼š</p>
  <ol>
    <li><strong>æ»‘åŠ¨æ‘©æ“¦ (sliding)</strong> $\mu_s = 0.5$ï¼šæœ€é‡è¦çš„å‚æ•°ã€‚åˆ‡å‘æ‘©æ“¦åŠ› â‰¤ $\mu_s \times$ æ³•å‘åŠ›ã€‚0.5 æ˜¯é‡‘å±/å¡‘æ–™çš„å…¸å‹å€¼ã€‚</li>
    <li><strong>æ‰­è½¬æ‘©æ“¦ (torsional)</strong> $\mu_t = 0.005$ï¼šé˜»æ­¢ç‰©ä½“åœ¨æ¥è§¦é¢ä¸Šæ—‹è½¬çš„åŠ›çŸ©ã€‚é€šå¸¸å¾ˆå°ã€‚</li>
    <li><strong>æ»šåŠ¨æ‘©æ“¦ (rolling)</strong> $\mu_r = 0.0001$ï¼šé˜»æ­¢çƒä½“æ»šåŠ¨çš„åŠ›çŸ©ã€‚é€šå¸¸æå°ã€‚</li>
  </ol>
  <p>ä¸¤ä¸ªæ¥è§¦ geom çš„æ‘©æ“¦ç³»æ•°å–<strong>è¾ƒå¤§å€¼</strong>ï¼ˆè€Œéå¹³å‡å€¼ï¼‰ï¼Œè¿™ç¬¦åˆæ‘©æ“¦çš„ç‰©ç†ç›´è§‰â€”â€”ç²—ç³™è¡¨é¢å†³å®šæ‘©æ“¦åŠ›ã€‚</p>
</div>


<h3 id="ch3-worldbody">3.6 worldbody â€” ç‰©ä½“å±‚æ¬¡ç»“æ„</h3>

<p><code>&lt;worldbody&gt;</code> æ˜¯æ‰€æœ‰ç‰©ä½“çš„æ ¹å®¹å™¨ã€‚MuJoCo ä½¿ç”¨<strong>æ ‘å½¢ç»“æ„</strong>ç»„ç»‡ç‰©ä½“ï¼Œè¿™ä¸æœºå™¨äººçš„è¿åŠ¨é“¾å¤©ç„¶å¯¹åº”ï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;worldbody&gt;
  &lt;!-- å…‰æº --&gt;
  &lt;light directional="true" diffuse="0.8 0.8 0.8" pos="0 0 3" dir="0 0 -1"/&gt;
  &lt;light directional="true" diffuse="0.4 0.4 0.4" pos="0 0 3" dir="1 1 -1"/&gt;
  
  &lt;!-- åœ°é¢ --&gt;
  &lt;geom name="floor" type="plane" size="3 3 0.1" 
        rgba="0.8 0.8 0.8 1" material="MatPlane"/&gt;
  
  &lt;!-- æœºå™¨äººæ‰‹è‡‚ --&gt;
  &lt;body name="arm_base" pos="0 0 0.02"&gt;
    &lt;geom name="base_geom" type="cylinder" size="0.05 0.02" rgba="0.3 0.3 0.3 1"/&gt;
    &lt;body name="upper_arm" pos="0 0 0.02"&gt;
      &lt;joint name="shoulder" type="hinge" axis="0 0 1" 
             range="-180 180" damping="0.5"/&gt;
      &lt;geom name="upper_arm_geom" type="capsule" 
            fromto="0 0 0 0.4 0 0" size="0.025" rgba="0.5 0.5 0.8 1"/&gt;
      &lt;body name="forearm" pos="0.4 0 0"&gt;
        &lt;joint name="elbow" type="hinge" axis="0 0 1" 
               range="-180 180" damping="0.5"/&gt;
        &lt;geom name="forearm_geom" type="capsule" 
              fromto="0 0 0 0.3 0 0" size="0.025" rgba="0.5 0.5 0.8 1"/&gt;
        &lt;site name="endeffector" pos="0.3 0 0" size="0.03" rgba="1 0.5 0 0.8"/&gt;
      &lt;/body&gt;
    &lt;/body&gt;
  &lt;/body&gt;
  
  &lt;!-- å¯æ¨åŠ¨çš„ç®±å­ --&gt;
  &lt;body name="box" pos="0.35 0 0.05"&gt;
    &lt;freejoint name="box_freejoint"/&gt;
    &lt;geom name="box_geom" type="box" size="0.05 0.05 0.05" 
          mass="0.5" rgba="0.2 0.8 0.2 1" friction="0.5 0.005 0.0001"/&gt;
    &lt;site name="box_center" pos="0 0 0" size="0.01" rgba="0 1 0 1"/&gt;
  &lt;/body&gt;
  
  &lt;!-- ç›®æ ‡æ ‡è®° --&gt;
  &lt;site name="goal" pos="0.5 0.3 0.02" size="0.06" 
        rgba="1 0 0 0.4" type="sphere"/&gt;
&lt;/worldbody&gt;</code></pre>

<p>è®©æˆ‘ä»¬é€ä¸€è§£æå…³é”®å…ƒç´ ï¼š</p>

<h4><code>&lt;light&gt;</code> â€” å…‰æº</h4>
<p>æˆ‘ä»¬ç”¨äº†ä¸¤ä¸ªæ–¹å‘å…‰ï¼š</p>
<ul>
  <li>ç¬¬ä¸€ä¸ªï¼šä»æ­£ä¸Šæ–¹å‘ä¸‹ç…§å°„ (<code>dir="0 0 -1"</code>)ï¼Œäº®åº¦é«˜ (<code>diffuse="0.8 0.8 0.8"</code>)ï¼Œä½œä¸ºä¸»å…‰æº</li>
  <li>ç¬¬äºŒä¸ªï¼šä»ä¾§ä¸Šæ–¹ç…§å°„ (<code>dir="1 1 -1"</code>)ï¼Œäº®åº¦è¾ƒä½ï¼Œå¡«è¡¥é˜´å½±ï¼Œå¢åŠ ç«‹ä½“æ„Ÿ</li>
</ul>

<h4><code>&lt;geom&gt;</code> â€” ç¢°æ’/å¯è§†å‡ ä½•ä½“</h4>

<p>Geom æ˜¯ MuJoCo ä¸­æœ€åŸºæœ¬çš„"å¯è§å¯ç¢°"å•å…ƒã€‚å¸¸ç”¨ç±»å‹ï¼š</p>

<table>
<tr><th>type</th><th>å½¢çŠ¶</th><th>size å«ä¹‰</th><th>PushBox ä¸­çš„ä½¿ç”¨</th></tr>
<tr><td><code>plane</code></td><td>æ— é™å¹³é¢</td><td>åŠé•¿ã€åŠå®½ã€ç½‘æ ¼é—´è·</td><td>åœ°é¢ <code>floor</code></td></tr>
<tr><td><code>box</code></td><td>é•¿æ–¹ä½“</td><td>åŠé•¿ xã€åŠé•¿ yã€åŠé•¿ z</td><td>ç»¿è‰²ç®±å­ <code>box_geom</code>ï¼ˆ0.1m ç«‹æ–¹ä½“ï¼‰</td></tr>
<tr><td><code>sphere</code></td><td>çƒä½“</td><td>åŠå¾„</td><td>ç›®æ ‡æ ‡è®° <code>goal</code></td></tr>
<tr><td><code>capsule</code></td><td>èƒ¶å›Šä½“</td><td>åŠå¾„ï¼›ç”¨ <code>fromto</code> å®šä¹‰ä¸¤ç«¯</td><td>æ‰‹è‡‚è¿æ†</td></tr>
<tr><td><code>cylinder</code></td><td>åœ†æŸ±ä½“</td><td>åŠå¾„ã€åŠé«˜</td><td>æ‰‹è‡‚åŸºåº§ <code>base_geom</code></td></tr>
<tr><td><code>ellipsoid</code></td><td>æ¤­çƒä½“</td><td>ä¸‰ä¸ªåŠè½´</td><td>ï¼ˆæœªä½¿ç”¨ï¼‰</td></tr>
<tr><td><code>mesh</code></td><td>ä¸‰è§’ç½‘æ ¼</td><td>å¼•ç”¨ mesh èµ„äº§</td><td>ï¼ˆå¤æ‚æ¨¡å‹ä½¿ç”¨ï¼‰</td></tr>
</table>

<div class="box ex">
  <div class="box-title">ğŸ” fromto vs pos+size</div>
  <p>Capsule å’Œ cylinder æœ‰ä¸¤ç§å®šä¹‰æ–¹å¼ï¼š</p>
  <pre><code class="language-xml">&lt;!-- æ–¹å¼1: fromto â€”â€” æŒ‡å®šä¸¤ç«¯ç‚¹åæ ‡ï¼Œsize åªç»™åŠå¾„ --&gt;
&lt;geom type="capsule" fromto="0 0 0 0.4 0 0" size="0.025"/&gt;
&lt;!-- ä» (0,0,0) åˆ° (0.4,0,0)ï¼ŒåŠå¾„ 0.025 â†’ é•¿ 0.4m çš„èƒ¶å›Š --&gt;

&lt;!-- æ–¹å¼2: pos + size â€”â€” ä¸­å¿ƒä½ç½® + åŠå¾„å’ŒåŠé•¿ --&gt;
&lt;geom type="capsule" pos="0.2 0 0" size="0.025 0.2"/&gt;
&lt;!-- ä¸­å¿ƒåœ¨ (0.2,0,0)ï¼ŒåŠå¾„ 0.025ï¼ŒåŠé•¿ 0.2 â†’ åŒä¸€ä¸ªèƒ¶å›Š --&gt;</code></pre>
  <p><code>fromto</code> æ›´ç›´è§‚ï¼Œé€‚åˆå®šä¹‰è¿æ†ï¼ˆä»ä¸€ä¸ªå…³èŠ‚åˆ°å¦ä¸€ä¸ªå…³èŠ‚ï¼‰ã€‚</p>
</div>

<h4><code>&lt;body&gt;</code> â€” åˆšä½“</h4>
<p>Body æ˜¯åˆšä½“çš„å®¹å™¨ï¼Œä¸ç›´æ¥å‚ä¸ç¢°æ’ï¼ˆé‚£æ˜¯ geom çš„å·¥ä½œï¼‰ã€‚Body çš„ä½œç”¨æ˜¯ï¼š</p>
<ul>
  <li>å»ºç«‹<strong>çˆ¶å­å±‚çº§å…³ç³»</strong>ï¼ˆæ ‘å½¢è¿åŠ¨é“¾ï¼‰</li>
  <li>é€šè¿‡ <code>pos</code> å®šä¹‰ç›¸å¯¹äºçˆ¶ body çš„ä½ç½®åç§»</li>
  <li>ä½œä¸º jointã€geomã€site çš„æŒ‚è½½ç‚¹</li>
</ul>

<p>æˆ‘ä»¬æ‰‹è‡‚çš„å±‚çº§ç»“æ„ï¼š</p>

<div class="diagram">
world (ä¸å¯ç§»åŠ¨çš„å…¨å±€å‚è€ƒç³»)
â”œâ”€â”€ floor (geom)
â”œâ”€â”€ arm_base (body, pos="0 0 0.02")          â† åŸºåº§ï¼Œå›ºå®šåœ¨åœ°é¢ä¸Šæ–¹ 2cm
â”‚   â”œâ”€â”€ base_geom (cylinder)                  â† åŸºåº§å¤–è§‚
â”‚   â””â”€â”€ upper_arm (body, pos="0 0 0.02")      â† ä¸Šè‡‚ï¼Œåœ¨åŸºåº§ä¸Šæ–¹ 2cm
â”‚       â”œâ”€â”€ shoulder (hinge joint, zè½´)       â† è‚©å…³èŠ‚ï¼Œç»• z è½´æ—‹è½¬
â”‚       â”œâ”€â”€ upper_arm_geom (capsule, 0â†’0.4m)  â† ä¸Šè‡‚è¿æ†ï¼Œé•¿ 0.4m
â”‚       â””â”€â”€ forearm (body, pos="0.4 0 0")     â† å‰è‡‚ï¼Œåœ¨ä¸Šè‡‚æœ«ç«¯
â”‚           â”œâ”€â”€ elbow (hinge joint, zè½´)      â† è‚˜å…³èŠ‚ï¼Œç»• z è½´æ—‹è½¬
â”‚           â”œâ”€â”€ forearm_geom (capsule, 0â†’0.3m) â† å‰è‡‚è¿æ†ï¼Œé•¿ 0.3m
â”‚           â””â”€â”€ endeffector (site, 0.3 0 0)   â† æœ«ç«¯æ‰§è¡Œå™¨æ ‡è®°ç‚¹
â”œâ”€â”€ box (body, pos="0.35 0 0.05")             â† ç®±å­ï¼Œåˆå§‹ä½ç½®
â”‚   â”œâ”€â”€ box_freejoint (freejoint)             â† 6-DOF è‡ªç”±åº¦
â”‚   â”œâ”€â”€ box_geom (box)                        â† ç¢°æ’å‡ ä½•
â”‚   â””â”€â”€ box_center (site)                     â† ä¸­å¿ƒæ ‡è®°
â””â”€â”€ goal (site, pos="0.5 0.3 0.02")           â† ç›®æ ‡æ ‡è®°ï¼ˆçº¯è§†è§‰ï¼‰
</div>

<h4><code>&lt;joint&gt;</code> â€” å…³èŠ‚</h4>

<p>å…³èŠ‚å®šä¹‰äº†å­ body ç›¸å¯¹äºçˆ¶ body å¯ä»¥å¦‚ä½•è¿åŠ¨ï¼š</p>

<table>
<tr><th>ç±»å‹</th><th>è‡ªç”±åº¦</th><th>qpos ç»´åº¦</th><th>qvel ç»´åº¦</th><th>è¯´æ˜</th></tr>
<tr><td><code>hinge</code></td><td>1</td><td>1ï¼ˆè§’åº¦ï¼‰</td><td>1ï¼ˆè§’é€Ÿåº¦ï¼‰</td><td>ç»•æŒ‡å®šè½´æ—‹è½¬ã€‚æˆ‘ä»¬çš„ shoulder å’Œ elbow éƒ½æ˜¯ hingeã€‚</td></tr>
<tr><td><code>slide</code></td><td>1</td><td>1ï¼ˆä½ç§»ï¼‰</td><td>1ï¼ˆé€Ÿåº¦ï¼‰</td><td>æ²¿æŒ‡å®šè½´å¹³ç§»ã€‚ç”¨äºçº¿æ€§å¯¼è½¨ã€‚</td></tr>
<tr><td><code>ball</code></td><td>3</td><td>4ï¼ˆå››å…ƒæ•°ï¼‰</td><td>3ï¼ˆè§’é€Ÿåº¦ï¼‰</td><td>çƒå…³èŠ‚ï¼Œ3 è½´æ—‹è½¬è‡ªç”±åº¦ã€‚å¦‚è‚©çƒå…³èŠ‚ã€‚</td></tr>
<tr><td><code>free</code></td><td>6</td><td>7ï¼ˆ3ä½ç½®+4å››å…ƒæ•°ï¼‰</td><td>6ï¼ˆ3çº¿é€Ÿåº¦+3è§’é€Ÿåº¦ï¼‰</td><td>å®Œå…¨è‡ªç”±ã€‚ç”¨äºä¸ä¸å…¶ä»–ç‰©ä½“å›ºè¿çš„å¯¹è±¡ï¼ˆå¦‚æˆ‘ä»¬çš„ç®±å­ï¼‰ã€‚</td></tr>
</table>

<p>æˆ‘ä»¬æ‰‹è‡‚çš„å…³èŠ‚ï¼š</p>
<pre><code class="language-xml"><span class="code-label">XML</span>&lt;!-- shoulder: è‚©å…³èŠ‚ --&gt;
&lt;joint name="shoulder" 
       type="hinge"           &lt;!-- é“°é“¾å…³èŠ‚ --&gt;
       axis="0 0 1"           &lt;!-- ç»• z è½´æ—‹è½¬ï¼ˆä¿¯è§†çœ‹æ˜¯æ°´å¹³é¢ä¸Šçš„æ—‹è½¬ï¼‰ --&gt;
       range="-180 180"       &lt;!-- æ—‹è½¬èŒƒå›´ï¼šÂ±180Â° (å› ä¸º angle="degree") --&gt;
       damping="0.5"/&gt;        &lt;!-- è¦†ç›–é»˜è®¤çš„ 0.1ï¼Œç”¨æ›´å¤§çš„é˜»å°¼ --&gt;

&lt;!-- elbow: è‚˜å…³èŠ‚ --&gt;
&lt;joint name="elbow" 
       type="hinge" 
       axis="0 0 1" 
       range="-180 180" 
       damping="0.5"/&gt;</code></pre>

<p>æ³¨æ„ <code>damping="0.5"</code> <strong>è¦†ç›–äº†</strong> default ä¸­çš„ <code>damping="0.1"</code>ã€‚å­å…ƒç´ çš„æ˜¾å¼å±æ€§å§‹ç»ˆä¼˜å…ˆäºé»˜è®¤å€¼ã€‚</p>

<h4><code>&lt;site&gt;</code> â€” è™šæ‹Ÿæ ‡è®°ç‚¹</h4>

<p>Site æ˜¯"è™šæ‹Ÿçš„"â€”â€”å®ƒæ²¡æœ‰è´¨é‡ï¼Œä¸å‚ä¸ç¢°æ’ï¼Œåªæ˜¯ä¸€ä¸ª<strong>ä½ç½®æ ‡è®°</strong>ï¼š</p>
<ul>
  <li><code>endeffector</code>ï¼šæ ‡è®°æ‰‹è‡‚æœ«ç«¯çš„ä½ç½®ï¼Œç”¨äºè®¡ç®—è·ç¦»ï¼ˆé€šè¿‡ <code>data.site_xpos</code>ï¼‰</li>
  <li><code>box_center</code>ï¼šæ ‡è®°ç®±å­ä¸­å¿ƒï¼ˆä¹Ÿå¯ä»¥ç›´æ¥ç”¨ qposï¼‰</li>
  <li><code>goal</code>ï¼šç›®æ ‡ä½ç½®æ ‡è®°ï¼ˆå¯è§†åŒ–ç”¨çš„åŠé€æ˜çº¢è‰²çƒï¼Œä¹Ÿç”¨äºè·ç¦»è®¡ç®—ï¼‰</li>
</ul>

<p>Site çš„å…¸å‹ç”¨é€”ï¼š</p>
<ul>
  <li><strong>ä¼ æ„Ÿå™¨æŒ‚è½½ç‚¹</strong>ï¼šåŠ›ä¼ æ„Ÿå™¨ã€è§¦è§‰ä¼ æ„Ÿå™¨æ”¾åœ¨ site ä¸Š</li>
  <li><strong>è§‚æµ‹è®¡ç®—</strong>ï¼šé€šè¿‡ <code>data.site_xpos</code> è·å–ç‰¹å®šä½ç½®</li>
  <li><strong>å¯è§†åŒ–</strong>ï¼šæ ‡è®°å…³é”®ä½ç½®ï¼ˆå¦‚ç›®æ ‡ã€æœ«ç«¯æ‰§è¡Œå™¨ï¼‰</li>
  <li><strong>ç­‰å¼çº¦æŸ</strong>ï¼šweld çº¦æŸå¯ä»¥ç”¨ site å®šä¹‰</li>
</ul>

<h4><code>&lt;freejoint&gt;</code> â€” è‡ªç”±å…³èŠ‚</h4>
<pre><code class="language-xml"><span class="code-label">XML</span>&lt;body name="box" pos="0.35 0 0.05"&gt;
  &lt;freejoint name="box_freejoint"/&gt;  &lt;!-- 6 è‡ªç”±åº¦ --&gt;
  &lt;geom name="box_geom" type="box" size="0.05 0.05 0.05" mass="0.5" .../&gt;
&lt;/body&gt;</code></pre>

<p><code>freejoint</code> æ˜¯ <code>type="free"</code> å…³èŠ‚çš„ç®€å†™ã€‚å®ƒèµ‹äºˆç‰©ä½“<strong>å®Œå…¨çš„ 6 ä¸ªè‡ªç”±åº¦</strong>ï¼š3 ä¸ªå¹³ç§» + 3 ä¸ªæ—‹è½¬ã€‚æ²¡æœ‰ freejoint çš„ç‰©ä½“ä¼šè¢«"ç„Šæ¥"åœ¨çˆ¶ body ä¸Šã€‚</p>

<div class="box warn">
  <div class="box-title">âš ï¸ freejoint çš„ qpos å¸ƒå±€</div>
  <p>freejoint åœ¨ qpos ä¸­å  <strong>7 ä¸ªä½ç½®</strong>ï¼š</p>
  <pre><code>[x, y, z, qw, qx, qy, qz]
 ^ä½ç½®^    ^---å››å…ƒæ•°---^</code></pre>
  <p>å››å…ƒæ•°ä½¿ç”¨ <strong>(w, x, y, z)</strong> é¡ºåºï¼ˆw åœ¨å‰ï¼ï¼‰ï¼Œå…¶ä¸­ï¼š</p>
  <ul>
    <li>$qw = \cos(\theta/2)$ï¼Œ$(qx, qy, qz) = \sin(\theta/2) \cdot \hat{\mathbf{n}}$</li>
    <li>å•ä½å››å…ƒæ•° (1, 0, 0, 0) è¡¨ç¤º"æ— æ—‹è½¬"</li>
    <li>MuJoCo è‡ªåŠ¨å½’ä¸€åŒ–å››å…ƒæ•°ï¼ˆä¿è¯ $\|\mathbf{q}\| = 1$ï¼‰</li>
  </ul>
  <p>è€Œ qvel ä¸­åªå  <strong>6 ä¸ªä½ç½®</strong>ï¼š<code>[vx, vy, vz, wx, wy, wz]</code>ï¼ˆçº¿é€Ÿåº¦ + è§’é€Ÿåº¦ï¼‰ã€‚</p>
</div>


<h3 id="ch3-actuator">3.7 actuator â€” æ‰§è¡Œå™¨</h3>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;actuator&gt;
  &lt;motor name="shoulder_motor" joint="shoulder" 
         gear="1.0" ctrllimited="true" ctrlrange="-10 10"/&gt;
  &lt;motor name="elbow_motor" joint="elbow" 
         gear="1.0" ctrllimited="true" ctrlrange="-10 10"/&gt;
&lt;/actuator&gt;</code></pre>

<p>æ‰§è¡Œå™¨å°†<strong>æ§åˆ¶ä¿¡å·</strong>ï¼ˆ<code>data.ctrl</code>ï¼‰è½¬åŒ–ä¸º<strong>å…³èŠ‚åŠ›çŸ©</strong>ã€‚MuJoCo æä¾›å¤šç§æ‰§è¡Œå™¨ç±»å‹ï¼š</p>

<table>
<tr><th>ç±»å‹</th><th>æ§åˆ¶è¾“å…¥å«ä¹‰</th><th>å†…éƒ¨æœºåˆ¶</th><th>é€‚ç”¨åœºæ™¯</th></tr>
<tr><td><code>motor</code></td><td>åŠ›çŸ© (Nm)</td><td>$\tau = \text{gear} \times \text{ctrl}$</td><td><strong>åŠ›çŸ©æ§åˆ¶ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„ï¼‰</strong></td></tr>
<tr><td><code>position</code></td><td>ç›®æ ‡è§’åº¦ (rad)</td><td>$\tau = k_p \times (q_{\text{target}} - q) - k_d \times \dot{q}$</td><td>ä½ç½®ä¼ºæœ</td></tr>
<tr><td><code>velocity</code></td><td>ç›®æ ‡è§’é€Ÿåº¦ (rad/s)</td><td>$\tau = k_v \times (\dot{q}_{\text{target}} - \dot{q})$</td><td>é€Ÿåº¦æ§åˆ¶</td></tr>
<tr><td><code>general</code></td><td>è‡ªå®šä¹‰</td><td>å¯é…ç½®å„ç§å¢ç›Šå’Œåç½®</td><td>å¤æ‚æ‰§è¡Œå™¨æ¨¡å‹</td></tr>
</table>

<p>æˆ‘ä»¬çš„å…³é”®å‚æ•°è§£é‡Šï¼š</p>
<ul>
  <li><code>gear="1.0"</code>ï¼šä¼ åŠ¨æ¯”ã€‚ctrl Ã— gear = å®é™…åŠ›çŸ©ã€‚<code>1.0</code> è¡¨ç¤ºç›´é©±ï¼Œctrl å°±æ˜¯åŠ›çŸ©ã€‚</li>
  <li><code>ctrllimited="true"</code>ï¼šå¯ç”¨æ§åˆ¶è¾“å…¥é™å¹…ã€‚è¶…å‡º ctrlrange çš„å€¼ä¼šè¢«è£å‰ªã€‚</li>
  <li><code>ctrlrange="-10 10"</code>ï¼šæ§åˆ¶è¾“å…¥èŒƒå›´ã€‚å¯¹åº” Â±10 Nm çš„åŠ›çŸ©ã€‚</li>
</ul>

<div class="box ex">
  <div class="box-title">ğŸ” åŠ›çŸ©æ§åˆ¶ vs ä½ç½®æ§åˆ¶</div>
  <p><strong>åŠ›çŸ©æ§åˆ¶</strong>ï¼ˆæˆ‘ä»¬çš„é€‰æ‹©ï¼‰ï¼š</p>
  <ul>
    <li>RL æ™ºèƒ½ä½“ç›´æ¥æ§åˆ¶åŠ›çŸ©ï¼Œæœ‰æœ€å¤§çš„çµæ´»æ€§</li>
    <li>å¯ä»¥åšç²¾ç¡®çš„åŠ›æ§åˆ¶ï¼ˆå¦‚æ¨ç®±å­æ—¶éœ€è¦ç²¾ç¡®åŠ›é‡ï¼‰</li>
    <li>ä½†å­¦ä¹ éš¾åº¦æ›´å¤§â€”â€”æ™ºèƒ½ä½“éœ€è¦è‡ªå·±å®ç°"ç¨³å®šæ€§"</li>
  </ul>
  <p><strong>ä½ç½®æ§åˆ¶</strong>ï¼ˆå¦‚æœç”¨ <code>&lt;position&gt;</code>ï¼‰ï¼š</p>
  <ul>
    <li>RL æ™ºèƒ½ä½“è¾“å‡ºç›®æ ‡è§’åº¦ï¼ŒPD æ§åˆ¶å™¨è´Ÿè´£è·Ÿè¸ª</li>
    <li>æ›´ç¨³å®šï¼Œæ›´å®¹æ˜“å­¦ä¹ </li>
    <li>ä½†ç‰ºç‰²äº†åŠ›æ§ç²¾åº¦â€”â€”ä¸é€‚åˆéœ€è¦ç²¾ç¡®æ¥è§¦åŠ›çš„ä»»åŠ¡</li>
  </ul>
</div>


<h3 id="ch3-sensor">3.8 sensor â€” ä¼ æ„Ÿå™¨</h3>

<p>æˆ‘ä»¬å½“å‰çš„ PushBox æ¨¡å‹æ²¡æœ‰å®šä¹‰ä¼ æ„Ÿå™¨ï¼ˆç›´æ¥ä» qpos/site_xpos è·å–ä¿¡æ¯ï¼‰ï¼Œä½† MuJoCo æä¾›äº†ä¸°å¯Œçš„ä¼ æ„Ÿå™¨ç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨ä¼ æ„Ÿå™¨åŠå…¶ç”¨æ³•ï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;!-- å¦‚æœæˆ‘ä»¬è¦ç»™ PushBox æ·»åŠ ä¼ æ„Ÿå™¨ --&gt;
&lt;sensor&gt;
  &lt;!-- å…³èŠ‚ä½ç½®ä¼ æ„Ÿå™¨ --&gt;
  &lt;jointpos name="shoulder_pos" joint="shoulder"/&gt;
  &lt;jointpos name="elbow_pos" joint="elbow"/&gt;
  
  &lt;!-- å…³èŠ‚é€Ÿåº¦ä¼ æ„Ÿå™¨ --&gt;
  &lt;jointvel name="shoulder_vel" joint="shoulder"/&gt;
  &lt;jointvel name="elbow_vel" joint="elbow"/&gt;
  
  &lt;!-- å…³èŠ‚åŠ›çŸ©ä¼ æ„Ÿå™¨ï¼ˆæµ‹é‡å®é™…æ–½åŠ çš„åŠ›çŸ©ï¼‰ --&gt;
  &lt;actuatorfrc name="shoulder_force" actuator="shoulder_motor"/&gt;
  
  &lt;!-- åŠ é€Ÿåº¦è®¡ï¼ˆæŒ‚è½½åœ¨ site ä¸Šï¼‰ --&gt;
  &lt;accelerometer name="ee_accel" site="endeffector"/&gt;
  
  &lt;!-- è§¦è§‰ä¼ æ„Ÿå™¨ï¼ˆæ£€æµ‹æ¥è§¦åŠ›ï¼‰ --&gt;
  &lt;touch name="box_touch" site="box_center"/&gt;
  
  &lt;!-- ä½ç½®ä¼ æ„Ÿå™¨ï¼ˆè·å– site çš„ä¸–ç•Œåæ ‡ï¼‰ --&gt;
  &lt;framepos name="ee_pos" objtype="site" objname="endeffector"/&gt;
&lt;/sensor&gt;</code></pre>

<pre><code class="language-python"><span class="code-label">PYTHON</span># è¯»å–ä¼ æ„Ÿå™¨æ•°æ®
# æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®å­˜å‚¨åœ¨è¿ç»­æ•°ç»„ä¸­
sensor_data = data.sensordata

# é€šè¿‡ ID è·å–ç‰¹å®šä¼ æ„Ÿå™¨
sid = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SENSOR, "shoulder_pos")
adr = model.sensor_adr[sid]  # åœ¨ sensordata ä¸­çš„èµ·å§‹åœ°å€
dim = model.sensor_dim[sid]  # æ•°æ®ç»´åº¦
value = data.sensordata[adr:adr+dim]</code></pre>

<div class="box thm">
  <div class="box-title">âœ… ä½•æ—¶ç”¨ä¼ æ„Ÿå™¨ vs ç›´æ¥è®¿é—® data</div>
  <p><strong>ç›´æ¥è®¿é—®</strong>ï¼ˆå¦‚ <code>data.qpos</code>, <code>data.site_xpos</code>ï¼‰ï¼šç®€å•ç›´æ¥ï¼Œé€‚åˆä»¿çœŸå†…ä½¿ç”¨ã€‚</p>
  <p><strong>ä¼ æ„Ÿå™¨</strong>ï¼š</p>
  <ul>
    <li>å½“ä½ æƒ³æ¨¡æ‹Ÿ<strong>ç°å®ä¸­ä¼ æ„Ÿå™¨çš„ç‰¹æ€§</strong>ï¼ˆæœ‰é™ç²¾åº¦ã€å™ªå£°ã€å»¶è¿Ÿï¼‰</li>
    <li>å½“ä½ éœ€è¦<strong>åŠ›/åŠ›çŸ©æµ‹é‡</strong>ï¼ˆè¿™äº›æ²¡æœ‰å¯¹åº”çš„"ç›´æ¥è®¿é—®"æ–¹å¼ï¼‰</li>
    <li>ä¸º <strong>sim-to-real</strong> åšå‡†å¤‡â€”â€”çœŸå®æœºå™¨äººåªèƒ½é€šè¿‡ä¼ æ„Ÿå™¨è·å–ä¿¡æ¯</li>
  </ul>
</div>


<h3 id="ch3-full">3.9 å®Œæ•´ XML é€è¡Œæ³¨é‡Š</h3>

<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬ <code>push_box.xml</code> çš„å®Œæ•´æ³¨é‡Šç‰ˆæœ¬ã€‚å»ºè®®å¯¹ç…§ç€çœ‹ï¼š</p>

<pre><code class="language-xml"><span class="code-label">push_box.xml â€” å®Œæ•´æ³¨é‡Š</span>&lt;mujoco model="push_box"&gt;
  &lt;!-- ==================== ç¼–è¯‘å™¨é…ç½® ==================== --&gt;
  &lt;!-- angle="degree": XMLä¸­è§’åº¦ç”¨åº¦è¡¨ç¤ºï¼ˆå†…éƒ¨ä»ç”¨å¼§åº¦ï¼‰ --&gt;
  &lt;!-- coordinate="local": bodyçš„posæ˜¯ç›¸å¯¹çˆ¶bodyçš„åç§» --&gt;
  &lt;!-- inertiafromgeom="true": è‡ªåŠ¨ä»geomè®¡ç®—æƒ¯æ€§ --&gt;
  &lt;compiler angle="degree" coordinate="local" inertiafromgeom="true"/&gt;
  
  &lt;!-- ==================== ä»¿çœŸé€‰é¡¹ ==================== --&gt;
  &lt;!-- timestep=0.002: æ¯æ­¥2msï¼Œ500Hzä»¿çœŸé¢‘ç‡ --&gt;
  &lt;!-- Eulerç§¯åˆ†: æœ€å¿«çš„ç§¯åˆ†å™¨ï¼ŒRLè®­ç»ƒé¦–é€‰ --&gt;
  &lt;!-- gravity: zè½´å‘ä¸Šï¼Œé‡åŠ›åŠ é€Ÿåº¦9.81 m/sÂ² --&gt;
  &lt;option timestep="0.002" integrator="Euler" gravity="0 0 -9.81"&gt;
    &lt;flag warmstart="enable"/&gt;  &lt;!-- ç”¨ä¸Šä¸€æ­¥çš„æ¥è§¦åŠ›åˆå§‹åŒ–æœ¬æ­¥æ±‚è§£ --&gt;
  &lt;/option&gt;
  
  &lt;!-- ==================== æ¸²æŸ“è®¾ç½®ï¼ˆä¸å½±å“ç‰©ç†ï¼‰ ==================== --&gt;
  &lt;visual&gt;
    &lt;global offwidth="1280" offheight="720"/&gt;  &lt;!-- ç¦»å±æ¸²æŸ“åˆ†è¾¨ç‡ --&gt;
    &lt;quality shadowsize="4096"/&gt;               &lt;!-- é«˜è´¨é‡é˜´å½± --&gt;
    &lt;map force="0.1" zfar="30"/&gt;               &lt;!-- åŠ›å¯è§†åŒ–ç¼©æ”¾ + è¿œè£é¢ --&gt;
  &lt;/visual&gt;
  
  &lt;!-- ==================== çº¹ç†å’Œæè´¨ ==================== --&gt;
  &lt;asset&gt;
    &lt;texture builtin="gradient" height="100" 
             rgb1="0.3 0.5 0.7" rgb2="0.1 0.2 0.3" type="skybox" width="100"/&gt;
    &lt;texture builtin="flat" height="1278" mark="cross" markrgb="1 1 1" 
             name="texgeom" random="0.01" rgb1="0.8 0.6 0.4" rgb2="0.8 0.6 0.4" 
             type="cube" width="127"/&gt;
    &lt;texture builtin="checker" height="100" name="texplane" 
             rgb1="0.2 0.2 0.2" rgb2="0.3 0.3 0.3" type="2d" width="100"/&gt;
    &lt;material name="MatPlane" reflectance="0.3" shininess="0.5" 
              specular="0.5" texrepeat="3 3" texture="texplane"/&gt;
    &lt;material name="geom" texture="texgeom" texuniform="true"/&gt;
  &lt;/asset&gt;
  
  &lt;!-- ==================== é»˜è®¤å‚æ•° ==================== --&gt;
  &lt;!-- æ‰€æœ‰ joint é»˜è®¤: æœ‰å°æƒ¯é‡(armature)ã€å°é˜»å°¼ã€æœ‰é™ä½ --&gt;
  &lt;!-- æ‰€æœ‰ geom é»˜è®¤: å‚ä¸ç¢°æ’ã€3ç»´æ¥è§¦ã€æ‘©æ“¦ç³»æ•°0.5 --&gt;
  &lt;default&gt;
    &lt;joint armature="0.01" damping="0.1" limited="true"/&gt;
    &lt;geom conaffinity="1" condim="3" contype="1" 
          friction="0.5 0.005 0.0001" margin="0.001" 
          material="geom" rgba="0.8 0.6 0.4 1"/&gt;
  &lt;/default&gt;
  
  &lt;!-- ==================== ä¸–ç•Œç‰©ä½“ ==================== --&gt;
  &lt;worldbody&gt;
    &lt;!-- ä¸¤ä¸ªæ–¹å‘å…‰ï¼šä¸»å…‰(ä¸Šæ–¹) + è¡¥å…‰(ä¾§æ–¹) --&gt;
    &lt;light directional="true" diffuse="0.8 0.8 0.8" pos="0 0 3" dir="0 0 -1"/&gt;
    &lt;light directional="true" diffuse="0.4 0.4 0.4" pos="0 0 3" dir="1 1 -1"/&gt;
    
    &lt;!-- åœ°é¢ï¼ˆæ— é™å¹³é¢ï¼Œz=0ï¼‰ --&gt;
    &lt;geom name="floor" type="plane" size="3 3 0.1" 
          rgba="0.8 0.8 0.8 1" material="MatPlane"/&gt;
    
    &lt;!-- ===== æœºå™¨äººæ‰‹è‡‚ ===== --&gt;
    &lt;!-- åŸºåº§: z=0.02 ä½¿æ‰‹è‡‚ä¸ç®±å­åŒä¸€é«˜åº¦ --&gt;
    &lt;body name="arm_base" pos="0 0 0.02"&gt;
      &lt;!-- åŸºåº§å¤–è§‚: åœ†æŸ±ä½“ r=0.05, h=0.04 --&gt;
      &lt;geom name="base_geom" type="cylinder" size="0.05 0.02" 
            rgba="0.3 0.3 0.3 1"/&gt;
      
      &lt;!-- ä¸Šè‡‚: å†ä¸Šç§»0.02(åœ¨åŸºåº§é¡¶éƒ¨) --&gt;
      &lt;body name="upper_arm" pos="0 0 0.02"&gt;
        &lt;!-- è‚©å…³èŠ‚: hingeç»•zè½´, èŒƒå›´Â±180Â°, é˜»å°¼0.5 --&gt;
        &lt;joint name="shoulder" type="hinge" axis="0 0 1" 
               range="-180 180" damping="0.5"/&gt;
        &lt;!-- ä¸Šè‡‚è¿æ†: ä»åŸç‚¹åˆ°(0.4,0,0), åŠå¾„0.025 --&gt;
        &lt;geom name="upper_arm_geom" type="capsule" 
              fromto="0 0 0 0.4 0 0" size="0.025" rgba="0.5 0.5 0.8 1"/&gt;
        
        &lt;!-- å‰è‡‚: åœ¨ä¸Šè‡‚æœ«ç«¯(0.4,0,0) --&gt;
        &lt;body name="forearm" pos="0.4 0 0"&gt;
          &lt;!-- è‚˜å…³èŠ‚: åŒæ ·ç»•zè½´ --&gt;
          &lt;joint name="elbow" type="hinge" axis="0 0 1" 
                 range="-180 180" damping="0.5"/&gt;
          &lt;!-- å‰è‡‚è¿æ†: é•¿0.3m --&gt;
          &lt;geom name="forearm_geom" type="capsule" 
                fromto="0 0 0 0.3 0 0" size="0.025" rgba="0.5 0.5 0.8 1"/&gt;
          &lt;!-- æœ«ç«¯æ‰§è¡Œå™¨æ ‡è®°(æ©™è‰², åŠå¾„0.03) --&gt;
          &lt;site name="endeffector" pos="0.3 0 0" size="0.03" 
                rgba="1 0.5 0 0.8"/&gt;
        &lt;/body&gt;
      &lt;/body&gt;
    &lt;/body&gt;
    
    &lt;!-- ===== å¯æ¨åŠ¨çš„ç®±å­ ===== --&gt;
    &lt;!-- åˆå§‹ä½ç½®: x=0.35(åœ¨æ‰‹è‡‚å¤Ÿå¾—åˆ°çš„èŒƒå›´), z=0.05(åŠé«˜) --&gt;
    &lt;body name="box" pos="0.35 0 0.05"&gt;
      &lt;!-- freejoint: 6-DOFè‡ªç”±åº¦, ç®±å­å¯ä»¥è‡ªç”±ç§»åŠ¨å’Œæ—‹è½¬ --&gt;
      &lt;freejoint name="box_freejoint"/&gt;
      &lt;!-- ç®±å­: 0.1Ã—0.1Ã—0.1m, è´¨é‡0.5kg, ç»¿è‰² --&gt;
      &lt;geom name="box_geom" type="box" size="0.05 0.05 0.05" 
            mass="0.5" rgba="0.2 0.8 0.2 1" 
            friction="0.5 0.005 0.0001"/&gt;
      &lt;site name="box_center" pos="0 0 0" size="0.01" rgba="0 1 0 1"/&gt;
    &lt;/body&gt;
    
    &lt;!-- ===== ç›®æ ‡æ ‡è®°ï¼ˆçº¯è§†è§‰ï¼‰ ===== --&gt;
    &lt;!-- çº¢è‰²åŠé€æ˜çƒ, åœ¨æ‰‹è‡‚+æ¨åŠ¨èŒƒå›´å†… --&gt;
    &lt;site name="goal" pos="0.5 0.3 0.02" size="0.06" 
          rgba="1 0 0 0.4" type="sphere"/&gt;
  &lt;/worldbody&gt;
  
  &lt;!-- ==================== æ‰§è¡Œå™¨ ==================== --&gt;
  &lt;!-- ä¸¤ä¸ªåŠ›çŸ©ç”µæœº, ç›´é©±(gear=1), èŒƒå›´Â±10 Nm --&gt;
  &lt;actuator&gt;
    &lt;motor name="shoulder_motor" joint="shoulder" 
           gear="1.0" ctrllimited="true" ctrlrange="-10 10"/&gt;
    &lt;motor name="elbow_motor" joint="elbow" 
           gear="1.0" ctrllimited="true" ctrlrange="-10 10"/&gt;
  &lt;/actuator&gt;
&lt;/mujoco&gt;</code></pre>


<!-- ================================================================== -->
<!-- ç¬¬å››ç« ï¼šPython API                                                   -->
<!-- ================================================================== -->
<h2 id="ch4">ç¬¬å››ç« ï¼šMuJoCo Python API</h2>

<h3 id="ch4-load">4.1 æ¨¡å‹åŠ è½½</h3>

<p>MuJoCo 3.x æä¾›äº†å‡ ç§åŠ è½½æ¨¡å‹çš„æ–¹å¼ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco

# === æ–¹å¼1: ä»æ–‡ä»¶åŠ è½½ MJCF XML ===
model = mujoco.MjModel.from_xml_path("push_box.xml")

# === æ–¹å¼2: ä»å­—ç¬¦ä¸²åŠ è½½ ===
xml_string = """
&lt;mujoco&gt;
  &lt;worldbody&gt;
    &lt;geom type="plane" size="5 5 0.1"/&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;
"""
model = mujoco.MjModel.from_xml_string(xml_string)

# === æ–¹å¼3: ä» URDF åŠ è½½ï¼ˆä¼šè‡ªåŠ¨è½¬æ¢ï¼‰ ===
model = mujoco.MjModel.from_xml_path("robot.urdf")

# === æ–¹å¼4: ä»å·²ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶åŠ è½½ï¼ˆæ›´å¿«ï¼‰ ===
# å…ˆä¿å­˜
mujoco.mj_saveModel(model, "push_box.mjb", None)
# å†åŠ è½½
model = mujoco.MjModel.from_binary_path("push_box.mjb")

# === åˆ›å»º MjDataï¼ˆå¿…é¡»ï¼æ¯ä¸ª model è‡³å°‘éœ€è¦ä¸€ä¸ª dataï¼‰ ===
data = mujoco.MjData(model)</code></pre>

<div class="box warn">
  <div class="box-title">âš ï¸ å¸¸è§åŠ è½½é”™è¯¯</div>
  <ul>
    <li><strong>æ–‡ä»¶è·¯å¾„é”™è¯¯</strong>ï¼šç”¨ <code>os.path.join()</code> æ„å»ºè·¯å¾„ï¼Œè€Œéå­—ç¬¦ä¸²æ‹¼æ¥</li>
    <li><strong>XML è¯­æ³•é”™è¯¯</strong>ï¼šMuJoCo æŠ¥é”™ä¿¡æ¯é€šå¸¸å¾ˆè¯¦ç»†ï¼Œçœ‹æŠ¥é”™çš„è¡Œå·å’Œå±æ€§å</li>
    <li><strong>å¼•ç”¨ç¼ºå¤±</strong>ï¼šæè´¨/çº¹ç†/mesh å¼•ç”¨äº†ä¸å­˜åœ¨çš„åç§°</li>
    <li><strong>meshdir é”™è¯¯</strong>ï¼šå¦‚æœç”¨äº†å¤–éƒ¨ mesh æ–‡ä»¶ï¼Œæ£€æŸ¥ <code>compiler meshdir</code> è®¾ç½®</li>
  </ul>
</div>


<h3 id="ch4-data">4.2 æ•°æ®è®¿é—®è¯¦è§£</h3>

<p>ç†è§£å¦‚ä½•è¯»å†™ <code>MjData</code> ä¸­çš„æ•°æ®æ˜¯ä½¿ç”¨ MuJoCo çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ä»¥ä¸‹æ˜¯ PushBox ä¸­æ‰€æœ‰é‡è¦æ•°æ®çš„å®Œæ•´è¯´æ˜ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco
import numpy as np

model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

# ====================================================================
# qpos â€” å¹¿ä¹‰åæ ‡ï¼ˆGeneralized Coordinatesï¼‰
# ====================================================================
# PushBox çš„ qpos å¸ƒå±€ (nq=9):
# ç´¢å¼•:  [0]         [1]       [2]  [3]  [4]   [5]   [6]   [7]   [8]
# å«ä¹‰:  shoulder    elbow     box_x box_y box_z box_qw box_qx box_qy box_qz
# å•ä½:  å¼§åº¦        å¼§åº¦      ç±³    ç±³    ç±³    æ— é‡çº²  æ— é‡çº²  æ— é‡çº²  æ— é‡çº²

print(f"qpos = {data.qpos}")
# åˆå§‹å€¼å¤§æ¦‚æ˜¯: [0, 0, 0.35, 0, 0.05, 1, 0, 0, 0]

# è®¾ç½®å…³èŠ‚è§’åº¦
data.qpos[0] = np.radians(45)   # shoulder è½¬ 45Â°
data.qpos[1] = np.radians(-30)  # elbow è½¬ -30Â°

# è®¾ç½®ç®±å­ä½ç½®
data.qpos[2:5] = [0.4, 0.1, 0.05]  # x, y, z
data.qpos[5:9] = [1, 0, 0, 0]       # å››å…ƒæ•°ï¼ˆæ— æ—‹è½¬ï¼‰

# ====================================================================
# qvel â€” å¹¿ä¹‰é€Ÿåº¦ï¼ˆGeneralized Velocitiesï¼‰
# ====================================================================
# PushBox çš„ qvel å¸ƒå±€ (nv=8):
# ç´¢å¼•:  [0]           [1]         [2]    [3]    [4]    [5]    [6]    [7]
# å«ä¹‰:  shoulder_vel  elbow_vel   box_vx box_vy box_vz box_wx box_wy box_wz
# å•ä½:  rad/s         rad/s       m/s    m/s    m/s    rad/s  rad/s  rad/s

# æ³¨æ„ nv=8 < nq=9ï¼Œå› ä¸ºå››å…ƒæ•° 4 ç»´ â†’ è§’é€Ÿåº¦ 3 ç»´

# ====================================================================
# ctrl â€” æ§åˆ¶è¾“å…¥
# ====================================================================
# ç›´æ¥å¯¹åº” actuator çš„é¡ºåº
data.ctrl[0] = 5.0   # shoulder_motor åŠ›çŸ© = 5 Nm
data.ctrl[1] = -2.0  # elbow_motor åŠ›çŸ© = -2 Nm

# ctrl ä¼šè¢« ctrlrange è£å‰ª: [-10, 10]
data.ctrl[0] = 999   # å®é™…åªæ–½åŠ  10 Nm

# ====================================================================
# è®¡ç®—åçš„ä½ç½®ä¿¡æ¯ï¼ˆéœ€è¦å…ˆ mj_forward æˆ– mj_stepï¼‰
# ====================================================================
mujoco.mj_forward(model, data)  # æ›´æ–°æ‰€æœ‰è®¡ç®—é‡

# xpos â€” æ¯ä¸ª body çš„ä¸–ç•Œåæ ‡ä½ç½® (shape: nbody Ã— 3)
for i in range(model.nbody):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, i) or "world"
    print(f"  body '{name}': pos = {data.xpos[i]}")

# xquat â€” æ¯ä¸ª body çš„ä¸–ç•Œåæ ‡å§¿æ€ï¼ˆå››å…ƒæ•°ï¼‰
print(f"box å§¿æ€: {data.xquat[4]}")  # box æ˜¯ç¬¬ 5 ä¸ª body (0-indexed)

# site_xpos â€” æ¯ä¸ª site çš„ä¸–ç•Œåæ ‡ä½ç½®
ee_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SITE, "endeffector")
goal_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SITE, "goal")
print(f"æœ«ç«¯æ‰§è¡Œå™¨: {data.site_xpos[ee_id]}")
print(f"ç›®æ ‡ä½ç½®: {data.site_xpos[goal_id]}")

# ====================================================================
# å…¶ä»–æœ‰ç”¨çš„æ•°æ®
# ====================================================================
print(f"ä»¿çœŸæ—¶é—´: {data.time:.4f}s")
print(f"æ¥è§¦æ•°é‡: {data.ncon}")           # å½“å‰æ¥è§¦ç‚¹æ•°
print(f"è´¨é‡çŸ©é˜µå¤§å°: {model.nv}Ã—{model.nv}")  # 8Ã—8</code></pre>


<h3 id="ch4-name2id">4.3 åç§°åˆ° ID æ˜ å°„</h3>

<p>MuJoCo å†…éƒ¨ä½¿ç”¨æ•´æ•° ID æ¥æ ‡è¯†æ‰€æœ‰å…ƒç´ ã€‚<code>mj_name2id()</code> æ˜¯åœ¨åç§°å’Œ ID ä¹‹é—´è½¬æ¢çš„æ¡¥æ¢ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco

model = mujoco.MjModel.from_xml_path("push_box.xml")

# ========== name â†’ id ==========
# éœ€è¦æŒ‡å®šå…ƒç´ ç±»å‹ï¼ˆbody, joint, geom, site, actuator...ï¼‰

# Body ID
box_body_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_BODY, "box")
print(f"box body ID: {box_body_id}")  # â†’ 4

# Joint ID
shoulder_jnt_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_JOINT, "shoulder")
elbow_jnt_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_JOINT, "elbow")

# Geom ID
box_geom_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_GEOM, "box_geom")

# Site ID
ee_site_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SITE, "endeffector")

# Actuator ID
motor_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_ACTUATOR, "shoulder_motor")

# ========== id â†’ name ==========
name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, 4)
print(f"Body 4 is: {name}")  # â†’ "box"

# ========== åç§°ä¸å­˜åœ¨æ—¶è¿”å› -1 ==========
bad_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_BODY, "nonexistent")
print(f"Not found: {bad_id}")  # â†’ -1

# ========== é€šè¿‡ model çš„å‘½åå­—æ®µå¿«é€ŸæŸ¥æ‰¾ ==========
# MuJoCo 3.x æ”¯æŒæ›´ Pythonic çš„æ–¹å¼ï¼š
print(f"å…³èŠ‚ qpos åœ°å€: {model.jnt_qposadr}")  # æ¯ä¸ªå…³èŠ‚åœ¨ qpos ä¸­çš„èµ·å§‹ä½ç½®
print(f"å…³èŠ‚ qvel åœ°å€: {model.jnt_dofadr}")    # æ¯ä¸ªå…³èŠ‚åœ¨ qvel ä¸­çš„èµ·å§‹ä½ç½®</code></pre>

<div class="box thm">
  <div class="box-title">âœ… ç¼“å­˜ ID ä»¥æå‡æ€§èƒ½</div>
  <p>åœ¨ RL è®­ç»ƒä¸­ï¼Œ<code>mj_name2id()</code> æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåšå­—ç¬¦ä¸²æŸ¥æ‰¾ã€‚æœ€ä½³å®è·µæ˜¯åœ¨ <code>__init__</code> ä¸­ç¼“å­˜æ‰€æœ‰éœ€è¦çš„ IDï¼š</p>
  <pre><code class="language-python">class PushBoxEnv(gym.Env):
    def __init__(self):
        # ...
        # ç¼“å­˜ IDï¼ˆåªæŸ¥æ‰¾ä¸€æ¬¡ï¼‰
        self._ee_site_id = mujoco.mj_name2id(
            self.model, mujoco.mjtObj.mjOBJ_SITE, "endeffector"
        )
        self._box_body_id = mujoco.mj_name2id(
            self.model, mujoco.mjtObj.mjOBJ_BODY, "box"
        )
    
    def _get_obs(self):
        # ç›´æ¥ç”¨ç¼“å­˜çš„ IDï¼Œé¿å…é‡å¤æŸ¥æ‰¾
        ee_pos = self.data.site_xpos[self._ee_site_id]
        # ...</code></pre>
</div>


<h3 id="ch4-sim">4.4 ä»¿çœŸæ­¥è¿› â€” mj_step vs mj_forward</h3>

<p>è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯ MuJoCo æœ€æ ¸å¿ƒçš„ APIï¼Œä½†å®ƒä»¬çš„ä½œç”¨å®Œå…¨ä¸åŒï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ mj_step vs mj_forward</div>
  <table>
    <tr><th>å‡½æ•°</th><th>ä½œç”¨</th><th>æ”¹å˜ qpos/qvelï¼Ÿ</th><th>æ”¹å˜ timeï¼Ÿ</th></tr>
    <tr><td><code>mj_step(model, data)</code></td><td>å®Œæ•´çš„ä»¿çœŸæ­¥è¿›ï¼šè®¡ç®—åŠ› â†’ ç§¯åˆ† â†’ æ›´æ–°çŠ¶æ€</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td></tr>
    <tr><td><code>mj_forward(model, data)</code></td><td>ä»…æ­£å‘è®¡ç®—ï¼šä» qpos/qvel è®¡ç®— xposã€æ¥è§¦ç­‰</td><td>âŒ å¦</td><td>âŒ å¦</td></tr>
  </table>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span># mj_step: ä»¿çœŸå‰è¿›ä¸€æ­¥
# ç­‰ä»·äº mj_step1(model, data) + mj_step2(model, data)
mujoco.mj_step(model, data)
# data.time å¢åŠ äº† model.opt.timestep
# data.qpos, data.qvel è¢«æ›´æ–°

# mj_forward: ä»…è®¡ç®—ï¼ˆä¸ç§¯åˆ†ï¼‰
# å¸¸ç”¨äºï¼š
# 1. è®¾ç½®åˆå§‹çŠ¶æ€åï¼Œéœ€è¦è®¡ç®— xpos ç­‰
data.qpos[0] = np.radians(45)
mujoco.mj_forward(model, data)  # æ›´æ–° xpos, site_xpos ç­‰
# data.time ä¸å˜ï¼Œqpos/qvel ä¸å˜

# 2. reset åéœ€è¦æ›´æ–°è®¡ç®—é‡
mujoco.mj_resetData(model, data)
data.qpos[:] = initial_state
mujoco.mj_forward(model, data)  # ç¡®ä¿ xpos ç­‰æ˜¯æœ€æ–°çš„

# ===== å¤šæ¬¡ step çš„å¸¸è§æ¨¡å¼ =====
# RL ç¯å¢ƒä¸­ï¼Œæ¯ä¸ª env.step() é€šå¸¸æ‰§è¡Œå¤šæ¬¡ mj_step()
n_substeps = 5  # 5 Ã— 0.002s = 0.01s çš„ä»¿çœŸæ—¶é—´
for _ in range(n_substeps):
    mujoco.mj_step(model, data)
# è¿™æ · RL çš„å†³ç­–é¢‘ç‡ = 100Hzï¼Œç‰©ç†ä»¿çœŸé¢‘ç‡ = 500Hz</code></pre>

<div class="box warn">
  <div class="box-title">âš ï¸ å¿˜è®°è°ƒç”¨ mj_forward çš„åæœ</div>
  <p>å¦‚æœä½ ä¿®æ”¹äº† <code>qpos</code> ä½†æ²¡æœ‰è°ƒç”¨ <code>mj_forward()</code>ï¼Œé‚£ä¹ˆ <code>data.xpos</code>ã€<code>data.site_xpos</code> ç­‰è®¡ç®—é‡<strong>ä»ç„¶æ˜¯æ—§å€¼</strong>ï¼è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ bug æ¥æºï¼š</p>
  <pre><code class="language-python"># âŒ é”™è¯¯ï¼šè¯»åˆ°çš„æ˜¯æ—§çš„ xpos
data.qpos[0] = np.radians(90)
print(data.site_xpos[0])  # è¿˜æ˜¯æ—§å€¼ï¼

# âœ… æ­£ç¡®ï¼šå…ˆ forward å†è¯»
data.qpos[0] = np.radians(90)
mujoco.mj_forward(model, data)
print(data.site_xpos[0])  # æ­£ç¡®çš„æ–°å€¼</code></pre>
</div>


<h3 id="ch4-collision">4.5 ç¢°æ’æ£€æµ‹</h3>

<p>ç¢°æ’æ£€æµ‹æ˜¯ MuJoCo æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä½ å¯ä»¥æŸ¥è¯¢å½“å‰æ—¶åˆ»æ‰€æœ‰çš„æ¥è§¦ä¿¡æ¯ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco
import numpy as np

model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

# ä»¿çœŸå‡ æ­¥ï¼Œè®©ç‰©ä½“æ¥è§¦
for _ in range(100):
    mujoco.mj_step(model, data)

# ===== æ¥è§¦ä¿¡æ¯ =====
print(f"å½“å‰æ¥è§¦ç‚¹æ•°: {data.ncon}")

# éå†æ‰€æœ‰æ¥è§¦
for i in range(data.ncon):
    contact = data.contact[i]
    
    # æ¥è§¦çš„ä¸¤ä¸ª geom
    geom1_name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_GEOM, contact.geom1)
    geom2_name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_GEOM, contact.geom2)
    
    # æ¥è§¦ä½ç½®ï¼ˆä¸–ç•Œåæ ‡ï¼‰
    pos = contact.pos
    
    # ç©¿é€æ·±åº¦ï¼ˆè´Ÿ = åˆ†ç¦»ï¼Œ0 = åˆšå¥½æ¥è§¦ï¼Œæ­£ = ç©¿é€ï¼‰
    dist = contact.dist
    
    # æ¥è§¦æ³•å‘é‡
    frame = contact.frame.reshape(3, 3)  # 3Ã—3 æ—‹è½¬çŸ©é˜µ
    normal = frame[0]  # ç¬¬ä¸€è¡Œæ˜¯æ³•å‘é‡
    
    print(f"  æ¥è§¦ {i}: {geom1_name} â†” {geom2_name}")
    print(f"    ä½ç½®: {pos}, è·ç¦»: {dist:.6f}")
    print(f"    æ³•å‘é‡: {normal}")

# ===== æ£€æŸ¥ç‰¹å®šç‰©ä½“å¯¹æ˜¯å¦æ¥è§¦ =====
def is_contacting(data, model, geom_name1, geom_name2):
    """æ£€æŸ¥ä¸¤ä¸ª geom æ˜¯å¦åœ¨æ¥è§¦"""
    id1 = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_GEOM, geom_name1)
    id2 = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_GEOM, geom_name2)
    for i in range(data.ncon):
        c = data.contact[i]
        if (c.geom1 == id1 and c.geom2 == id2) or \
           (c.geom1 == id2 and c.geom2 == id1):
            return True
    return False

arm_touching_box = is_contacting(data, model, "forearm_geom", "box_geom")
print(f"æ‰‹è‡‚æ­£åœ¨æ¥è§¦ç®±å­: {arm_touching_box}")</code></pre>


<h3 id="ch4-render">4.6 æ¸²æŸ“</h3>

<p>MuJoCo 3.x æä¾›äº†å¤šç§æ¸²æŸ“æ–¹å¼ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco
import numpy as np

model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

# ===== æ–¹å¼1: äº¤äº’å¼ Viewer =====
# å¼¹å‡ºçª—å£ï¼Œå¯ä»¥æ—‹è½¬ã€ç¼©æ”¾ã€æš‚åœ
import mujoco.viewer
viewer = mujoco.viewer.launch_passive(model, data)

while viewer.is_running():
    mujoco.mj_step(model, data)
    viewer.sync()

# ===== æ–¹å¼2: ç¦»å±æ¸²æŸ“ï¼ˆè·å–å›¾åƒæ•°ç»„ï¼‰ =====
# é€‚åˆ RL è®­ç»ƒä¸­çš„è§†è§‰è§‚å¯Ÿï¼Œæˆ–å½•åˆ¶è§†é¢‘
renderer = mujoco.Renderer(model, height=480, width=640)

mujoco.mj_forward(model, data)
renderer.update_scene(data)
image = renderer.render()  # numpy array (480, 640, 3), uint8

# ä¿å­˜å›¾åƒ
from PIL import Image
Image.fromarray(image).save("frame.png")

# ===== æ–¹å¼3: å½•åˆ¶è§†é¢‘ =====
frames = []
for _ in range(500):
    mujoco.mj_step(model, data)
    if len(frames) % 10 == 0:  # æ¯ 10 æ­¥å½•ä¸€å¸§
        renderer.update_scene(data)
        frames.append(renderer.render().copy())

# ç”¨ imageio ä¿å­˜è§†é¢‘
import imageio
imageio.mimsave("simulation.mp4", frames, fps=30)</code></pre>

<div class="box ex">
  <div class="box-title">ğŸ” Viewer å¿«æ·é”®</div>
  <table>
    <tr><th>å¿«æ·é”®</th><th>åŠŸèƒ½</th></tr>
    <tr><td>Space</td><td>æš‚åœ/ç»§ç»­</td></tr>
    <tr><td>Backspace</td><td>é‡ç½®</td></tr>
    <tr><td>Tab</td><td>æ˜¾ç¤º/éšè— UI é¢æ¿</td></tr>
    <tr><td>é¼ æ ‡å·¦é”®æ‹–åŠ¨</td><td>æ—‹è½¬è§†è§’</td></tr>
    <tr><td>é¼ æ ‡å³é”®æ‹–åŠ¨</td><td>å¹³ç§»è§†è§’</td></tr>
    <tr><td>æ»šè½®</td><td>ç¼©æ”¾</td></tr>
    <tr><td>C</td><td>æ˜¾ç¤ºæ¥è§¦åŠ›</td></tr>
    <tr><td>J</td><td>æ˜¾ç¤ºå…³èŠ‚è½´</td></tr>
    <tr><td>U</td><td>æ˜¾ç¤ºè´¨å¿ƒ</td></tr>
    <tr><td>F</td><td>æ˜¾ç¤ºå¸§</td></tr>
    <tr><td>T</td><td>é€æ˜/ä¸é€æ˜</td></tr>
    <tr><td>W</td><td>çº¿æ¡†æ¨¡å¼</td></tr>
    <tr><td>åŒå‡»ç‰©ä½“</td><td>é€‰ä¸­ç‰©ä½“ï¼Œæ˜¾ç¤ºå…¶å±æ€§</td></tr>
    <tr><td>Ctrl + å³é”®æ‹–åŠ¨</td><td>å¯¹é€‰ä¸­ç‰©ä½“æ–½åŠ›ï¼ˆäº¤äº’å¼æµ‹è¯•ï¼‰</td></tr>
  </table>
</div>


<!-- ================================================================== -->
<!-- ç¬¬äº”ç« ï¼šæœºå™¨äººå»ºæ¨¡                                                    -->
<!-- ================================================================== -->
<h2 id="ch5">ç¬¬äº”ç« ï¼šæœºå™¨äººå»ºæ¨¡</h2>

<h3 id="ch5-chain">5.1 å…³èŠ‚é“¾ â€” ä¸²è”æœºæ„çš„å»ºæ¨¡æ–¹æ³•</h3>

<p>å¤§å¤šæ•°æœºå™¨äººæ‰‹è‡‚æ˜¯<strong>ä¸²è”æœºæ„ï¼ˆSerial Manipulatorï¼‰</strong>â€”â€”ä¸€ç³»åˆ—è¿æ†é€šè¿‡å…³èŠ‚é¦–å°¾ç›¸è¿ã€‚åœ¨ MuJoCo ä¸­ï¼Œè¿™å¤©ç„¶å¯¹åº” body çš„åµŒå¥—å±‚çº§ï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ ä¸²è”æœºæ„çš„æ•°å­¦æè¿°</div>
  <p>ä¸€ä¸ª $n$ è‡ªç”±åº¦çš„ä¸²è”æœºæ„æœ‰ $n$ ä¸ªå…³èŠ‚å’Œ $n+1$ ä¸ªè¿æ†ï¼ˆåŒ…æ‹¬åŸºåº§ï¼‰ã€‚æ¯ä¸ªå…³èŠ‚ $i$ æœ‰ä¸€ä¸ªå¹¿ä¹‰åæ ‡ $q_i$ï¼Œæè¿°å­è¿æ†ç›¸å¯¹äºçˆ¶è¿æ†çš„è¿åŠ¨ã€‚</p>
  <p>æ•´ä¸ªç³»ç»Ÿçš„<strong>æ„å‹ç©ºé—´ï¼ˆConfiguration Space, C-spaceï¼‰</strong>æ˜¯æ‰€æœ‰å…³èŠ‚è§’åº¦çš„ç»„åˆï¼š</p>
  <p>$$\mathbf{q} = (q_1, q_2, \ldots, q_n) \in \mathbb{R}^n$$</p>
  <p>å¯¹æˆ‘ä»¬çš„ 2-DOF æ‰‹è‡‚ï¼š$\mathbf{q} = (q_{\text{shoulder}}, q_{\text{elbow}}) \in [-\pi, \pi]^2$</p>
</div>

<p>å»ºæ¨¡åŸåˆ™ï¼š</p>
<ol>
  <li><strong>ä»åŸºåº§å¼€å§‹</strong>ï¼šåŸºåº§å›ºå®šåœ¨ worldbody ä¸Šï¼ˆæ²¡æœ‰ freejoint = å›ºå®šï¼‰</li>
  <li><strong>é€çº§åµŒå¥—</strong>ï¼šæ¯ä¸ªè¿æ†æ˜¯ä¸€ä¸ª bodyï¼Œå…³èŠ‚å®šä¹‰åœ¨å­ body å†…</li>
  <li><strong>joint å®šä¹‰çš„æ˜¯è¿åŠ¨</strong>ï¼šå…³èŠ‚ä¸æ˜¯ä¸€ä¸ªç‰©ç†å®ä½“ï¼Œè€Œæ˜¯æè¿°å­ body ç›¸å¯¹äºçˆ¶ body çš„è¿åŠ¨è‡ªç”±åº¦</li>
  <li><strong>pos æ˜¯åç§»</strong>ï¼šå­ body çš„ <code>pos</code> æ˜¯å½“æ‰€æœ‰å…³èŠ‚è§’ä¸º 0 æ—¶ï¼Œå­ä½“åŸç‚¹ç›¸å¯¹äºçˆ¶ä½“åŸç‚¹çš„åç§»</li>
</ol>


<h3 id="ch5-2dof">5.2 æˆ‘ä»¬çš„ 2-DOF æœºæ¢°è‡‚</h3>

<p>PushBox çš„æ‰‹è‡‚æ˜¯ä¸€ä¸ªç»å…¸çš„ <strong>2-DOF å¹³é¢æ—‹è½¬æœºæ¢°è‡‚</strong>ï¼ˆSCARA-likeï¼‰ï¼Œä¸¤ä¸ªå…³èŠ‚éƒ½ç»• z è½´æ—‹è½¬ï¼Œæ‰‹è‡‚åœ¨ xy å¹³é¢è¿åŠ¨ã€‚</p>

<h4>æ­£è¿åŠ¨å­¦ï¼ˆForward Kinematicsï¼‰</h4>

<p>ç»™å®šå…³èŠ‚è§’åº¦ $q_1$ï¼ˆshoulderï¼‰å’Œ $q_2$ï¼ˆelbowï¼‰ï¼Œæœ«ç«¯æ‰§è¡Œå™¨çš„ä½ç½®ä¸ºï¼š</p>

<p>$$x = L_1 \cos(q_1) + L_2 \cos(q_1 + q_2)$$</p>
<p>$$y = L_1 \sin(q_1) + L_2 \sin(q_1 + q_2)$$</p>

<p>å…¶ä¸­ $L_1 = 0.4\text{m}$ï¼ˆä¸Šè‡‚é•¿ï¼‰ï¼Œ$L_2 = 0.3\text{m}$ï¼ˆå‰è‡‚é•¿ï¼‰ã€‚</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import numpy as np
import mujoco

def forward_kinematics(q1, q2, L1=0.4, L2=0.3):
    """æ‰‹åŠ¨è®¡ç®— 2-DOF æ­£è¿åŠ¨å­¦"""
    x = L1 * np.cos(q1) + L2 * np.cos(q1 + q2)
    y = L1 * np.sin(q1) + L2 * np.sin(q1 + q2)
    return x, y

# éªŒè¯ï¼šä¸ MuJoCo çš„è®¡ç®—ä¸€è‡´
model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

q1 = np.radians(30)   # shoulder 30Â°
q2 = np.radians(-45)  # elbow -45Â°

data.qpos[0] = q1
data.qpos[1] = q2
mujoco.mj_forward(model, data)

# æ‰‹åŠ¨è®¡ç®—
x_manual, y_manual = forward_kinematics(q1, q2)

# MuJoCo è®¡ç®—ï¼ˆè€ƒè™‘åŸºåº§åç§»ï¼‰
ee_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SITE, "endeffector")
x_mujoco = data.site_xpos[ee_id][0]
y_mujoco = data.site_xpos[ee_id][1]

print(f"æ‰‹åŠ¨: ({x_manual:.4f}, {y_manual:.4f})")
print(f"MuJoCo: ({x_mujoco:.4f}, {y_mujoco:.4f})")
# åº”è¯¥éå¸¸æ¥è¿‘ï¼ˆå·®å¼‚æ¥è‡ªåŸºåº§åç§»ï¼‰</code></pre>

<h4>å·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰</h4>

<p>å·¥ä½œç©ºé—´æ˜¯æœ«ç«¯æ‰§è¡Œå™¨èƒ½åˆ°è¾¾çš„æ‰€æœ‰ç‚¹çš„é›†åˆï¼š</p>

<ul>
  <li><strong>æœ€å¤§è‡‚å±•</strong>ï¼š$L_1 + L_2 = 0.7\text{m}$ï¼ˆæ‰‹è‡‚å®Œå…¨ä¼¸ç›´ï¼‰</li>
  <li><strong>æœ€å°è‡‚å±•</strong>ï¼š$|L_1 - L_2| = 0.1\text{m}$ï¼ˆæ‰‹è‡‚å®Œå…¨æŠ˜å ï¼‰</li>
  <li><strong>å·¥ä½œç©ºé—´å½¢çŠ¶</strong>ï¼šä»¥åŸç‚¹ä¸ºåœ†å¿ƒï¼ŒåŠå¾„ 0.1m åˆ° 0.7m çš„ç¯å½¢åŒºåŸŸ</li>
</ul>

<pre><code class="language-python"><span class="code-label">PYTHON</span># ç»˜åˆ¶å·¥ä½œç©ºé—´
import matplotlib.pyplot as plt

L1, L2 = 0.4, 0.3
theta1 = np.linspace(-np.pi, np.pi, 200)
theta2 = np.linspace(-np.pi, np.pi, 200)
T1, T2 = np.meshgrid(theta1, theta2)

X = L1 * np.cos(T1) + L2 * np.cos(T1 + T2)
Y = L1 * np.sin(T1) + L2 * np.sin(T1 + T2)

plt.figure(figsize=(8, 8))
plt.plot(X.flatten(), Y.flatten(), '.', markersize=0.1, alpha=0.3)
plt.plot(0.5, 0.3, 'r*', markersize=20, label='ç›®æ ‡ä½ç½®')
plt.plot(0.35, 0, 'gs', markersize=10, label='ç®±å­åˆå§‹ä½ç½®')
plt.xlabel('x (m)')
plt.ylabel('y (m)')
plt.title('2-DOF æœºæ¢°è‡‚å·¥ä½œç©ºé—´')
plt.axis('equal')
plt.legend()
plt.grid(True)
plt.savefig('workspace.png', dpi=150)
# ç›®æ ‡ä½ç½®(0.5, 0.3) è·åŸç‚¹ â‰ˆ 0.58mï¼Œåœ¨å·¥ä½œç©ºé—´å†… âœ“</code></pre>

<h4>é›…å¯æ¯”çŸ©é˜µï¼ˆJacobianï¼‰</h4>

<p>é›…å¯æ¯”çŸ©é˜µå°†å…³èŠ‚ç©ºé—´é€Ÿåº¦æ˜ å°„åˆ°æœ«ç«¯æ‰§è¡Œå™¨çš„ç¬›å¡å°”é€Ÿåº¦ï¼š</p>

<p>$$\dot{\mathbf{x}} = J(\mathbf{q}) \dot{\mathbf{q}}$$</p>

<p>å¯¹æˆ‘ä»¬çš„ 2-DOF æ‰‹è‡‚ï¼š</p>

<p>$$J = \begin{bmatrix} -L_1 \sin q_1 - L_2 \sin(q_1+q_2) & -L_2 \sin(q_1+q_2) \\ L_1 \cos q_1 + L_2 \cos(q_1+q_2) & L_2 \cos(q_1+q_2) \end{bmatrix}$$</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span># MuJoCo å¯ä»¥è‡ªåŠ¨è®¡ç®—é›…å¯æ¯”çŸ©é˜µ
jacp = np.zeros((3, model.nv))  # ä½ç½®é›…å¯æ¯” (3 Ã— nv)
jacr = np.zeros((3, model.nv))  # æ—‹è½¬é›…å¯æ¯” (3 Ã— nv)

mujoco.mj_jacSite(model, data, jacp, jacr, ee_id)

# å¯¹äºæˆ‘ä»¬çš„ 2-DOF æ‰‹è‡‚ï¼Œåªçœ‹ xy å¹³é¢å’Œå‰ä¸¤åˆ—
J_xy = jacp[:2, :2]
print(f"ä½ç½®é›…å¯æ¯” (xy):\n{J_xy}")

# é›…å¯æ¯”çš„ç”¨é€”ï¼š
# 1. æœ«ç«¯é€Ÿåº¦ = J Ã— å…³èŠ‚é€Ÿåº¦
# 2. å…³èŠ‚åŠ›çŸ© = J^T Ã— æœ«ç«¯åŠ›ï¼ˆåŠ›æ˜ å°„ï¼‰
# 3. J çš„å¥‡å¼‚å€¼ â†’ å¯æ“ä½œåº¦ï¼ˆmanipulabilityï¼‰</code></pre>


<h3 id="ch5-freebody">5.3 è‡ªç”±ä½“ï¼ˆFree Bodyï¼‰â€” ç®±å­çš„å»ºæ¨¡</h3>

<p>æˆ‘ä»¬çš„ç®±å­æœ‰ <code>freejoint</code>ï¼Œè¿™æ„å‘³ç€å®ƒä¸ä¸ä»»ä½•å…¶ä»–ç‰©ä½“å›ºè¿ï¼Œå…·æœ‰å®Œå…¨çš„ 6 ä¸ªè‡ªç”±åº¦ã€‚</p>

<div class="box def">
  <div class="box-title">ğŸ“ freejoint çš„çŠ¶æ€è¡¨ç¤º</div>
  <p>è‡ªç”±ä½“çš„çŠ¶æ€åœ¨ qpos å’Œ qvel ä¸­çš„åˆ†å¸ƒï¼š</p>
  <table>
    <tr><th>æ•°ç»„</th><th>ç»´åº¦</th><th>å†…å®¹</th><th>åœ¨ PushBox ä¸­çš„ç´¢å¼•</th></tr>
    <tr><td>qpos</td><td>7</td><td>[x, y, z, qw, qx, qy, qz]</td><td>qpos[2:9]</td></tr>
    <tr><td>qvel</td><td>6</td><td>[vx, vy, vz, wx, wy, wz]</td><td>qvel[2:8]</td></tr>
  </table>
  <p>æ³¨æ„å››å…ƒæ•°çš„çº¦æŸ $q_w^2 + q_x^2 + q_y^2 + q_z^2 = 1$ï¼Œæ‰€ä»¥ 7 ç»´ qpos å®é™…åªæœ‰ 6 ä¸ªè‡ªç”±åº¦ã€‚</p>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span># è®¾ç½®ç®±å­çš„ä½ç½®å’Œå§¿æ€
# ä½ç½®
data.qpos[2] = 0.4   # x
data.qpos[3] = 0.1   # y
data.qpos[4] = 0.05  # z (åŠé«˜ï¼Œåˆšå¥½åœ¨åœ°é¢ä¸Š)

# å››å…ƒæ•°ï¼ˆæ—‹è½¬ 45Â° ç»• z è½´ï¼‰
angle = np.radians(45)
data.qpos[5] = np.cos(angle / 2)       # qw
data.qpos[6] = 0                        # qx
data.qpos[7] = 0                        # qy
data.qpos[8] = np.sin(angle / 2)       # qz

# ç»™ç®±å­ä¸€ä¸ªåˆé€Ÿåº¦
data.qvel[2] = 0.5   # x æ–¹å‘ 0.5 m/s
data.qvel[3] = 0.0   # y æ–¹å‘

mujoco.mj_forward(model, data)</code></pre>


<h3 id="ch5-contact">5.4 æ¥è§¦ç‰©ç†è¯¦è§£</h3>

<p>æ¥è§¦å¤„ç†æ˜¯ MuJoCo æœ€æ ¸å¿ƒçš„ç‰¹æ€§ã€‚å½“ä¸¤ä¸ª geom é‡å ï¼ˆæˆ–æ¥è¿‘ margin è·ç¦»å†…ï¼‰æ—¶ï¼ŒMuJoCo ä¼šè®¡ç®—æ¥è§¦åŠ›ã€‚</p>

<div class="box def">
  <div class="box-title">ğŸ“ MuJoCo æ¥è§¦åŠ›æ¨¡å‹</div>
  <p>MuJoCo ä½¿ç”¨<strong>è½¯æ¥è§¦ï¼ˆsoft contactï¼‰</strong>æ¨¡å‹ï¼Œç»“åˆäº†å¼¹ç°§-é˜»å°¼å™¨å’Œçº¦æŸæ±‚è§£ï¼š</p>
  <p>$$f_n = k \cdot d + b \cdot \dot{d}$$</p>
  <p>å…¶ä¸­ $d$ æ˜¯ç©¿é€æ·±åº¦ï¼Œ$\dot{d}$ æ˜¯ç©¿é€é€Ÿåº¦ï¼Œ$k$ æ˜¯åˆšåº¦ï¼ˆç”± <code>solref</code> æ§åˆ¶ï¼‰ï¼Œ$b$ æ˜¯é˜»å°¼ï¼ˆç”± <code>solimp</code> æ§åˆ¶ï¼‰ã€‚</p>
  <p>å®é™…ä¸Šï¼ŒMuJoCo çš„æ¥è§¦æ¨¡å‹æ›´å¤æ‚â€”â€”å®ƒå°†æ¥è§¦åŠ›ä½œä¸ºä¸€ä¸ª<strong>çº¦æŸä¼˜åŒ–é—®é¢˜</strong>æ±‚è§£ï¼Œ<code>solref</code> å’Œ <code>solimp</code> æ§åˆ¶çº¦æŸçš„"è½¯ç¡¬ç¨‹åº¦"ã€‚</p>
</div>

<h4>æ‘©æ“¦åŠ›æ¨¡å‹</h4>

<p>MuJoCo å®ç°çš„æ˜¯<strong>æ¤­åœ†æ‘©æ“¦é”¥</strong>è¿‘ä¼¼ï¼š</p>

<p>$$\|\mathbf{f}_t\| \leq \mu \cdot f_n$$</p>

<p>å…¶ä¸­ $\mathbf{f}_t$ æ˜¯åˆ‡å‘ï¼ˆæ‘©æ“¦ï¼‰åŠ›ï¼Œ$f_n$ æ˜¯æ³•å‘åŠ›ï¼Œ$\mu$ æ˜¯æ»‘åŠ¨æ‘©æ“¦ç³»æ•°ã€‚</p>

<p>ä¸¤ä¸ªæ¥è§¦ geom çš„æœ‰æ•ˆæ‘©æ“¦ç³»æ•°è®¡ç®—æ–¹å¼ï¼š</p>
<pre><code class="language-python"><span class="code-label">PYTHON</span># MuJoCo å–ä¸¤ä¸ª geom æ‘©æ“¦ç³»æ•°çš„é€å…ƒç´ æœ€å¤§å€¼
# è€Œéå¹³å‡å€¼ï¼è¿™æ›´ç‰©ç†â€”â€”ç²—ç³™è¡¨é¢"èµ¢"
effective_friction = np.maximum(geom1_friction, geom2_friction)</code></pre>

<h4>solref å’Œ solimp â€” æ¥è§¦"è½¯ç¡¬åº¦"</h4>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;!-- solref: çº¦æŸå‚è€ƒå‚æ•° [timeconst, dampratio] --&gt;
&lt;!-- solref="0.02 1" è¡¨ç¤º: --&gt;
&lt;!--   timeconst=0.02s: æ¥è§¦æ¢å¤çš„æ—¶é—´å¸¸æ•°ï¼ˆè¶Šå°è¶Šç¡¬ï¼‰ --&gt;
&lt;!--   dampratio=1: ä¸´ç•Œé˜»å°¼æ¯”ï¼ˆ1=ä¸æŒ¯è¡ï¼Œ<1=æŒ¯è¡ï¼‰ --&gt;
&lt;geom solref="0.02 1"/&gt;

&lt;!-- solimp: çº¦æŸé˜»æŠ—å‚æ•° [dmin, dmax, width, midpoint, power] --&gt;
&lt;!-- æ§åˆ¶çº¦æŸä»"è½¯"åˆ°"ç¡¬"çš„è¿‡æ¸¡æ›²çº¿ --&gt;
&lt;geom solimp="0.9 0.95 0.001 0.5 2"/&gt;</code></pre>


<h3 id="ch5-inertia">5.5 è´¨é‡ä¸æƒ¯æ€§</h3>

<p>æ¯ä¸ªåˆšä½“çš„åŠ¨åŠ›å­¦è¡Œä¸ºç”±å…¶è´¨é‡å’Œæƒ¯æ€§å¼ é‡å†³å®šã€‚MuJoCo æä¾›äº†ä¸¤ç§æ–¹å¼æ¥è®¾ç½®ï¼š</p>

<h4>æ–¹å¼1: inertiafromgeomï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„æ–¹å¼ï¼‰</h4>
<p>å½“ <code>compiler inertiafromgeom="true"</code> æ—¶ï¼ŒMuJoCo è‡ªåŠ¨ä» geom çš„å½¢çŠ¶å’Œå¯†åº¦ï¼ˆæˆ–è´¨é‡ï¼‰è®¡ç®—æƒ¯æ€§å¼ é‡ã€‚</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span># æŸ¥çœ‹è®¡ç®—ç»“æœ
for i in range(model.nbody):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, i) or "world"
    mass = model.body_mass[i]
    inertia = model.body_inertia[i]  # ä¸»æƒ¯æ€§çŸ© (Ixx, Iyy, Izz)
    print(f"  {name}: mass={mass:.4f}kg, inertia={inertia}")

# å¯¹äº box_geom (0.1Ã—0.1Ã—0.1m, 0.5kg):
# I = m/12 * (aÂ² + bÂ²) å¯¹æ¯ä¸ªè½´
# Ixx = 0.5/12 * (0.1Â² + 0.1Â²) = 0.000833
# ä¸‰ä¸ªè½´ç›¸åŒï¼ˆæ­£æ–¹ä½“ï¼‰</code></pre>

<h4>æ–¹å¼2: æ‰‹åŠ¨æŒ‡å®š</h4>
<pre><code class="language-xml"><span class="code-label">XML</span>&lt;body name="custom_body"&gt;
  &lt;inertial pos="0 0 0" mass="2.0" 
            diaginertia="0.1 0.1 0.05"/&gt;
  &lt;!-- diaginertia: ä¸»æƒ¯æ€§çŸ© [Ixx, Iyy, Izz] --&gt;
  &lt;!-- fullinertia: å®Œæ•´æƒ¯æ€§å¼ é‡ [Ixx, Iyy, Izz, Ixy, Ixz, Iyz] --&gt;
&lt;/body&gt;</code></pre>

<div class="box ex">
  <div class="box-title">ğŸ” åŠ¨æ€ä¿®æ”¹è´¨é‡ï¼ˆç”¨äºåŸŸéšæœºåŒ–ï¼‰</div>
  <pre><code class="language-python"># åœ¨ PushBoxEnv ä¸­ï¼Œæˆ‘ä»¬æ”¯æŒä¿®æ”¹ç®±å­è´¨é‡
def _set_box_mass(self, mass):
    box_body_id = mujoco.mj_name2id(
        self.model, mujoco.mjtObj.mjOBJ_BODY, "box"
    )
    self.model.body_mass[box_body_id] = mass
    # æ³¨æ„ï¼šä¿®æ”¹ body_mass åï¼Œæƒ¯æ€§ä¸ä¼šè‡ªåŠ¨æ›´æ–°
    # å¦‚æœéœ€è¦ç²¾ç¡®çš„æƒ¯æ€§ï¼Œä¹Ÿè¦æ‰‹åŠ¨æ›´æ–° body_inertia</code></pre>
</div>


<!-- ================================================================== -->
<!-- ç¬¬å…­ç« ï¼šGymnasium ç¯å¢ƒå°è£…                                            -->
<!-- ================================================================== -->
<h2 id="ch6">ç¬¬å…­ç« ï¼šGymnasium ç¯å¢ƒå°è£…</h2>

<p>è¿™ä¸€ç« æˆ‘ä»¬æ·±å…¥åˆ†æ PushBox ç¯å¢ƒçš„å®ç°â€”â€”å¦‚ä½•å°† MuJoCo ä»¿çœŸå°è£…æˆ Gymnasium æ ‡å‡†æ¥å£ï¼Œä½¿å…¶å¯ä»¥ä¸ Stable-Baselines3 ç­‰ RL åº“æ— ç¼é›†æˆã€‚</p>

<h3 id="ch6-interface">6.1 gym.Env æ¥å£</h3>

<p>Gymnasiumï¼ˆå‰èº«æ˜¯ OpenAI Gymï¼‰å®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†çš„ç¯å¢ƒæ¥å£ã€‚æ‰€æœ‰ RL ç¯å¢ƒéƒ½éœ€è¦å®ç°è¿™å‡ ä¸ªæ–¹æ³•ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import gymnasium as gym
from gymnasium import spaces
import numpy as np

class PushBoxEnv(gym.Env):
    """æ ‡å‡†çš„ Gymnasium ç¯å¢ƒ"""
    
    # 1. metadata: å£°æ˜æ”¯æŒçš„æ¸²æŸ“æ¨¡å¼å’Œå¸§ç‡
    metadata = {"render_modes": ["human", "rgb_array"], "render_fps": 50}
    
    def __init__(self, render_mode=None, box_mass=0.5):
        """
        åˆå§‹åŒ–ç¯å¢ƒ:
        - åŠ è½½ MuJoCo æ¨¡å‹
        - å®šä¹‰è§‚å¯Ÿç©ºé—´å’ŒåŠ¨ä½œç©ºé—´
        - ç¼“å­˜å¸¸ç”¨ ID
        - è®¾ç½®è¶…å‚æ•°
        """
        super().__init__()
        
        # åŠ è½½ MuJoCo æ¨¡å‹
        xml_path = os.path.join(os.path.dirname(__file__), "assets", "push_box.xml")
        self.model = mujoco.MjModel.from_xml_path(xml_path)
        self.data = mujoco.MjData(self.model)
        
        # å¯é…ç½®çš„ç®±å­è´¨é‡ï¼ˆç”¨äº OOD æµ‹è¯•ï¼‰
        self.box_mass = box_mass
        self._set_box_mass(box_mass)
        
        # ç¼“å­˜ IDï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
        self._ee_site_id = mujoco.mj_name2id(
            self.model, mujoco.mjtObj.mjOBJ_SITE, "endeffector"
        )
        self._box_body_id = mujoco.mj_name2id(
            self.model, mujoco.mjtObj.mjOBJ_BODY, "box"
        )
        
        # å®šä¹‰ç©ºé—´
        self.action_space = spaces.Box(
            low=-10.0, high=10.0, shape=(2,), dtype=np.float32
        )
        self.observation_space = spaces.Box(
            low=-np.inf, high=np.inf, shape=(16,), dtype=np.float32
        )
        
        # è¶…å‚æ•°
        self.goal_pos = np.array([0.5, 0.3, 0.02])
        self.max_episode_steps = 500
        self.success_threshold = 0.1
        self.current_step = 0
        
    def reset(self, seed=None, options=None):
        """é‡ç½®ç¯å¢ƒåˆ°åˆå§‹çŠ¶æ€"""
        # Gymnasium v26 æ ‡å‡†: è°ƒç”¨ super().reset() è®¾ç½®éšæœºç§å­
        super().reset(seed=seed)
        
        # é‡ç½® MuJoCo ä»¿çœŸ
        mujoco.mj_resetData(self.model, self.data)
        
        # éšæœºåŒ–åˆå§‹çŠ¶æ€ï¼ˆå¢åŠ é²æ£’æ€§ï¼‰
        self.data.qpos[0] = np.random.uniform(-0.5, 0.5)  # shoulder
        self.data.qpos[1] = np.random.uniform(-0.5, 0.5)  # elbow
        self.data.qpos[2] = np.random.uniform(0.25, 0.45)  # box x
        self.data.qpos[3] = np.random.uniform(-0.15, 0.15)  # box y
        self.data.qpos[4] = 0.05  # box z (on ground)
        self.data.qpos[5:9] = [1, 0, 0, 0]  # æ— æ—‹è½¬
        self.data.qvel[:] = 0.0
        
        mujoco.mj_forward(self.model, self.data)
        self.current_step = 0
        
        return self._get_obs(), self._get_info()
    
    def step(self, action):
        """æ‰§è¡Œä¸€æ­¥"""
        self.data.ctrl[:] = action
        
        # 5 ä¸ªç‰©ç†å­æ­¥
        for _ in range(5):
            mujoco.mj_step(self.model, self.data)
        
        obs = self._get_obs()
        reward = self._compute_reward()
        self.current_step += 1
        
        info = self._get_info()
        terminated = info['success']
        truncated = self.current_step >= self.max_episode_steps
        
        return obs, reward, terminated, truncated, info</code></pre>

<div class="box def">
  <div class="box-title">ğŸ“ Gymnasium v26 æ¥å£å˜åŒ–</div>
  <p>å¦‚æœä½ ä¹‹å‰ç”¨è¿‡æ—§ç‰ˆ OpenAI Gymï¼Œæ³¨æ„ä»¥ä¸‹é‡è¦å˜åŒ–ï¼š</p>
  <table>
    <tr><th>æ—§ç‰ˆ (Gym v21)</th><th>æ–°ç‰ˆ (Gymnasium v26+)</th></tr>
    <tr><td><code>obs = env.reset()</code></td><td><code>obs, info = env.reset()</code></td></tr>
    <tr><td><code>obs, reward, done, info = env.step(action)</code></td><td><code>obs, reward, terminated, truncated, info = env.step(action)</code></td></tr>
    <tr><td>å•ä¸€ <code>done</code> ä¿¡å·</td><td><code>terminated</code>ï¼ˆè‡ªç„¶ç»“æŸï¼‰vs <code>truncated</code>ï¼ˆæ—¶é—´æˆªæ–­ï¼‰</td></tr>
    <tr><td><code>import gym</code></td><td><code>import gymnasium as gym</code></td></tr>
  </table>
  <p>åŒºåˆ† terminated å’Œ truncated å¯¹äºæ­£ç¡®è®¡ç®— value bootstrap è‡³å…³é‡è¦â€”â€”truncated æ—¶åº”è¯¥ç”¨ V(s') è€Œé 0ã€‚</p>
</div>


<h3 id="ch6-obs">6.2 è§‚å¯Ÿç©ºé—´è®¾è®¡</h3>

<p>è§‚å¯Ÿç©ºé—´å†³å®šäº† RL æ™ºèƒ½ä½“èƒ½"çœ‹åˆ°"ä»€ä¹ˆä¿¡æ¯ã€‚è®¾è®¡åŸåˆ™ï¼š<strong>åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯è®©ä»»åŠ¡å¯è§£ï¼Œä½†é¿å…å†—ä½™å’Œå™ªå£°</strong>ã€‚</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>def _get_obs(self):
    """æ„é€  16 ç»´è§‚å¯Ÿå‘é‡"""
    # å…³èŠ‚ä½ç½® (2ç»´) â€” æè¿°æ‰‹è‡‚çš„å½“å‰æ„å‹
    joint_pos = self.data.qpos[:2].copy()        # [shoulder, elbow] å¼§åº¦
    
    # å…³èŠ‚é€Ÿåº¦ (2ç»´) â€” æè¿°æ‰‹è‡‚çš„è¿åŠ¨çŠ¶æ€
    joint_vel = self.data.qvel[:2].copy()         # [shoulder_vel, elbow_vel] rad/s
    
    # æœ«ç«¯æ‰§è¡Œå™¨ä½ç½® (3ç»´) â€” æ‰‹è‡‚æœ«ç«¯åœ¨å“ªé‡Œ
    ee_pos = self.data.site_xpos[self._ee_site_id].copy()  # [x, y, z] ç±³
    
    # ç®±å­ä½ç½® (3ç»´) â€” ç®±å­åœ¨å“ªé‡Œ
    box_pos = self.data.qpos[2:5].copy()          # [x, y, z] ç±³
    
    # ç®±å­é€Ÿåº¦ (3ç»´) â€” ç®±å­åœ¨æ€ä¹ˆåŠ¨
    box_vel = self.data.qvel[2:5].copy()          # [vx, vy, vz] m/s
    
    # ç›®æ ‡ä½ç½® (3ç»´) â€” ç®±å­è¦å»å“ªé‡Œ
    goal_pos = self.goal_pos.copy()               # [x, y, z] ç±³
    
    # æ‹¼æ¥æˆ 16 ç»´å‘é‡
    obs = np.concatenate([
        joint_pos,    # 2: æ‰‹è‡‚åœ¨ä»€ä¹ˆå§¿æ€
        joint_vel,    # 2: æ‰‹è‡‚åœ¨æ€ä¹ˆåŠ¨
        ee_pos,       # 3: æ‰‹èƒ½ç¢°åˆ°ç®±å­å—
        box_pos,      # 3: ç®±å­åœ¨å“ª
        box_vel,      # 3: ç®±å­åœ¨æ€ä¹ˆåŠ¨
        goal_pos      # 3: ç›®æ ‡åœ¨å“ª
    ])
    return obs.astype(np.float32)</code></pre>

<div class="box ex">
  <div class="box-title">ğŸ” ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›è§‚å¯Ÿé‡ï¼Ÿ</div>
  <table>
    <tr><th>è§‚å¯Ÿ</th><th>å¿…è¦æ€§</th><th>åŸå› </th></tr>
    <tr><td>å…³èŠ‚ä½ç½®</td><td>â­â­â­â­â­</td><td>æè¿°æ‰‹è‡‚å½“å‰æ„å‹ï¼Œæ˜¯æ§åˆ¶çš„åŸºç¡€</td></tr>
    <tr><td>å…³èŠ‚é€Ÿåº¦</td><td>â­â­â­â­</td><td>é¢„æµ‹åŠ¨æ€è¡Œä¸ºï¼Œä½¿ MDP æ»¡è¶³é©¬å°”å¯å¤«æ€§</td></tr>
    <tr><td>æœ«ç«¯æ‰§è¡Œå™¨ä½ç½®</td><td>â­â­â­â­â­</td><td>çŸ¥é“æ‰‹åœ¨å“ªæ‰èƒ½å»ç¢°ç®±å­</td></tr>
    <tr><td>ç®±å­ä½ç½®</td><td>â­â­â­â­â­</td><td>çŸ¥é“ç®±å­åœ¨å“ªæ‰èƒ½æ¨å®ƒ</td></tr>
    <tr><td>ç®±å­é€Ÿåº¦</td><td>â­â­â­</td><td>çŸ¥é“ç®±å­è¿åŠ¨çŠ¶æ€ï¼Œæœ‰åŠ©äºç²¾ç¡®æ§åˆ¶</td></tr>
    <tr><td>ç›®æ ‡ä½ç½®</td><td>â­â­â­â­â­</td><td>çŸ¥é“ç›®æ ‡åœ¨å“ªæ‰èƒ½æŠŠç®±å­æ¨è¿‡å»</td></tr>
  </table>
  <p><strong>é©¬å°”å¯å¤«æ€§</strong>ï¼šè§‚å¯Ÿåº”è¯¥åŒ…å«è¶³å¤Ÿä¿¡æ¯ï¼Œä½¿å¾— $P(s_{t+1} | s_t, a_t)$ æˆç«‹ã€‚å¦‚æœåªæœ‰ä½ç½®æ²¡æœ‰é€Ÿåº¦ï¼Œç³»ç»Ÿå°±ä¸æ˜¯é©¬å°”å¯å¤«çš„â€”â€”ä½ éœ€è¦å†å²ä¿¡æ¯æ¥æ¨æ–­è¿åŠ¨æ–¹å‘ã€‚</p>
</div>


<h3 id="ch6-action">6.3 åŠ¨ä½œç©ºé—´è®¾è®¡</h3>

<pre><code class="language-python"><span class="code-label">PYTHON</span># è¿ç»­åŠ¨ä½œç©ºé—´ï¼š2 ç»´åŠ›çŸ©
self.action_space = spaces.Box(
    low=-10.0,         # æœ€å°åŠ›çŸ© -10 Nm
    high=10.0,         # æœ€å¤§åŠ›çŸ© 10 Nm
    shape=(2,),        # 2 ä¸ªæ‰§è¡Œå™¨
    dtype=np.float32
)

# action[0] â†’ shoulder_motor åŠ›çŸ©
# action[1] â†’ elbow_motor åŠ›çŸ©</code></pre>

<div class="box thm">
  <div class="box-title">âœ… åŠ¨ä½œç©ºé—´è®¾è®¡é€‰æ‹©</div>
  <table>
    <tr><th>ç±»å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨ç®—æ³•</th></tr>
    <tr><td><strong>è¿ç»­åŠ›çŸ©</strong>ï¼ˆæˆ‘ä»¬çš„é€‰æ‹©ï¼‰</td><td>æœ€çµæ´»ï¼Œå¯ç²¾ç¡®åŠ›æ§</td><td>å­¦ä¹ éš¾åº¦å¤§</td><td>PPO, SAC, TD3</td></tr>
    <tr><td>è¿ç»­ä½ç½®</td><td>æ›´ç¨³å®šï¼Œå®¹æ˜“å­¦</td><td>éœ€è¦åº•å±‚ PD æ§åˆ¶å™¨</td><td>PPO, SAC</td></tr>
    <tr><td>è¿ç»­é€Ÿåº¦</td><td>å¹³æ»‘æ§åˆ¶</td><td>éœ€è¦åº•å±‚é€Ÿåº¦æ§åˆ¶å™¨</td><td>PPO, SAC</td></tr>
    <tr><td>ç¦»æ•£ï¼ˆä¸Šä¸‹å·¦å³ï¼‰</td><td>æœ€ç®€å•</td><td>ç²¾åº¦å·®</td><td>DQN</td></tr>
  </table>
  <p>å¯¹äºç ”ç©¶ç›®çš„ï¼ŒåŠ›çŸ©æ§åˆ¶æ˜¯æœ€"honest"çš„â€”â€”æ™ºèƒ½ä½“å¿…é¡»ä»åº•å±‚ç†è§£ç‰©ç†ã€‚å¯¹äºåº”ç”¨ï¼Œä½ç½®æ§åˆ¶é€šå¸¸æ›´å®ç”¨ã€‚</p>
</div>


<h3 id="ch6-reward">6.4 å¥–åŠ±å‡½æ•°è®¾è®¡</h3>

<p>å¥–åŠ±å‡½æ•°æ˜¯ RL ç¯å¢ƒä¸­æœ€é‡è¦ä¹Ÿæœ€éš¾è®¾è®¡çš„éƒ¨åˆ†ã€‚å®ƒå®šä¹‰äº†"ä»€ä¹ˆæ˜¯å¥½çš„è¡Œä¸º"ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>def step(self, action):
    # ... æ‰§è¡Œä»¿çœŸ ...
    
    ee_pos = self.data.site_xpos[self._ee_site_id].copy()
    box_pos = self.data.qpos[2:5].copy()
    
    # ===== å¥–åŠ±æˆåˆ† =====
    
    # r1: é¼“åŠ±æœ«ç«¯æ‰§è¡Œå™¨é è¿‘ç®±å­
    dist_ee_box = np.linalg.norm(ee_pos[:2] - box_pos[:2])
    r1 = -dist_ee_box  # è¶Šè¿‘å¥–åŠ±è¶Šé«˜ï¼ˆè´Ÿè·ç¦»â†’è·ç¦»è¶Šå°å€¼è¶Šå¤§ï¼‰
    
    # r2: é¼“åŠ±ç®±å­é è¿‘ç›®æ ‡
    dist_box_goal = np.linalg.norm(box_pos[:2] - self.goal_pos[:2])
    r2 = -dist_box_goal
    
    # ç»„åˆå¥–åŠ±
    reward = 0.5 * r1 + r2   # r2 æƒé‡æ›´é«˜ï¼šæ¨ç®±å­æ¯”åˆ°è¾¾ç®±å­æ›´é‡è¦
    
    # ç¨€ç–æˆåŠŸå¥–åŠ±
    success = dist_box_goal < self.success_threshold
    if success:
        reward += 100.0  # å¤§é¢å¥–é‡‘
    
    # ===== å¥–åŠ±åˆ†æ =====
    # å…¸å‹å€¼èŒƒå›´:
    # - å¼€å§‹æ—¶: r1 â‰ˆ -0.3, r2 â‰ˆ -0.4 â†’ reward â‰ˆ -0.55
    # - é è¿‘ç®±å­: r1 â‰ˆ -0.05, r2 â‰ˆ -0.3 â†’ reward â‰ˆ -0.325
    # - æ¨åˆ°ç›®æ ‡: r1 â‰ˆ -0.05, r2 â‰ˆ -0.05 â†’ reward â‰ˆ -0.075 + 100
    
    return obs, reward, terminated, truncated, info</code></pre>

<div class="box def">
  <div class="box-title">ğŸ“ Dense vs Sparse å¥–åŠ±</div>
  <p><strong>Denseï¼ˆç¨ å¯†ï¼‰å¥–åŠ±</strong>ï¼šæ¯ä¸€æ­¥éƒ½ç»™å‡ºä¿¡å·ã€‚æˆ‘ä»¬çš„ <code>-dist</code> å°±æ˜¯ç¨ å¯†å¥–åŠ±â€”â€”æ¯ä¸€æ­¥éƒ½å‘Šè¯‰æ™ºèƒ½ä½“"ä½ ç¦»ç›®æ ‡è¿˜æœ‰å¤šè¿œ"ã€‚</p>
  <p><strong>Sparseï¼ˆç¨€ç–ï¼‰å¥–åŠ±</strong>ï¼šåªåœ¨ä»»åŠ¡å®Œæˆæ—¶ç»™å¥–åŠ±ã€‚å¦‚æœåªç”¨ <code>+100 if success</code>ï¼Œæ™ºèƒ½ä½“éœ€è¦å¾ˆä¹…æ‰èƒ½"ç¢°å·§"æˆåŠŸå¹¶è·å¾—ç¬¬ä¸€ä¸ªæ­£åé¦ˆã€‚</p>
  <p><strong>æˆ‘ä»¬çš„ç­–ç•¥</strong>ï¼šç¨ å¯† + ç¨€ç–çš„ç»“åˆã€‚ç¨ å¯†éƒ¨åˆ†å¼•å¯¼å­¦ä¹ æ–¹å‘ï¼Œç¨€ç–éƒ¨åˆ†å¼ºåŒ–æœ€ç»ˆç›®æ ‡ã€‚</p>
</div>

<div class="box warn">
  <div class="box-title">âš ï¸ å¥–åŠ±è®¾è®¡çš„å¸¸è§é™·é˜±</div>
  <ol>
    <li><strong>å¥–åŠ±é»‘å®¢ï¼ˆReward Hackingï¼‰</strong>ï¼šæ™ºèƒ½ä½“æ‰¾åˆ°æ»¡è¶³å¥–åŠ±ä½†ä¸ç¬¦åˆåˆè¡·çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå¥–åŠ±"æ‰‹é è¿‘ç®±å­"ï¼Œæ™ºèƒ½ä½“å¯èƒ½å­¦ä¼šä¸æ¨ç®±å­è€Œæ˜¯ä¸€ç›´é è¿‘ç®±å­ã€‚</li>
    <li><strong>å°ºåº¦ä¸ä¸€è‡´</strong>ï¼šå¦‚æœ r1 çš„é‡çº§è¿œå¤§äº r2ï¼Œr2 ä¼šè¢«å¿½ç•¥ã€‚ç¡®ä¿å„å¥–åŠ±æˆåˆ†çš„é‡çº§ç›¸å½“ã€‚</li>
    <li><strong>è¿‡åº¦ shaping</strong>ï¼šå¤ªè¯¦ç»†çš„å¥–åŠ±å¯èƒ½å¯¼è‡´å±€éƒ¨æœ€ä¼˜ã€‚ä¾‹å¦‚ï¼Œ"å…ˆåˆ°è¾¾ç®±å­ã€å†æ¨ç®±å­"çš„åˆ†é˜¶æ®µå¥–åŠ±å¯èƒ½å¯¼è‡´æ™ºèƒ½ä½“åœåœ¨ç¬¬ä¸€é˜¶æ®µã€‚</li>
    <li><strong>èƒ½é‡æƒ©ç½š</strong>ï¼šå¯ä»¥æ·»åŠ  <code>-0.01 * np.sum(action**2)</code> æ¥é¼“åŠ±èƒ½é‡æ•ˆç‡çš„åŠ¨ä½œï¼Œä½†æƒé‡è¦å°å¿ƒã€‚</li>
  </ol>
</div>


<h3 id="ch6-term">6.5 ç»ˆæ­¢æ¡ä»¶</h3>

<pre><code class="language-python"><span class="code-label">PYTHON</span>def step(self, action):
    # ...
    
    # terminated: ä»»åŠ¡è‡ªç„¶å®Œæˆï¼ˆæˆåŠŸï¼‰
    terminated = success  # dist_box_goal < 0.1m
    
    # truncated: æ—¶é—´æˆªæ–­ï¼ˆè¶…è¿‡æœ€å¤§æ­¥æ•°ï¼‰
    truncated = self.current_step >= self.max_episode_steps  # 500 æ­¥
    
    # è¿™ä¸¤ä¸ªçš„åŒºåˆ«å¯¹ RL ç®—æ³•å¾ˆé‡è¦:
    # - terminated: V(s_terminal) = 0ï¼ˆçœŸæ­£ç»“æŸäº†ï¼‰
    # - truncated: V(s_terminal) â‰  0ï¼ˆäººä¸ºæˆªæ–­ï¼ŒçŠ¶æ€æœ¬èº«æ²¡é—®é¢˜ï¼‰
    #   â†’ ç®—æ³•åº”è¯¥ç”¨ V(s') bootstrapï¼Œè€Œä¸æ˜¯æŠŠ value å½“æˆ 0</code></pre>


<h3 id="ch6-vec">6.6 å¹¶è¡Œç¯å¢ƒ â€” DummyVecEnv</h3>

<p>RL è®­ç»ƒé€šå¸¸éœ€è¦å¤§é‡æ•°æ®ã€‚å¹¶è¡ŒåŒ–å¤šä¸ªç¯å¢ƒå¯ä»¥æ˜¾è‘—åŠ é€Ÿæ•°æ®æ”¶é›†ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>from stable_baselines3.common.vec_env import DummyVecEnv, SubprocVecEnv

# ===== æ–¹å¼1: DummyVecEnv (å•è¿›ç¨‹ä¸²è¡Œ) =====
# é€‚åˆç¯å¢ƒè®¡ç®—é‡å°çš„åœºæ™¯ï¼ˆå¦‚æˆ‘ä»¬çš„ PushBoxï¼‰
envs = DummyVecEnv([
    lambda: PushBoxEnv(box_mass=0.5) for _ in range(8)
])
# 8 ä¸ªç¯å¢ƒï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­é¡ºåºæ‰§è¡Œ
# ç®€å•ä½†æœ‰ GIL é™åˆ¶

# ===== æ–¹å¼2: SubprocVecEnv (å¤šè¿›ç¨‹å¹¶è¡Œ) =====
# é€‚åˆç¯å¢ƒè®¡ç®—é‡å¤§çš„åœºæ™¯ï¼ˆçœŸæ­£å¹¶è¡Œï¼‰
envs = SubprocVecEnv([
    make_push_box_env(box_mass=0.5) for _ in range(8)
])
# 8 ä¸ªç¯å¢ƒï¼Œæ¯ä¸ªåœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­
# éœ€è¦ fork å®‰å…¨çš„ç¯å¢ƒåˆ›å»ºå‡½æ•°

# ===== ä½¿ç”¨å·¥å‚å‡½æ•° =====
def make_push_box_env(box_mass=0.5):
    """å·¥å‚å‡½æ•°ï¼ˆSubprocVecEnv éœ€è¦ pickle-able çš„å‡½æ•°ï¼‰"""
    def _init():
        return PushBoxEnv(box_mass=box_mass)
    return _init

# åˆ›å»ºå¹¶è¡Œè®­ç»ƒç¯å¢ƒ
from stable_baselines3 import PPO

model = PPO("MlpPolicy", envs, verbose=1)
model.learn(total_timesteps=100_000)</code></pre>


<h3 id="ch6-debug">6.7 ç¯å¢ƒè°ƒè¯•</h3>

<p>åœ¨è®­ç»ƒä¹‹å‰ï¼Œ<strong>ä¸€å®šè¦</strong>å…ˆéªŒè¯ç¯å¢ƒçš„ç‰©ç†è¡Œä¸ºæ˜¯å¦æ­£ç¡®ã€‚ä»¥ä¸‹æ˜¯è°ƒè¯•æ¸…å•ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>from stable_baselines3.common.env_checker import check_env

# ===== 1. åŸºæœ¬æ£€æŸ¥ =====
env = PushBoxEnv()
check_env(env, warn=True)  # Gymnasium å…¼å®¹æ€§æ£€æŸ¥
# æ£€æŸ¥å†…å®¹: ç©ºé—´å®šä¹‰ã€reset/step è¿”å›æ ¼å¼ã€dtype ç­‰

# ===== 2. éšæœºåŠ¨ä½œæµ‹è¯• =====
obs, info = env.reset()
for i in range(100):
    action = env.action_space.sample()  # éšæœºåŠ¨ä½œ
    obs, reward, terminated, truncated, info = env.step(action)
    
    # æ£€æŸ¥è§‚å¯Ÿæ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
    assert not np.any(np.isnan(obs)), f"Step {i}: NaN in obs!"
    assert not np.any(np.isinf(obs)), f"Step {i}: Inf in obs!"
    
    # æ£€æŸ¥å¥–åŠ±æ˜¯å¦åˆç†
    assert np.isfinite(reward), f"Step {i}: Invalid reward!"
    assert -20 < reward < 200, f"Step {i}: Suspicious reward: {reward}"
    
    if terminated or truncated:
        obs, info = env.reset()

print("âœ… åŸºæœ¬æ£€æŸ¥é€šè¿‡ï¼")

# ===== 3. å¯è§†åŒ–ç‰©ç†è¡Œä¸º =====
env = PushBoxEnv(render_mode="human")
obs, info = env.reset()

# æ‰‹åŠ¨ç»™ä¸€ä¸ªæ’å®šåŠ›çŸ©ï¼Œè§‚å¯Ÿæ‰‹è‡‚æ˜¯å¦åˆç†è¿åŠ¨
for _ in range(500):
    action = np.array([2.0, -1.0])  # å›ºå®šåŠ›çŸ©
    obs, reward, terminated, truncated, info = env.step(action)
    env.render()

env.close()

# ===== 4. æ‰“å°ä¸€ä¸ª episode çš„ç»Ÿè®¡ =====
env = PushBoxEnv()
obs, info = env.reset()
total_reward = 0
for step in range(500):
    action = env.action_space.sample()
    obs, reward, terminated, truncated, info = env.step(action)
    total_reward += reward
    if terminated or truncated:
        break

print(f"Episode: {step+1} steps, total_reward={total_reward:.2f}")
print(f"Final distance to goal: {info['distance_to_goal']:.3f}")
print(f"Success: {info['success']}")</code></pre>


<!-- ================================================================== -->
<!-- ç¬¬ä¸ƒç« ï¼šé«˜çº§ä¸»é¢˜                                                      -->
<!-- ================================================================== -->
<h2 id="ch7">ç¬¬ä¸ƒç« ï¼šé«˜çº§ä¸»é¢˜</h2>

<h3 id="ch7-flex">7.1 è½¯ä½“ä»¿çœŸï¼ˆFlexï¼‰</h3>

<p>MuJoCo 3.0+ å¼•å…¥äº† <strong>Flex</strong> åŠŸèƒ½ï¼Œæ”¯æŒæœ‰é™å…ƒæ–¹æ³•ï¼ˆFEMï¼‰çš„è½¯ä½“ä»¿çœŸï¼š</p>

<div class="box def">
  <div class="box-title">ğŸ“ ä»€ä¹ˆæ˜¯è½¯ä½“ä»¿çœŸ</div>
  <p>ä¼ ç»Ÿåˆšä½“ä»¿çœŸå‡è®¾ç‰©ä½“ä¸ä¼šå˜å½¢ã€‚ä½†åœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼ˆå¦‚åŒ»ç–—æœºå™¨äººæ“ä½œç»„ç»‡ã€æŸ”æ€§æŠ“å–ï¼‰ï¼Œç‰©ä½“çš„å½¢å˜æ˜¯æ ¸å¿ƒç‰©ç†ç°è±¡ã€‚</p>
  <p>MuJoCo Flex ä½¿ç”¨<strong>æœ‰é™å…ƒæ–¹æ³• (FEM)</strong>å°†è¿ç»­ä½“ç¦»æ•£åŒ–ä¸ºç½‘æ ¼å…ƒç´ ï¼Œåœ¨æ¯ä¸ªå…ƒç´ ä¸Šæ±‚è§£å¼¹æ€§åŠ›å­¦æ–¹ç¨‹ã€‚</p>
</div>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;!-- è½¯ä½“ä»¿çœŸç¤ºä¾‹ --&gt;
&lt;mujoco&gt;
  &lt;extension&gt;
    &lt;plugin plugin="mujoco.elasticity.solid"/&gt;
  &lt;/extension&gt;
  
  &lt;worldbody&gt;
    &lt;!-- è½¯ä½“ç«‹æ–¹ä½“ --&gt;
    &lt;body&gt;
      &lt;freejoint/&gt;
      &lt;composite type="grid" count="5 5 5" spacing="0.02"&gt;
        &lt;!-- å¼¹æ€§å‚æ•° --&gt;
        &lt;plugin plugin="mujoco.elasticity.solid"&gt;
          &lt;config key="young" value="1e4"/&gt;    &lt;!-- æ¨æ°æ¨¡é‡ --&gt;
          &lt;config key="poisson" value="0.3"/&gt;   &lt;!-- æ³Šæ¾æ¯” --&gt;
          &lt;config key="damping" value="0.01"/&gt;  &lt;!-- é˜»å°¼ --&gt;
        &lt;/plugin&gt;
      &lt;/composite&gt;
    &lt;/body&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;</code></pre>

<p>Flex å¯¹æˆ‘ä»¬é¡¹ç›®çš„æ„ä¹‰ï¼šåŒ»ç–—æœºå™¨äººéœ€è¦æ“ä½œ<strong>è½¯ç»„ç»‡</strong>ï¼ˆå¦‚çš®è‚¤ã€å™¨å®˜ï¼‰ï¼ŒFlex ä½¿å¾—åœ¨ MuJoCo ä¸­æ¨¡æ‹Ÿè¿™äº›æˆä¸ºå¯èƒ½ã€‚</p>


<h3 id="ch7-tendon">7.2 è‚Œè…±ï¼ˆTendonï¼‰</h3>

<p>è‚Œè…±å¯ä»¥å°†å¤šä¸ªå…³èŠ‚è€¦åˆåœ¨ä¸€èµ·ï¼Œæ¨¡æ‹Ÿè‚Œè‚‰-éª¨éª¼ç³»ç»Ÿæˆ–çº¿ç¼†ä¼ åŠ¨ï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML</span>&lt;tendon&gt;
  &lt;!-- å›ºå®šè‚Œè…±: ä¸¤ä¸ªå…³èŠ‚ä¹‹é—´çš„çº¿æ€§è€¦åˆ --&gt;
  &lt;fixed name="coupling"&gt;
    &lt;joint joint="shoulder" coef="1.0"/&gt;
    &lt;joint joint="elbow" coef="-0.5"/&gt;
  &lt;/fixed&gt;
  &lt;!-- å«ä¹‰: å½“ shoulder è½¬1åº¦, elbow åå‘è½¬ 0.5 åº¦ --&gt;
  
  &lt;!-- ç©ºé—´è‚Œè…±: ç»è¿‡æŒ‡å®šçš„è·¯å¾„ç‚¹ --&gt;
  &lt;spatial name="cable" limited="true" range="0 0.5"&gt;
    &lt;site site="attachment1"/&gt;
    &lt;geom geom="upper_arm_geom"/&gt;  &lt;!-- ç»•è¿‡å‡ ä½•ä½“ --&gt;
    &lt;site site="attachment2"/&gt;
  &lt;/spatial&gt;
&lt;/tendon&gt;</code></pre>


<h3 id="ch7-sensor">7.3 ä¼ æ„Ÿå™¨ç³»ç»Ÿè¯¦è§£</h3>

<p>MuJoCo çš„ä¼ æ„Ÿå™¨ç§ç±»ä¸°å¯Œï¼Œè¦†ç›–äº†çœŸå®æœºå™¨äººå¸¸ç”¨çš„å„ç§ä¼ æ„Ÿæ¨¡æ€ï¼š</p>

<table>
<tr><th>ä¼ æ„Ÿå™¨ç±»å‹</th><th>XML æ ‡ç­¾</th><th>æŒ‚è½½ç›®æ ‡</th><th>æ•°æ®ç»´åº¦</th><th>è¯´æ˜</th></tr>
<tr><td>å…³èŠ‚ä½ç½®</td><td><code>jointpos</code></td><td>joint</td><td>1</td><td>ç¼–ç å™¨</td></tr>
<tr><td>å…³èŠ‚é€Ÿåº¦</td><td><code>jointvel</code></td><td>joint</td><td>1</td><td>é€Ÿåº¦è®¡</td></tr>
<tr><td>åŠ›çŸ©ä¼ æ„Ÿå™¨</td><td><code>actuatorfrc</code></td><td>actuator</td><td>1</td><td>ç”µæµä¼ æ„Ÿå™¨</td></tr>
<tr><td>åŠ é€Ÿåº¦è®¡</td><td><code>accelerometer</code></td><td>site</td><td>3</td><td>IMU çš„ä¸€éƒ¨åˆ†</td></tr>
<tr><td>é™€èºä»ª</td><td><code>gyro</code></td><td>site</td><td>3</td><td>IMU çš„ä¸€éƒ¨åˆ†</td></tr>
<tr><td>åŠ›ä¼ æ„Ÿå™¨</td><td><code>force</code></td><td>site</td><td>3</td><td>åŠ›/åŠ›çŸ©ä¼ æ„Ÿå™¨</td></tr>
<tr><td>è§¦è§‰ä¼ æ„Ÿå™¨</td><td><code>touch</code></td><td>site</td><td>1</td><td>æ¥è§¦åŠ›å¤§å°</td></tr>
<tr><td>ä½ç½®ä¼ æ„Ÿå™¨</td><td><code>framepos</code></td><td>body/site</td><td>3</td><td>ç±»ä¼¼ GPS/è§†è§‰å®šä½</td></tr>
<tr><td>å››å…ƒæ•°ä¼ æ„Ÿå™¨</td><td><code>framequat</code></td><td>body/site</td><td>4</td><td>å§¿æ€æµ‹é‡</td></tr>
</table>


<h3 id="ch7-dr">7.4 åŸŸéšæœºåŒ–ï¼ˆDomain Randomizationï¼‰</h3>

<p>åŸŸéšæœºåŒ–æ˜¯ç¼©å° sim-to-real gap çš„æ ¸å¿ƒæŠ€æœ¯ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éšæœºåŒ–ç‰©ç†å‚æ•°ï¼Œä½¿ç­–ç•¥å­¦ä¼šåº”å¯¹ä¸ç¡®å®šæ€§ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>class DomainRandomizedPushBoxEnv(PushBoxEnv):
    """å¸¦åŸŸéšæœºåŒ–çš„ PushBox ç¯å¢ƒ"""
    
    def reset(self, seed=None, options=None):
        # å…ˆè°ƒç”¨çˆ¶ç±» reset
        obs, info = super().reset(seed=seed)
        
        # ===== åŸŸéšæœºåŒ– =====
        
        # 1. ç®±å­è´¨é‡éšæœºåŒ–ï¼ˆ0.2 ~ 1.0 kgï¼‰
        mass = np.random.uniform(0.2, 1.0)
        self._set_box_mass(mass)
        
        # 2. æ‘©æ“¦åŠ›éšæœºåŒ–
        box_geom_id = mujoco.mj_name2id(
            self.model, mujoco.mjtObj.mjOBJ_GEOM, "box_geom"
        )
        # model.geom_friction æ˜¯ (ngeom, 3) æ•°ç»„
        self.model.geom_friction[box_geom_id, 0] = np.random.uniform(0.3, 0.8)
        
        # 3. å…³èŠ‚é˜»å°¼éšæœºåŒ–
        for jnt_name in ["shoulder", "elbow"]:
            jnt_id = mujoco.mj_name2id(
                self.model, mujoco.mjtObj.mjOBJ_JOINT, jnt_name
            )
            self.model.jnt_damping[jnt_id] = np.random.uniform(0.3, 0.8)
        
        # 4. ç›®æ ‡ä½ç½®å°å¹…éšæœºåŒ–
        self.goal_pos = np.array([
            0.5 + np.random.uniform(-0.05, 0.05),
            0.3 + np.random.uniform(-0.05, 0.05),
            0.02
        ])
        
        # é‡æ–°è®¡ç®—
        mujoco.mj_forward(self.model, self.data)
        
        return self._get_obs(), self._get_info()</code></pre>

<div class="box thm">
  <div class="box-title">âœ… åŸŸéšæœºåŒ–å‚æ•°é€‰æ‹©å»ºè®®</div>
  <ul>
    <li><strong>è´¨é‡</strong>ï¼šÂ±50% èŒƒå›´é€šå¸¸è¶³å¤Ÿ</li>
    <li><strong>æ‘©æ“¦åŠ›</strong>ï¼š0.3 ~ 0.8 è¦†ç›–å¤§å¤šæ•°å·¥ä¸šåœºæ™¯</li>
    <li><strong>å…³èŠ‚é˜»å°¼</strong>ï¼šÂ±30% èŒƒå›´</li>
    <li><strong>è§‚æµ‹å™ªå£°</strong>ï¼šé«˜æ–¯å™ªå£° $\sigma = 0.01 \sim 0.05$ï¼ˆåœ¨è§‚æµ‹ä¸ŠåŠ å™ªå£°ï¼‰</li>
    <li><strong>æ‰§è¡Œå™¨å»¶è¿Ÿ</strong>ï¼šéšæœºå»¶è¿Ÿ 1-3 æ­¥</li>
    <li><strong>åŸåˆ™</strong>ï¼šéšæœºåŒ–èŒƒå›´åº”è¯¥è¦†ç›–ä½ å¯¹çœŸå®ç³»ç»Ÿä¸ç¡®å®šæ€§çš„ä¼°è®¡</li>
  </ul>
</div>


<h3 id="ch7-parallel">7.5 å¹¶è¡Œä»¿çœŸ</h3>

<p>MuJoCo æ”¯æŒå¤šä¸ª <code>MjData</code> å…±äº«åŒä¸€ä¸ª <code>MjModel</code>ï¼Œå®ç°é«˜æ•ˆçš„å¹¶è¡Œä»¿çœŸï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco
import numpy as np
from concurrent.futures import ThreadPoolExecutor

# ä¸€ä¸ª model å¯ä»¥è¢«å¤šä¸ª data å…±äº«ï¼ˆåªè¦ä¸ä¿®æ”¹ modelï¼‰
model = mujoco.MjModel.from_xml_path("push_box.xml")

# åˆ›å»ºå¤šä¸ª dataï¼ˆæ¯ä¸ªä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ä»¿çœŸå®ä¾‹ï¼‰
n_envs = 16
datas = [mujoco.MjData(model) for _ in range(n_envs)]

def simulate_one(data, actions):
    """åœ¨ä¸€ä¸ª data ä¸Šè¿è¡Œä¸€æ­¥ä»¿çœŸ"""
    data.ctrl[:] = actions
    for _ in range(5):
        mujoco.mj_step(model, data)
    return data.qpos.copy()

# æ–¹å¼1: é¡ºåºæ‰§è¡Œï¼ˆç®€å•ä½†æ…¢ï¼‰
for data in datas:
    simulate_one(data, np.random.uniform(-10, 10, 2))

# æ–¹å¼2: çº¿ç¨‹å¹¶è¡Œï¼ˆMuJoCo é‡Šæ”¾ GILï¼ï¼‰
with ThreadPoolExecutor(max_workers=4) as executor:
    futures = [
        executor.submit(simulate_one, data, np.random.uniform(-10, 10, 2))
        for data in datas
    ]
    results = [f.result() for f in futures]

# æ–¹å¼3: MJX â€” GPU å¹¶è¡Œï¼ˆæœ€å¿«ï¼‰
# éœ€è¦ JAX å’Œ mujoco-mjx
import jax
from mujoco import mjx

mjx_model = mjx.put_model(model)
mjx_data = mjx.put_data(model, data)

# æ‰¹é‡ä»¿çœŸï¼ˆæ‰€æœ‰ç¯å¢ƒåœ¨ GPU ä¸Šå¹¶è¡Œï¼‰
batch_data = jax.vmap(lambda d: mjx.step(mjx_model, d))(
    jax.tree_map(lambda x: jnp.stack([x]*n_envs), mjx_data)
)</code></pre>


<h3 id="ch7-sim2real">7.6 Sim-to-Real è¿ç§»</h3>

<p>Sim-to-Real æ˜¯æ•´ä¸ªä»¿çœŸç ”ç©¶çš„ç»ˆæç›®æ ‡â€”â€”è®©ä»¿çœŸä¸­è®­ç»ƒçš„ç­–ç•¥åœ¨çœŸå®æœºå™¨äººä¸Šå·¥ä½œã€‚å…³é”®æŠ€æœ¯åŒ…æ‹¬ï¼š</p>

<h4>1. ç³»ç»Ÿè¾¨è¯†ï¼ˆSystem Identificationï¼‰</h4>
<p>ç²¾ç¡®æµ‹é‡çœŸå®ç³»ç»Ÿçš„ç‰©ç†å‚æ•°ï¼ˆè´¨é‡ã€æ‘©æ“¦åŠ›ã€ç”µæœºç‰¹æ€§ï¼‰ï¼Œåœ¨ä»¿çœŸä¸­ç²¾ç¡®å¤ç°ã€‚</p>

<h4>2. åŸŸéšæœºåŒ–ï¼ˆDomain Randomizationï¼‰</h4>
<p>åœ¨è¶³å¤Ÿå®½çš„å‚æ•°èŒƒå›´å†…éšæœºåŒ–ï¼ˆå¦‚ä¸ŠèŠ‚æ‰€è¿°ï¼‰ï¼Œä½¿ç­–ç•¥å¯¹å‚æ•°ä¸ç¡®å®šæ€§é²æ£’ã€‚</p>

<h4>3. åŸŸé€‚åº”ï¼ˆDomain Adaptationï¼‰</h4>
<p>é€šè¿‡è§‚å¯ŸçœŸå®æ•°æ®ï¼Œè°ƒæ•´ä»¿çœŸå‚æ•°æˆ–å­¦ä¹ ä¸€ä¸ª"ä»¿çœŸâ†’ç°å®"çš„æ˜ å°„ã€‚</p>

<h4>4. Teacher-Student</h4>
<p>åœ¨ä»¿çœŸä¸­ç”¨å®Œç¾ä¿¡æ¯è®­ç»ƒ teacher ç­–ç•¥ï¼Œç„¶åç”¨ student ç­–ç•¥ï¼ˆåªç”¨ç°å®å¯è·å–çš„ä¼ æ„Ÿå™¨ä¿¡æ¯ï¼‰æ¨¡ä»¿ teacherã€‚</p>

<div class="box ex">
  <div class="box-title">ğŸ” Sim-to-Real æˆåŠŸæ¡ˆä¾‹</div>
  <ul>
    <li><strong>OpenAI Rubik's Cube</strong>ï¼ˆ2019ï¼‰ï¼šåœ¨ MuJoCo ä¸­ç”¨å¤§è§„æ¨¡åŸŸéšæœºåŒ–è®­ç»ƒçµå·§æ‰‹è§£é­”æ–¹ï¼ŒæˆåŠŸè¿ç§»åˆ°çœŸå® Shadow Hand</li>
    <li><strong>ANYmal å››è¶³æœºå™¨äºº</strong>ï¼šETH Zurich åœ¨ MuJoCo ä¸­è®­ç»ƒæ­¥æ€ç­–ç•¥ï¼Œç›´æ¥éƒ¨ç½²åˆ°çœŸå®å››è¶³æœºå™¨äºº</li>
    <li><strong>DeepMind Robotics</strong>ï¼šä½¿ç”¨ MuJoCo è®­ç»ƒçš„ç­–ç•¥åœ¨çœŸå®æœºå™¨äººæ‰‹è‡‚ä¸Šå®Œæˆå †å ä»»åŠ¡</li>
  </ul>
</div>


<h3 id="ch7-medical">7.7 åŒ»ç–—æœºå™¨äººä»¿çœŸ â€” æˆ‘ä»¬é¡¹ç›®çš„æ–¹å‘</h3>

<p>åŒ»ç–—æœºå™¨äººä»¿çœŸæ˜¯ MuJoCo çš„ä¸€ä¸ªå‰æ²¿åº”ç”¨æ–¹å‘ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬é¡¹ç›®çš„æœ€ç»ˆç›®æ ‡ï¼š</p>

<h4>æŒ‘æˆ˜</h4>
<ul>
  <li><strong>è½¯ç»„ç»‡å»ºæ¨¡</strong>ï¼šå™¨å®˜ã€è‚Œè‚‰ç­‰è½¯ç»„ç»‡çš„åŠ›å­¦è¡Œä¸ºæä¸ºå¤æ‚ï¼ˆéçº¿æ€§ã€å„å‘å¼‚æ€§ã€ç²˜å¼¹æ€§ï¼‰</li>
  <li><strong>é«˜ç²¾åº¦åŠ›æ§</strong>ï¼šæ‰‹æœ¯æ“ä½œéœ€è¦æ¯«ç±³çº§ç²¾åº¦å’Œæ¯«ç‰›çº§åŠ›æ§</li>
  <li><strong>å®‰å…¨çº¦æŸ</strong>ï¼šç»å¯¹ä¸èƒ½æŸä¼¤ç»„ç»‡ï¼Œéœ€è¦ä¸¥æ ¼çš„åŠ›/ä½ç§»é™åˆ¶</li>
  <li><strong>å¤šæ¨¡æ€æ„ŸçŸ¥</strong>ï¼šè§†è§‰ + åŠ›è§‰ + è§¦è§‰çš„èåˆ</li>
</ul>

<h4>MuJoCo çš„ä¼˜åŠ¿</h4>
<ul>
  <li>Flex åŠŸèƒ½æ”¯æŒè½¯ä½“ä»¿çœŸ</li>
  <li>ç²¾ç¡®çš„æ¥è§¦åŠ›è®¡ç®—â€”â€”å…³é”®ç”¨äºåŠ›æ§</li>
  <li>å¿«é€Ÿä»¿çœŸâ€”â€”å¯ä»¥å¤§é‡è®­ç»ƒ</li>
  <li>å¯å¾®åˆ†â€”â€”ç›´æ¥ä¼˜åŒ–æ§åˆ¶ç­–ç•¥</li>
</ul>

<h4>ä» PushBox åˆ°åŒ»ç–—ä»¿çœŸçš„è·¯çº¿å›¾</h4>
<div class="diagram">
PushBox (Week 1)         â†’ å­¦ä¹  MuJoCo åŸºç¡€ + RL é›†æˆ
    â†“
GraspBox (Week 2-3)      â†’ æŠ“å–ä»»åŠ¡ï¼ŒåŠ å…¥åŠ›ä¼ æ„Ÿå™¨
    â†“
Soft Object (Week 4-5)   â†’ Flex è½¯ä½“æ“ä½œ
    â†“
Surgical Tool (Week 6-8) â†’ å™¨æ¢°å»ºæ¨¡ + ç»„ç»‡äº¤äº’
    â†“
Full Surgical Scene       â†’ å®Œæ•´æ‰‹æœ¯åœºæ™¯ä»¿çœŸ
</div>


<!-- ================================================================== -->
<!-- ç¬¬å…«ç« ï¼šå®è·µ                                                          -->
<!-- ================================================================== -->
<h2 id="ch8">ç¬¬å…«ç« ï¼šå®è·µ</h2>

<h3 id="ch8-scratch">8.1 ä»é›¶åˆ›å»ºä¸€ä¸ª MuJoCo åœºæ™¯</h3>

<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç©ºç™½çš„ XML æ–‡ä»¶å¼€å§‹ï¼Œé€æ­¥æ„å»ºä¸€ä¸ªå®Œæ•´çš„åœºæ™¯ï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML â€” Step 1: æœ€ç®€åœºæ™¯</span>&lt;!-- step1_minimal.xml --&gt;
&lt;mujoco model="my_first_scene"&gt;
  &lt;worldbody&gt;
    &lt;!-- ä¸€ä¸ªå…‰æºï¼ˆå¦åˆ™ä»€ä¹ˆéƒ½çœ‹ä¸è§ï¼‰ --&gt;
    &lt;light pos="0 0 3" dir="0 0 -1"/&gt;
    
    &lt;!-- åœ°é¢ --&gt;
    &lt;geom type="plane" size="5 5 0.1"/&gt;
    
    &lt;!-- ä¸€ä¸ªä¼šæ‰è½çš„çƒ --&gt;
    &lt;body pos="0 0 2"&gt;
      &lt;freejoint/&gt;
      &lt;geom type="sphere" size="0.1" rgba="1 0 0 1"/&gt;
    &lt;/body&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;</code></pre>

<pre><code class="language-xml"><span class="code-label">XML â€” Step 2: åŠ å…¥ç‰©ç†é…ç½®</span>&lt;!-- step2_physics.xml --&gt;
&lt;mujoco model="my_first_scene"&gt;
  &lt;compiler angle="degree"/&gt;
  &lt;option timestep="0.002" gravity="0 0 -9.81"/&gt;
  
  &lt;default&gt;
    &lt;geom friction="0.5 0.005 0.0001"/&gt;
  &lt;/default&gt;
  
  &lt;worldbody&gt;
    &lt;light pos="0 0 3" dir="0 0 -1"/&gt;
    &lt;geom type="plane" size="5 5 0.1" rgba="0.9 0.9 0.9 1"/&gt;
    
    &lt;!-- çº¢çƒï¼šè‡ªç”±è½ä½“ --&gt;
    &lt;body pos="0 0 2"&gt;
      &lt;freejoint/&gt;
      &lt;geom type="sphere" size="0.1" mass="1.0" rgba="1 0 0 1"/&gt;
    &lt;/body&gt;
    
    &lt;!-- è“è‰²æ–¹å—ï¼šä¹Ÿä¼šæ‰è½ --&gt;
    &lt;body pos="0.5 0 1"&gt;
      &lt;freejoint/&gt;
      &lt;geom type="box" size="0.1 0.1 0.1" mass="0.5" rgba="0 0 1 1"/&gt;
    &lt;/body&gt;
  &lt;/worldbody&gt;
&lt;/mujoco&gt;</code></pre>

<pre><code class="language-xml"><span class="code-label">XML â€” Step 3: åŠ å…¥å…³èŠ‚å’Œæ‰§è¡Œå™¨</span>&lt;!-- step3_robot.xml --&gt;
&lt;mujoco model="simple_arm"&gt;
  &lt;compiler angle="degree"/&gt;
  &lt;option timestep="0.002" gravity="0 0 -9.81"/&gt;
  
  &lt;worldbody&gt;
    &lt;light pos="0 0 3" dir="0 0 -1"/&gt;
    &lt;geom type="plane" size="5 5 0.1"/&gt;
    
    &lt;!-- 1-DOF æ—‹è½¬æ‰‹è‡‚ --&gt;
    &lt;body pos="0 0 0.5"&gt;
      &lt;joint name="joint1" type="hinge" axis="0 1 0" range="-90 90"/&gt;
      &lt;geom type="capsule" fromto="0 0 0 0 0 0.4" size="0.03" rgba="0.5 0.5 1 1"/&gt;
      
      &lt;!-- æœ«ç«¯çš„çƒ --&gt;
      &lt;body pos="0 0 0.4"&gt;
        &lt;geom type="sphere" size="0.05" rgba="1 0.5 0 1"/&gt;
      &lt;/body&gt;
    &lt;/body&gt;
  &lt;/worldbody&gt;
  
  &lt;actuator&gt;
    &lt;motor name="motor1" joint="joint1" gear="1" ctrllimited="true" ctrlrange="-5 5"/&gt;
  &lt;/actuator&gt;
&lt;/mujoco&gt;</code></pre>

<pre><code class="language-python"><span class="code-label">PYTHON â€” æµ‹è¯•æ–°åœºæ™¯</span>import mujoco
import mujoco.viewer

model = mujoco.MjModel.from_xml_string(xml)  # æˆ– from_xml_path
data = mujoco.MjData(model)

# äº¤äº’å¼æŸ¥çœ‹
viewer = mujoco.viewer.launch_passive(model, data)
while viewer.is_running():
    data.ctrl[0] = 2.0  # ç»™ä¸€ä¸ªåŠ›çŸ©
    mujoco.mj_step(model, data)
    viewer.sync()</code></pre>


<h3 id="ch8-viewer">8.2 å¯è§†åŒ–ä¸è°ƒè¯•æŠ€å·§</h3>

<div class="box thm">
  <div class="box-title">âœ… MuJoCo Viewer è°ƒè¯• Checklist</div>
  <ol>
    <li><strong>æ£€æŸ¥ç¢°æ’</strong>ï¼šæŒ‰ C é”®æ˜¾ç¤ºæ¥è§¦åŠ›ç®­å¤´ã€‚ç¡®è®¤ç‰©ä½“åœ¨æ­£ç¡®çš„åœ°æ–¹æ¥è§¦ã€‚</li>
    <li><strong>æ£€æŸ¥å…³èŠ‚</strong>ï¼šæŒ‰ J é”®æ˜¾ç¤ºå…³èŠ‚è½´ã€‚ç¡®è®¤æ—‹è½¬æ–¹å‘æ­£ç¡®ã€‚</li>
    <li><strong>äº¤äº’æµ‹è¯•</strong>ï¼šCtrl + å³é”®æ‹–åŠ¨ç‰©ä½“ï¼Œè§‚å¯Ÿç‰©ç†å“åº”æ˜¯å¦åˆç†ã€‚</li>
    <li><strong>æ£€æŸ¥è´¨å¿ƒ</strong>ï¼šæŒ‰ U é”®æ˜¾ç¤ºæ¯ä¸ª body çš„è´¨å¿ƒä½ç½®ã€‚</li>
    <li><strong>é€è§†æ£€æŸ¥</strong>ï¼šæŒ‰ T é”®åˆ‡æ¢é€æ˜æ¨¡å¼ï¼Œæ£€æŸ¥å†…éƒ¨ç»“æ„ã€‚</li>
    <li><strong>çº¿æ¡†æ¨¡å¼</strong>ï¼šæŒ‰ W é”®åˆ‡æ¢çº¿æ¡†ï¼Œæ£€æŸ¥ç¢°æ’å‡ ä½•ä½“çš„è¾¹ç•Œã€‚</li>
  </ol>
</div>

<pre><code class="language-python"><span class="code-label">PYTHON</span># æ‰“å°æ¨¡å‹è¯Šæ–­ä¿¡æ¯
import mujoco

model = mujoco.MjModel.from_xml_path("push_box.xml")
data = mujoco.MjData(model)

print("=" * 50)
print("æ¨¡å‹è¯Šæ–­ä¿¡æ¯")
print("=" * 50)

# åŸºæœ¬ç»Ÿè®¡
print(f"\n--- åŸºæœ¬ç»Ÿè®¡ ---")
print(f"  Body æ•°: {model.nbody}")
print(f"  Joint æ•°: {model.njnt}")
print(f"  Geom æ•°: {model.ngeom}")
print(f"  Site æ•°: {model.nsite}")
print(f"  Actuator æ•°: {model.nu}")
print(f"  nq (å¹¿ä¹‰åæ ‡ç»´åº¦): {model.nq}")
print(f"  nv (å¹¿ä¹‰é€Ÿåº¦ç»´åº¦): {model.nv}")

# å…³èŠ‚ä¿¡æ¯
print(f"\n--- å…³èŠ‚ ---")
for i in range(model.njnt):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_JOINT, i)
    jnt_type = model.jnt_type[i]
    type_names = {0: "free", 1: "ball", 2: "slide", 3: "hinge"}
    qpos_adr = model.jnt_qposadr[i]
    dof_adr = model.jnt_dofadr[i]
    print(f"  {name}: type={type_names.get(jnt_type, '?')}, "
          f"qpos_start={qpos_adr}, dof_start={dof_adr}")

# è´¨é‡ä¿¡æ¯
print(f"\n--- è´¨é‡ ---")
total_mass = 0
for i in range(model.nbody):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, i) or "world"
    mass = model.body_mass[i]
    total_mass += mass
    if mass > 0:
        print(f"  {name}: {mass:.4f} kg")
print(f"  æ€»è´¨é‡: {total_mass:.4f} kg")

# æ‰§è¡Œå™¨ä¿¡æ¯
print(f"\n--- æ‰§è¡Œå™¨ ---")
for i in range(model.nu):
    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_ACTUATOR, i)
    ctrl_range = model.actuator_ctrlrange[i]
    print(f"  {name}: range=[{ctrl_range[0]:.1f}, {ctrl_range[1]:.1f}]")</code></pre>


<h3 id="ch8-experiment">8.3 ç‰©ç†å‚æ•°å®éªŒ</h3>

<p>é€šè¿‡ä¿®æ”¹ç‰©ç†å‚æ•°ï¼Œè§‚å¯Ÿå¯¹ä»¿çœŸè¡Œä¸ºçš„å½±å“ï¼Œæ˜¯ç†è§£ç‰©ç†å¼•æ“çš„æœ€ä½³æ–¹å¼ï¼š</p>

<pre><code class="language-python"><span class="code-label">PYTHON</span>import mujoco
import numpy as np

def experiment_friction(friction_values):
    """å®éªŒï¼šä¸åŒæ‘©æ“¦ç³»æ•°å¯¹æ¨ç®±å­çš„å½±å“"""
    for mu in friction_values:
        model = mujoco.MjModel.from_xml_path("push_box.xml")
        data = mujoco.MjData(model)
        
        # è®¾ç½®ç®±å­æ‘©æ“¦åŠ›
        box_geom_id = mujoco.mj_name2id(
            model, mujoco.mjtObj.mjOBJ_GEOM, "box_geom"
        )
        model.geom_friction[box_geom_id, 0] = mu
        
        # ç»™æ‰‹è‡‚ä¸€ä¸ªå›ºå®šåŠ›çŸ©
        for step in range(1000):
            data.ctrl[0] = 3.0  # shoulder
            data.ctrl[1] = -1.0  # elbow
            mujoco.mj_step(model, data)
        
        box_pos = data.qpos[2:4]
        print(f"  æ‘©æ“¦ç³»æ•° Î¼={mu:.2f}: ç®±å­ä½ç½® = ({box_pos[0]:.3f}, {box_pos[1]:.3f})")

experiment_friction([0.1, 0.3, 0.5, 0.8, 1.0])
# Î¼ è¶Šå° â†’ ç®±å­æ»‘å¾—è¶Šè¿œ
# Î¼ è¶Šå¤§ â†’ ç®±å­æ›´éš¾æ¨åŠ¨


def experiment_mass(mass_values):
    """å®éªŒï¼šä¸åŒç®±å­è´¨é‡çš„å½±å“"""
    for m in mass_values:
        model = mujoco.MjModel.from_xml_path("push_box.xml")
        data = mujoco.MjData(model)
        
        box_body_id = mujoco.mj_name2id(
            model, mujoco.mjtObj.mjOBJ_BODY, "box"
        )
        model.body_mass[box_body_id] = m
        
        for step in range(1000):
            data.ctrl[0] = 3.0
            data.ctrl[1] = -1.0
            mujoco.mj_step(model, data)
        
        box_pos = data.qpos[2:4]
        print(f"  è´¨é‡ m={m:.2f}kg: ç®±å­ä½ç½® = ({box_pos[0]:.3f}, {box_pos[1]:.3f})")

experiment_mass([0.1, 0.5, 1.0, 2.0, 5.0])
# è´¨é‡è¶Šå¤§ â†’ ç®±å­è¶Šéš¾æ¨åŠ¨ï¼ˆæƒ¯æ€§å¤§ï¼‰


def experiment_damping(damping_values):
    """å®éªŒï¼šä¸åŒå…³èŠ‚é˜»å°¼çš„å½±å“"""
    for d in damping_values:
        model = mujoco.MjModel.from_xml_path("push_box.xml")
        data = mujoco.MjData(model)
        
        for jnt_name in ["shoulder", "elbow"]:
            jnt_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_JOINT, jnt_name)
            model.jnt_damping[jnt_id] = d
        
        # ç»™ä¸€ä¸ªè„‰å†²åŠ›çŸ©ç„¶åé‡Šæ”¾
        for step in range(200):
            if step < 50:
                data.ctrl[:] = [5.0, -3.0]
            else:
                data.ctrl[:] = [0.0, 0.0]
            mujoco.mj_step(model, data)
        
        # çœ‹å…³èŠ‚æ˜¯å¦è¿˜åœ¨åŠ¨
        vel = np.linalg.norm(data.qvel[:2])
        print(f"  é˜»å°¼ d={d:.2f}: æœ€ç»ˆå…³èŠ‚é€Ÿåº¦ = {vel:.4f} rad/s")

experiment_damping([0.01, 0.1, 0.5, 1.0, 5.0])
# é˜»å°¼è¶Šå¤§ â†’ æ‰‹è‡‚åœå¾—è¶Šå¿«ï¼ˆèƒ½é‡è€—æ•£å¿«ï¼‰</code></pre>


<h3 id="ch8-new-env">8.4 æ„å»ºæ–°ç¯å¢ƒ â€” æŠ“å–ä»»åŠ¡ç¤ºä¾‹</h3>

<p>å­¦ä¹ å®Œ PushBox åï¼Œæˆ‘ä»¬æ¥æ„æ€ä¸€ä¸ªæ›´å¤æ‚çš„ç¯å¢ƒâ€”â€”æŠ“å–ä»»åŠ¡ï¼š</p>

<pre><code class="language-xml"><span class="code-label">XML â€” grasp_box.xml æ¦‚å¿µè®¾è®¡</span>&lt;mujoco model="grasp_box"&gt;
  &lt;compiler angle="degree" inertiafromgeom="true"/&gt;
  &lt;option timestep="0.002" gravity="0 0 -9.81"/&gt;
  
  &lt;worldbody&gt;
    &lt;light pos="0 0 3"/&gt;
    &lt;geom type="plane" size="3 3 0.1"/&gt;
    
    &lt;!-- 3-DOF æ‰‹è‡‚ï¼ˆå¢åŠ ä¸€ä¸ªå‡é™å…³èŠ‚ï¼‰ --&gt;
    &lt;body pos="0 0 0"&gt;
      &lt;!-- å…³èŠ‚1: å‡é™ï¼ˆslide å…³èŠ‚ï¼‰ --&gt;
      &lt;joint name="lift" type="slide" axis="0 0 1" range="0 0.5"/&gt;
      &lt;geom type="cylinder" size="0.03 0.01"/&gt;
      
      &lt;body pos="0 0 0"&gt;
        &lt;!-- å…³èŠ‚2: æ—‹è½¬ --&gt;
        &lt;joint name="rotate" type="hinge" axis="0 0 1" range="-180 180"/&gt;
        &lt;geom type="capsule" fromto="0 0 0 0.3 0 0" size="0.02"/&gt;
        
        &lt;body pos="0.3 0 0"&gt;
          &lt;!-- å…³èŠ‚3: è‚˜å…³èŠ‚ --&gt;
          &lt;joint name="elbow" type="hinge" axis="0 0 1" range="-150 150"/&gt;
          &lt;geom type="capsule" fromto="0 0 0 0.2 0 0" size="0.02"/&gt;
          
          &lt;!-- ç®€å•å¤¹çˆªï¼ˆä¸¤ä¸ªå¯¹ç§°çš„æ‰‹æŒ‡ï¼‰ --&gt;
          &lt;body name="finger_left" pos="0.2 0 0"&gt;
            &lt;joint name="grip_left" type="slide" axis="0 1 0" range="0 0.05"/&gt;
            &lt;geom type="box" size="0.01 0.005 0.04" pos="0 0.005 -0.02"/&gt;
          &lt;/body&gt;
          &lt;body name="finger_right" pos="0.2 0 0"&gt;
            &lt;joint name="grip_right" type="slide" axis="0 -1 0" range="0 0.05"/&gt;
            &lt;geom type="box" size="0.01 0.005 0.04" pos="0 -0.005 -0.02"/&gt;
          &lt;/body&gt;
        &lt;/body&gt;
      &lt;/body&gt;
    &lt;/body&gt;
    
    &lt;!-- ç›®æ ‡ç‰©ä½“ --&gt;
    &lt;body pos="0.3 0.2 0.05"&gt;
      &lt;freejoint/&gt;
      &lt;geom type="box" size="0.03 0.03 0.03" mass="0.1" rgba="0 1 0 1"/&gt;
    &lt;/body&gt;
  &lt;/worldbody&gt;
  
  &lt;actuator&gt;
    &lt;motor joint="lift" gear="1" ctrlrange="-10 10" ctrllimited="true"/&gt;
    &lt;motor joint="rotate" gear="1" ctrlrange="-5 5" ctrllimited="true"/&gt;
    &lt;motor joint="elbow" gear="1" ctrlrange="-5 5" ctrllimited="true"/&gt;
    &lt;motor joint="grip_left" gear="1" ctrlrange="-1 1" ctrllimited="true"/&gt;
    &lt;motor joint="grip_right" gear="1" ctrlrange="-1 1" ctrllimited="true"/&gt;
  &lt;/actuator&gt;
&lt;/mujoco&gt;</code></pre>

<p>æŠ“å–ç¯å¢ƒéœ€è¦é¢å¤–è€ƒè™‘çš„è®¾è®¡ç‚¹ï¼š</p>
<ul>
  <li><strong>è§‚å¯Ÿç©ºé—´</strong>ï¼šå¢åŠ å¤¹çˆªå¼€åˆåº¦ã€ç›®æ ‡ç‰©ä½“å§¿æ€</li>
  <li><strong>å¥–åŠ±å‡½æ•°</strong>ï¼šåˆ†é˜¶æ®µå¥–åŠ±ï¼ˆæ¥è¿‘ â†’ æŠ“å– â†’ æŠ¬èµ· â†’ æ”¾ç½®ï¼‰</li>
  <li><strong>æˆåŠŸåˆ¤å®š</strong>ï¼šç‰©ä½“è¢«æŠ¬èµ·åˆ°ä¸€å®šé«˜åº¦ä»¥ä¸Š</li>
  <li><strong>å¤¹çˆªæ§åˆ¶</strong>ï¼šå¯ä»¥ç”¨è€¦åˆå…³èŠ‚ï¼ˆä¸¤ä¸ªæ‰‹æŒ‡å¯¹ç§°è¿åŠ¨ï¼‰ç®€åŒ–åŠ¨ä½œç©ºé—´</li>
</ul>


<!-- ================================================================== -->
<!-- é™„å½•                                                                -->
<!-- ================================================================== -->
<h2 id="appendix">é™„å½•</h2>

<h3 id="appendix-xml">A. MJCF XML æ ‡ç­¾é€ŸæŸ¥è¡¨</h3>

<table>
<tr><th>æ ‡ç­¾</th><th>çˆ¶æ ‡ç­¾</th><th>æ ¸å¿ƒå±æ€§</th><th>è¯´æ˜</th></tr>
<tr><td><code>&lt;mujoco&gt;</code></td><td>â€”</td><td><code>model</code></td><td>æ ¹å…ƒç´ </td></tr>
<tr><td><code>&lt;compiler&gt;</code></td><td>mujoco</td><td><code>angle, coordinate, inertiafromgeom, meshdir</code></td><td>ç¼–è¯‘å™¨é…ç½®</td></tr>
<tr><td><code>&lt;option&gt;</code></td><td>mujoco</td><td><code>timestep, integrator, gravity, cone, solver</code></td><td>ä»¿çœŸé€‰é¡¹</td></tr>
<tr><td><code>&lt;visual&gt;</code></td><td>mujoco</td><td>â€”</td><td>æ¸²æŸ“è®¾ç½®å®¹å™¨</td></tr>
<tr><td><code>&lt;asset&gt;</code></td><td>mujoco</td><td>â€”</td><td>èµ„äº§å®¹å™¨</td></tr>
<tr><td><code>&lt;texture&gt;</code></td><td>asset</td><td><code>name, type, builtin, file</code></td><td>çº¹ç†å®šä¹‰</td></tr>
<tr><td><code>&lt;material&gt;</code></td><td>asset</td><td><code>name, texture, rgba, shininess</code></td><td>æè´¨å®šä¹‰</td></tr>
<tr><td><code>&lt;mesh&gt;</code></td><td>asset</td><td><code>name, file, scale</code></td><td>ç½‘æ ¼æ¨¡å‹</td></tr>
<tr><td><code>&lt;default&gt;</code></td><td>mujoco</td><td><code>class</code></td><td>é»˜è®¤å‚æ•°</td></tr>
<tr><td><code>&lt;worldbody&gt;</code></td><td>mujoco</td><td>â€”</td><td>ä¸–ç•Œæ ¹ body</td></tr>
<tr><td><code>&lt;body&gt;</code></td><td>worldbody/body</td><td><code>name, pos, quat, euler</code></td><td>åˆšä½“</td></tr>
<tr><td><code>&lt;geom&gt;</code></td><td>body/worldbody</td><td><code>name, type, size, pos, mass, density, rgba, friction</code></td><td>å‡ ä½•ä½“</td></tr>
<tr><td><code>&lt;joint&gt;</code></td><td>body</td><td><code>name, type, axis, range, damping, armature</code></td><td>å…³èŠ‚</td></tr>
<tr><td><code>&lt;freejoint&gt;</code></td><td>body</td><td><code>name</code></td><td>6-DOF è‡ªç”±å…³èŠ‚</td></tr>
<tr><td><code>&lt;site&gt;</code></td><td>body/worldbody</td><td><code>name, pos, size, type, rgba</code></td><td>æ ‡è®°ç‚¹</td></tr>
<tr><td><code>&lt;light&gt;</code></td><td>body/worldbody</td><td><code>pos, dir, diffuse, directional</code></td><td>å…‰æº</td></tr>
<tr><td><code>&lt;actuator&gt;</code></td><td>mujoco</td><td>â€”</td><td>æ‰§è¡Œå™¨å®¹å™¨</td></tr>
<tr><td><code>&lt;motor&gt;</code></td><td>actuator</td><td><code>name, joint, gear, ctrllimited, ctrlrange</code></td><td>åŠ›çŸ©ç”µæœº</td></tr>
<tr><td><code>&lt;position&gt;</code></td><td>actuator</td><td><code>name, joint, kp</code></td><td>ä½ç½®ä¼ºæœ</td></tr>
<tr><td><code>&lt;velocity&gt;</code></td><td>actuator</td><td><code>name, joint, kv</code></td><td>é€Ÿåº¦æ§åˆ¶å™¨</td></tr>
<tr><td><code>&lt;sensor&gt;</code></td><td>mujoco</td><td>â€”</td><td>ä¼ æ„Ÿå™¨å®¹å™¨</td></tr>
<tr><td><code>&lt;tendon&gt;</code></td><td>mujoco</td><td>â€”</td><td>è‚Œè…±å®¹å™¨</td></tr>
<tr><td><code>&lt;equality&gt;</code></td><td>mujoco</td><td>â€”</td><td>çº¦æŸå®¹å™¨</td></tr>
</table>


<h3 id="appendix-api">B. MuJoCo Python API é€ŸæŸ¥è¡¨</h3>

<pre><code class="language-python"><span class="code-label">PYTHON â€” API é€ŸæŸ¥</span>import mujoco

# ========== åŠ è½½ ==========
model = mujoco.MjModel.from_xml_path("model.xml")
model = mujoco.MjModel.from_xml_string(xml_str)
data = mujoco.MjData(model)

# ========== ä»¿çœŸ ==========
mujoco.mj_step(model, data)          # å®Œæ•´ä¸€æ­¥ï¼ˆè®¡ç®—+ç§¯åˆ†ï¼‰
mujoco.mj_forward(model, data)       # ä»…è®¡ç®—ï¼ˆä¸ç§¯åˆ†ï¼‰
mujoco.mj_resetData(model, data)     # é‡ç½® data åˆ°åˆå§‹çŠ¶æ€

# ========== åç§°/ID ==========
id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_BODY, "name")
name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_BODY, id)
# ç±»å‹: mjOBJ_BODY, mjOBJ_JOINT, mjOBJ_GEOM, mjOBJ_SITE, mjOBJ_ACTUATOR, mjOBJ_SENSOR

# ========== çŠ¶æ€è¯»å†™ ==========
data.qpos[:]    # å¹¿ä¹‰åæ ‡ï¼ˆå…³èŠ‚ä½ç½® + è‡ªç”±ä½“ä½å§¿ï¼‰
data.qvel[:]    # å¹¿ä¹‰é€Ÿåº¦
data.ctrl[:]    # æ§åˆ¶è¾“å…¥ï¼ˆè®¾ç½®å mj_step ä¼šç”¨å®ƒï¼‰
data.time       # å½“å‰ä»¿çœŸæ—¶é—´

# ========== è®¡ç®—ç»“æœ ==========
data.xpos[i]       # body i çš„ä¸–ç•Œåæ ‡ä½ç½® (3,)
data.xquat[i]      # body i çš„ä¸–ç•Œåæ ‡å§¿æ€ (4,)
data.site_xpos[i]  # site i çš„ä¸–ç•Œåæ ‡ä½ç½® (3,)
data.ncon           # æ¥è§¦ç‚¹æ•°
data.contact[i]     # ç¬¬ i ä¸ªæ¥è§¦çš„ä¿¡æ¯
data.sensordata     # æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆè¿ç»­æ•°ç»„ï¼‰

# ========== æ¨¡å‹å‚æ•° ==========
model.opt.timestep       # æ—¶é—´æ­¥é•¿
model.opt.gravity        # é‡åŠ›å‘é‡ (3,)
model.body_mass[i]       # body i çš„è´¨é‡
model.body_inertia[i]    # body i çš„ä¸»æƒ¯æ€§çŸ© (3,)
model.geom_friction[i]   # geom i çš„æ‘©æ“¦ç³»æ•° (3,)
model.jnt_damping[i]     # joint i çš„é˜»å°¼
model.jnt_range[i]       # joint i çš„èŒƒå›´ (2,)
model.actuator_ctrlrange[i]  # actuator i çš„æ§åˆ¶èŒƒå›´ (2,)

# ========== ç»´åº¦ä¿¡æ¯ ==========
model.nq        # qpos ç»´åº¦
model.nv        # qvel ç»´åº¦
model.nu        # æ‰§è¡Œå™¨æ•°
model.nbody     # body æ•°
model.njnt      # å…³èŠ‚æ•°
model.ngeom     # geom æ•°
model.nsite     # site æ•°

# ========== é›…å¯æ¯” ==========
jacp = np.zeros((3, model.nv))
jacr = np.zeros((3, model.nv))
mujoco.mj_jacSite(model, data, jacp, jacr, site_id)
mujoco.mj_jacBody(model, data, jacp, jacr, body_id)

# ========== æ¸²æŸ“ ==========
import mujoco.viewer
viewer = mujoco.viewer.launch_passive(model, data)
viewer.sync()
viewer.close()

renderer = mujoco.Renderer(model, height=480, width=640)
renderer.update_scene(data)
image = renderer.render()  # (H, W, 3) uint8

# ========== ä¿å­˜/åŠ è½½ ==========
mujoco.mj_saveModel(model, "model.mjb", None)
model = mujoco.MjModel.from_binary_path("model.mjb")</code></pre>


<h3 id="appendix-errors">C. å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ</h3>

<table>
<tr><th>é”™è¯¯ä¿¡æ¯</th><th>åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr>
<tr><td><code>Error: unknown attribute</code></td><td>XML ä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§å</td><td>æ£€æŸ¥æ‹¼å†™ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£çš„å±æ€§åˆ—è¡¨</td></tr>
<tr><td><code>Error: missing attribute</code></td><td>ç¼ºå°‘å¿…è¦å±æ€§</td><td>æ·»åŠ å¿…è¦å±æ€§ï¼ˆå¦‚ geom éœ€è¦ type æˆ– sizeï¼‰</td></tr>
<tr><td><code>NaN in qpos</code></td><td>æ•°å€¼ä¸ç¨³å®šï¼ˆæ­¥é•¿å¤ªå¤§/åŠ›å¤ªå¤§ï¼‰</td><td>å‡å° timestepï¼Œæ£€æŸ¥ ctrl æ˜¯å¦æœ‰å¼‚å¸¸å€¼</td></tr>
<tr><td><code>Warning: Pre-allocated contact buffer full</code></td><td>æ¥è§¦ç‚¹å¤ªå¤š</td><td>åœ¨ <code>&lt;size&gt;</code> ä¸­å¢åŠ  <code>nconmax</code></td></tr>
<tr><td>ç‰©ä½“ç©¿é€åœ°é¢</td><td>æ­¥é•¿å¤ªå¤§ æˆ– é€Ÿåº¦å¤ªé«˜</td><td>å‡å° timestepï¼Œå¢åŠ  margin</td></tr>
<tr><td>ç‰©ä½“æŠ–åŠ¨</td><td>æ¥è§¦å‚æ•°ä¸åˆé€‚</td><td>è°ƒèŠ‚ solref, solimp å‚æ•°</td></tr>
<tr><td><code>mj_name2id returns -1</code></td><td>åç§°ä¸å­˜åœ¨</td><td>æ£€æŸ¥ XML ä¸­çš„ name å±æ€§</td></tr>
<tr><td>å…³èŠ‚ä¸åŠ¨</td><td>æœªè®¾ç½® ctrl æˆ–æœªæ·»åŠ  actuator</td><td>æ£€æŸ¥ actuator æ˜¯å¦æ­£ç¡®å¼•ç”¨äº† joint</td></tr>
<tr><td>qpos å’Œ qvel ç»´åº¦ä¸åŒ¹é…</td><td>æ­£å¸¸ç°è±¡ï¼ˆè‡ªç”±å…³èŠ‚/çƒå…³èŠ‚ï¼‰</td><td>ä½¿ç”¨ model.nq å’Œ model.nv è·å–æ­£ç¡®ç»´åº¦</td></tr>
<tr><td><code>import mujoco_py</code> å¤±è´¥</td><td>ä½¿ç”¨äº†æ—§ç‰ˆ API</td><td>æ”¹ç”¨ <code>import mujoco</code>ï¼ˆ3.x APIï¼‰</td></tr>
</table>


<h3 id="appendix-links">D. å®˜æ–¹æ–‡æ¡£å’Œå­¦ä¹ èµ„æº</h3>

<table>
<tr><th>èµ„æº</th><th>é“¾æ¥</th><th>è¯´æ˜</th></tr>
<tr><td>MuJoCo å®˜æ–¹æ–‡æ¡£</td><td><a href="https://mujoco.readthedocs.io/" target="_blank">mujoco.readthedocs.io</a></td><td>æœ€æƒå¨çš„å‚è€ƒ</td></tr>
<tr><td>MJCF XML å‚è€ƒ</td><td><a href="https://mujoco.readthedocs.io/en/stable/XMLreference.html" target="_blank">XML Reference</a></td><td>æ‰€æœ‰æ ‡ç­¾å’Œå±æ€§çš„å®Œæ•´è¯´æ˜</td></tr>
<tr><td>Python API å‚è€ƒ</td><td><a href="https://mujoco.readthedocs.io/en/stable/python.html" target="_blank">Python Bindings</a></td><td>Python ç»‘å®šè¯¦ç»†æ–‡æ¡£</td></tr>
<tr><td>MuJoCo GitHub</td><td><a href="https://github.com/google-deepmind/mujoco" target="_blank">github.com/google-deepmind/mujoco</a></td><td>æºç ã€issueã€ç¤ºä¾‹</td></tr>
<tr><td>MuJoCo Menagerie</td><td><a href="https://github.com/google-deepmind/mujoco_menagerie" target="_blank">mujoco_menagerie</a></td><td>å¼€æºæœºå™¨äººæ¨¡å‹åº“</td></tr>
<tr><td>Gymnasium</td><td><a href="https://gymnasium.farama.org/" target="_blank">gymnasium.farama.org</a></td><td>RL ç¯å¢ƒæ ‡å‡†æ¥å£</td></tr>
<tr><td>dm_control</td><td><a href="https://github.com/google-deepmind/dm_control" target="_blank">dm_control</a></td><td>DeepMind æ§åˆ¶ä»»åŠ¡å¥—ä»¶</td></tr>
<tr><td>Stable-Baselines3</td><td><a href="https://stable-baselines3.readthedocs.io/" target="_blank">stable-baselines3</a></td><td>RL ç®—æ³•åº“</td></tr>
</table>

<div class="box thm">
  <div class="box-title">âœ… æ¨èå­¦ä¹ è·¯å¾„</div>
  <ol>
    <li>æœ¬æ•™ç¨‹ â†’ ç†è§£åŸºç¡€æ¦‚å¿µå’Œ PushBox é¡¹ç›®</li>
    <li>MuJoCo å®˜æ–¹æ•™ç¨‹ â†’ æ›´å¤šç¤ºä¾‹å’Œæ·±å…¥ç»†èŠ‚</li>
    <li>dm_control Colab æ•™ç¨‹ â†’ åŠ¨æ‰‹å®è·µ</li>
    <li>MuJoCo Menagerie â†’ å­¦ä¹ çœŸå®æœºå™¨äººæ¨¡å‹çš„å»ºæ¨¡æ–¹å¼</li>
    <li>è®ºæ–‡é˜…è¯» â†’ Todorov 2012 (MuJoCo åŸå§‹è®ºæ–‡)ã€sim-to-real ç›¸å…³è®ºæ–‡</li>
  </ol>
</div>

<hr style="margin-top: 60px;">
<p class="center muted small">
  ğŸ“š MuJoCo ç‰©ç†å¼•æ“å®Œå…¨å­¦ä¹ æ•™ç¨‹ | åŒ»ç–—æœºå™¨äººä»¿çœŸé¡¹ç›® Â· å•é¡¹å­¦ä¹ ç³»åˆ—<br>
  æœ€åæ›´æ–°: 2026-02-06 | åŸºäº MuJoCo 3.x | 
  <a href="https://github.com/google-deepmind/mujoco" target="_blank">MuJoCo GitHub</a>
</p>

</main>

<!-- Back to top -->
<button class="back-top" id="backTop" onclick="window.scrollTo({top:0})">â†‘</button>

<script>
// ============================================================
// Theme Toggle
// ============================================================
function toggleTheme() {
  const body = document.body;
  const isDark = body.getAttribute('data-theme') === 'dark';
  body.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('hljs-dark').disabled = isDark;
  document.getElementById('hljs-light').disabled = !isDark;
  localStorage.setItem('theme', isDark ? 'light' : 'dark');
}

// Restore theme
(function() {
  const saved = localStorage.getItem('theme');
  if (saved) {
    document.body.setAttribute('data-theme', saved);
    document.getElementById('hljs-dark').disabled = saved === 'light';
    document.getElementById('hljs-light').disabled = saved === 'dark';
  }
})();

// ============================================================
// Code Highlighting
// ============================================================
hljs.highlightAll();

// ============================================================
// Progress Bar
// ============================================================
window.addEventListener('scroll', function() {
  const scrollTop = window.scrollY;
  const docHeight = document.documentElement.scrollHeight - window.innerHeight;
  const progress = (scrollTop / docHeight) * 100;
  document.getElementById('progressBar').style.width = progress + '%';
  
  // Back to top button
  const btn = document.getElementById('backTop');
  if (scrollTop > 400) btn.classList.add('show');
  else btn.classList.remove('show');
});

// ============================================================
// Active TOC Tracking
// ============================================================
(function() {
  const headings = document.querySelectorAll('h2[id], h3[id]');
  const links = document.querySelectorAll('.sidebar a');
  
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const id = entry.target.getAttribute('id');
        links.forEach(link => {
          link.classList.toggle('active', link.getAttribute('href') === '#' + id);
        });
      }
    });
  }, { rootMargin: '-80px 0px -70% 0px' });
  
  headings.forEach(h => observer.observe(h));
})();

// ============================================================
// Reading Time Estimate
// ============================================================
(function() {
  const text = document.querySelector('.main-content').textContent;
  const charCount = text.length;
  // Chinese: ~400 chars/min reading speed
  const minutes = Math.ceil(charCount / 400);
  document.getElementById('readingTime').textContent = `çº¦ ${minutes} åˆ†é’Ÿé˜…è¯»`;
})();

// ============================================================
// Mobile sidebar close on link click
// ============================================================
document.querySelectorAll('.sidebar a').forEach(link => {
  link.addEventListener('click', () => {
    if (window.innerWidth <= 900) {
      document.querySelector('.sidebar').classList.remove('open');
    }
  });
});
</script>

</body>
</html>